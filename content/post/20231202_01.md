---
title: "Google Analytics で Google Tag Manager で設定したイベントパラメータを計測および表示を行う方法"
slug: "how-to-measure-and-display-event-parameters-set-by-gtm-in-ga"
tags: [ "Google Tag Manager", "Google Analytics" ]
thumbnail: "images/logo/google_analytics_logo.png"
description: "Google Analytics で Google Tag Manager で設定したイベントパラメータを計測および表示を行う方法を備忘録として残しておく"
mathjax: false
mermaid: false
iframe: false
date: 2023-12-02T12:00:00+09:00
draft: false
type: "post"
---

Google Analytics(GA) で Google Tag Manager(以下 GTM) で設定したイベントパラメータを計測および表示を行う方法を備忘録として残しておく

## 前提

* ソースコードに GTM との連携用のスクリプトが導入済であること
* ソースコード上に以下のようなカスタムイベント発火のコードが設定されていること

```js
pushDataLayer({
  event: "watch_video",
  userID: userId,
  datetime: `${date} ${time}`,
});
```

## 方法

1. [管理] > [データの収集と修正] > [データ ストリーム]を選択
2. 対象のサイトを選択
3. 測定 ID をコピーして退避しておく
4. [Google マーケティング プラットフォーム] > [タグマネージャー]を選択

## GTM での作業

### 変数の登録

1. [変数] > [ユーザ定義変数] > [新規]ボタンを押下
2. 変数名に「user_id」と入力
3. 変数のタイプに[データレイヤーの変数]を選択
4. データレイヤーの変数名に「userId」を入力
5. [保存]ボタンを押下
6. 「datetime」も同じように登録する

### トリガーの登録

1. [トリガー] > [新規]ボタンを押下
2. 名称に「動画再生」と入力
3. [トリガーの設定]の中央アイコンを押下
4. [その他] > [カスタムイベント]を選択
5. イベント名に「watch_video」を入力
6. [保存]ボタンを押下

### タグの登録

1. [タグ] > [新規]ボタンを押下
2. 名称に「動画再生」と入力
3. [トリガー]の中央アイコンを押下
4. トリガーの登録で登録した「動画再生」を選択
5. [タグの設定]の中央アイコンを押下
6. [Google アナリティクス] > [Google アナリティクス: GA4 イベント]を選択
7. 測定 ID に事前に退避しておいた測定 ID を入力
8. イベント名に「watch_video」を入力
9. イベント パラメータに 「user_id」を入力
10. 値に「{{user_id}}」を入力
11. イベント パラメータに 「datetime」を入力
12. 値に「{{datetime}}」を入力
13. [保存]ボタンを押下
14. [プレビュー]ボタンを押下してカスタムイベントが測定されることを確認
15. [公開]ボタンを押下

## GA での作業

### カスタムディメンションの設定

1. Google Analytics にログイン
2. [管理]>[データの表示]>[カスタム定義]を選択
3. [カスタム ディメンションを作成]を押下
4. ディメンション名に「ユーザID」と入力
5. 範囲に「イベント」を選択
6. 説明に任意の値を入力
7. イベント パラメータに「user_id」を入力
8. 「保存」ボタンを押下
9. datetime も同じように登録 ※ディメンション名は「イベント実行時間」

### 動画再生時間収集用の探索の設定

※探索は前日までのデータしか対象にできないため設定の確認は後日に行うことになる

1. [探索]を選択
2. [空白]を選択
3. ディメンションの右横にある[+]ボタンを押下
4. [カスタム]>[ユーザID]のチェックを入れる
5. [カスタム]>[イベント実行時間]のチェックを入れる
6. [インポート]ボタンを押下
7. 期間を対象期間に変更する
8. [フィルタ]>[イベント名]を選択
9. [条件]>[マッチ タイプを選択してください]に「次と完全一致」を選択
10. [条件]>「式を入力」に「watch_video」を入力

後は、表示したい項目を行、列、値に組み込んでいく

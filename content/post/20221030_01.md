---
title: "rspec で factory bot を使用して複数テストを作成すると同時に関連するクラスを紐づけて動的に生成する方法"
slug: "how_to_dynamic_create_test_data_for_factory_bot_with_rspec"
tags: [ "Ruby on Rails" ]
thumbnail: "images/logo/rails_logo.svg"
description: "rspec で factory bot を使用して複数テストを作成すると同時に関連するクラスを紐づけて動的に生成する方法"
mathjax: false
date: 2022-10-30T21:00:00+09:00
---

## 方法

create_list と send メソッドを使用して実現する

## 環境

* ruby: 3.0.4
* rails: 6.1.6.1

## 実際のコード

user のテストデータを3つ作成 かつ 関連する  
user_status のテストデータを  
紐づけて作成してカラム status を  
動的に生成する

```rb
let(:user_status1) { UserStatus::Active }
let(:user_status2) { UserStatus::Locked }
let(:user_status3) { UserStatus::InActive }

before do
  create_list(:user, 3).each.with_index(1) do |user, i|
    create(
      :user_status,
      user: user,
      status: send("user_status#{i}"),
    )
  end
end
```

---
title: "Rails 7 リリースノートまとめ"
slug: "rails-7-release-notes-summary"
tags: [ "Ruby On Rails" ]
thumbnail: "images/logo/rails_logo.svg"
description: "Rails 7 リリースノートについてまとめたものを備忘録として残しておく"
mathjax: false
mermaid: false
iframe: false
date: 2025-03-18T9:00:00+09:00
draft: false
type: "post"
---

Rails 7 リリースノートについてまとめたものを備忘録として残しておく

## Rails 7 系での新機能および変更点

### JavaScriptフロントエンドの刷新

ESM（ECMAScript modules）や import maps を使用し、Node.js をインストールせずにモダンな JavaScript が利用可能  
※デフォルトでは Hotwire, Stimulus, Turbo がインストールされる

### CSS Bundling

* 以下のサポートが追加
  * Tailwind CSS
  * PostCSS

アプリケーション新規作成時に指定可能

```rb
rails new myapp --css tailwind
```

既存に追加する場合は Gemfile に以下を追加して

```rb
gem 'cssbundling-rails'
```

以下のコマンドを実行することでインストールおよび初期設定が可能

```rb
bin/bundle install
bin/rails css:install:tailwind
```

### Active Recordの実行時暗号化機能

データの暗号化が可能になった

1. `bin/rails db:encryption:init` コマンドを実行してランダムなキーを生成
2. 結果を`bin/rails credentials:edit`で開いたエディタの画面に貼り付けて保存
3. Model で以下のように指定

```rb
class User < ApplicationRecord
 encrypts :name
end
```

### Spring のデフォルト値の変更

大規模なアプリケーション以外では Spring があまり意味をなさなくなったため、デフォルトがオフに変更

### Dockerfileの生成

新規アプリケーションで Dockerfile が自動生成されるようになった

### ActiveRecordの新機能

以下が追加および変更になった

* ActiveRecord::Base.normalizes
* generates_token_for
* async

### Active Jobの変更

perform_all_later が追加された

### オートロードの強化

* autoload_lib
* autoload_lib_once

### Bunのサポート

JavaScript ランタイムとして Bun がサポートされた

### 非同期のSQLクエリによる結果の取得

`ActiveRecord::Relation#load_async` を使用することで、非同期で SQL クエリを実行できる

```rb
def index
  @articles = Article.per(params[:per]).page(params[:page]).load_async
  @categories = Category.active.load_async
end
```

### バルクインサートで自動的にタイムスタンプを記録できる

Active Record の insert_all や upsert_all メソッドなどでバルクインサート・バルクアップサートでレコードを作成、更新する際に  
created_at や updated_at などのタイムスタンプを自動でセットできるようになった。

使用する場合は Methods の `record_timestamps` オプションに `true` を渡す必要がある

```rb
Article.insert_all([{ title: "What's new in Rails 7" }], record_timestamps: true)
```

### Active Recordに in_order_of メソッドが追加

レコードを指定した順番で取得できる `in_order_of` メソッドが Active Record に追加された  
例. ユーザID が1, 5, 3の順番になるように取得

```rb
User.in_order_of(:id, [1, 5, 3])
# SELECT "users".* FROM "users" ORDER BY FIELD("users"."id", 1, 5, 3)
```

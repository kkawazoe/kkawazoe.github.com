var data = [
{
url: "https://kkawazoe.github.io/amp/blog/2026/01/17/road-to-jstqb-foundation-level-part2/",
title: "WSL 上の VSCode で 'Exec format error' が発生して起動しなくなったときの対処方法",
image: "images/logo/vscode_logo.png",
date: "2026-01-17",
body: "WSL 上の VSCode で 'Exec format error' が発生して起動しなくなったときの対処方法 WSL 上の VSCode で \u0026lsquo;Exec format error\u0026rsquo; が発生して起動しなくなったときの対処方法を備忘録として残しておく 環境 OS: Windows 11 Pro バージョン: 22H2 WSL2 カーネルバージョン: 5.15.153.1-2 OS: Ubuntu 24.04.1 LTS VSCode: バージョン 1.108.1 発生エラー /mnt/c/Users/admin/AppData/Local/Programs/Microsoft VS Code/bin/code: 61: /mnt/c/Users/admin/AppData/Local/Programs/Microsoft VS Code/Code.exe: Exec format error 対応方法 以下のコマンドを実行する ※Github Issue参照 sudo sh -c \u0026#39;echo :WSLInterop:M::MZ::/init:PF \u0026gt; /usr/lib/binfmt.d/WSLInterop.conf\u0026#39; sudo systemctl unmask systemd-binfmt.service sudo systemctl restart systemd-binfmt sudo systemctl mask systemd-binfmt.service"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/11/20/road-to-jstqb-foundation-level-part2/",
title: "JSTQB Foundation Level への道 その2",
image: "images/logo/certified_tester_fl_logo.jpg",
date: "2025-11-20",
body: "JSTQB Foundation Level への道 その2 JSTQB Foundation Level を学習する中で間違えやすいポイントを備忘録として残しておく [前回までの記事] JSTQB Foundation Level への道 受験結果 無事に合格した 確認出来るのは、合格したかどうかのみで、詳細な点数や間違えた問題などは確認出来ない テス友のみだとシラバスの細かい部分がカバーしきれないので、公式シラバスをしっかり確認しておく必要がある また、追加で他の人がまとめてくれているサイトなども参考にすると良いと思う 勉強に使用したもの 公式シラバス（日本語版） JSTQB Foundation Level シラバス 日本語版 Version 2023V4.0.J02 テス友"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/09/19/road-to-jstqb-foundation-level/",
title: "JSTQB Foundation Level への道",
image: "images/logo/certified_tester_fl_logo.jpg",
date: "2025-09-19",
body: "JSTQB Foundation Level への道 JSTQB Foundation Level を学習する中で間違えやすいポイントを備忘録として残しておく JSTQB Foundation Level シラバス キーワード 第 1章：テストの基礎 キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） カバレッジ (Coverage) テストの徹底度を測る指標。トレーサビリティを維持することで、カバレッジの評価を支援する。カバレッジ基準は、テスト目的がどの程度達成しているかを示す活動を遂行するための KPI として機能する。 1.4.4, 4.2.1, 4.3.1, 4.3.2, 5.3.1 デバッグ (Debugging) 故障の原因（欠陥）を発見し、解析し、取り除く活動。テストとは別の活動である。 1.1.2 欠陥 (Defect) 人間のエラーによって生み出されるもの。故障につながることもある。静的テストや動的テストで発見の支援をする。 1.2.3, 5.5 エラー (Error) 人間が起こす誤り。エラー推測は、この発生を予測する技法である。 1.2.3, 4.4.1 故障 (Failure) 欠陥が実行されることでシステムがすべきことをしない、またはすべきでないことをしてしまう結果。 1.2.3 品質 (Quality) ソフトウェアテストは、ソフトウェアの品質を評価し、運用環境で故障が発生するリスクを低減する手助けとなる。 1.2.2, 5.3.1 品質保証 (Quality Assurance, QA) プロセス指向の予防的アプローチであり、プロセスの実装と改善に焦点を当てる。 1.2.2 根本原因 (Root Cause) 問題（例えばエラーにつながる状況）が発生する根底の理由。 1.2.3 テスト分析 (Test Analysis) テスト可能なフィーチャーを識別し、関連するテスト条件を定義し優先順位を付ける活動。 1.4.1 テストベース (Test Basis) テストケースを導出する元となる作業成果物など。 1.4.4 テストケース (Test Case) テスト条件を具現化したもの。テストケースの優先順位付けはテスト実行の順番を決める。 1.4.1, 4.2, 5.1.5 テスト完了 (Test Completion) プロジェクトのマイルストーンで、テストウェアの保管、教訓の識別、テスト完了レポートの作成などを行う活動。 1.4.1 テスト条件 (Test Condition) テストベースを分析して定義するテスト対象の要素。 1.4.1, 4.2 テストコントロール (Test Control) テストの目的を達成するために必要な行動（是正措置）をとる活動。 1.4.1, 5.3 テストデータ (Test Data) テスト実行に必要なデータ。 1.4.1 テスト設計 (Test Design) テスト条件をテストケースやテストチャーターなどに落とし込む活動。 1.4.1 テスト実行 (Test Execution) テスト実行スケジュールに従ってテストを走らせる活動。 1.4.1 テスト実装 (Test Implementation) テスト実行に必要なテストウェア（テストプロシジャー、自動テストスクリプト、テストデータなど）を作成または取得する活動。 1.4.1 テストモニタリング (Test Monitoring) すべてのテスト活動を継続的にチェックし、実際の進捗をテスト計画と比較する活動。 1.4.1, 5.3 テスト対象 (Test Object) テストをする対象のソフトウェアアーティファクト。 1.4.1, 2.2.1 テスト目的 (Test Objective) テストによって達成しようとする目的（例：欠陥の発見、品質評価、信頼の積み上げなど）。 1.1.1 テスト計画 (Test Planning) テスト目的を定義し、目的を最も効果的に達成するアプローチを選択する活動。テスト計画書を作成するプロセス。 1.4.1, 5.1 テストプロシジャー (Test Procedure) テストケースを順序立てて実行できるようにしたもの。 1.4.1 テスト結果 (Test Result) テストの実行により得られる結果。 1.4.1 テスト (Testing) 欠陥を発見し、ソフトウェアアーティファクトの品質を評価するための一連の活動。 1.1 テストウェア (Testware) テスト活動によって出力される作業成果物（テスト計画書、テストケース、テストデータなど）。 1.4.1, 1.4.3 妥当性確認 (Validation) ユーザーやその他のステークホルダーのニーズを運用環境でシステムが満たしていることを確認する。 1.1 検証 (Verification) 指定されている要件をシステムが満たすかどうかを確認する。 1.1 第 2章：ソフトウェア開発ライフサイクル全体を通してのテスト キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） 受け入れテスト (Acceptance Testing) 妥当性確認と、デプロイの準備ができていることの実証に焦点を当てるテストレベル。 2.2.1 ブラックボックステスト (Black-box Testing) 仕様に基づき、テスト対象の外観を示すドキュメントからテストを導出するテストタイプ。 2.2.2, 4.2 コンポーネント統合テスト (Component Integration Testing) コンポーネント間のインターフェース、および相互処理に焦点を当てるテストレベル。 2.2.1 コンポーネントテスト (Component Testing) コンポーネントを単独でテストすることに焦点を当てるテストレベル（ユニットテストとも呼ばれる）。 2.2.1 確認テスト (Confirmation Testing) 元の欠陥が正常に修正されたことを確認するテスト。 2.2.3 機能テスト (Functional Testing) コンポーネント、およびシステムが実行する機能を評価するテストタイプ。 2.2.2 統合テスト (Integration Testing) コンポーネント統合テストやシステム統合テストなど、インターフェースや相互処理に焦点を当てるテスト。 2.2.1 メンテナンステスト (Maintenance Testing) システムへの変更や環境の更新に伴い実施されるテスト。 2.3 非機能テスト (Non-functional Testing) コンポーネント、およびシステムが実行する機能特性以外の属性（性能、信頼性、使用性など）を評価するテストタイプ。 2.2.2 リグレッションテスト (Regression Testing) 変更によって悪影響が生じないことを確認するテスト。自動化の有力な候補となる。 2.2.3 シフトレフト (Shift Left) テストを SDLC の早い段階で実行するアプローチ（早期テストの原則）。 2.1.5 システム統合テスト (System Integration Testing) テスト対象システムと他のシステム、外部サービスとのインターフェースのテストに焦点を当てるテストレベル。 2.2.1 システムテスト (System Testing) システムやプロダクト全体の振る舞いや能力の全般に焦点を当てるテストレベル。 2.2.1 テストレベル (Test Level) 系統的にまとめ、マネジメントしていくテスト活動のグループ。 2.2 テスト対象 (Test Object) テストをする対象のコンポーネントまたはシステム。 2.2.1 テストタイプ (Test Type) 特定の品質特性に関連するテスト活動のグループ。 2.2 ホワイトボックステスト (White-box Testing) 構造に基づき、システムの実装または内部構造からテストを導き出すテストタイプ。 2.2.2, 4.3 第 3章：静的テスト キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） 不正 (Anomaly) レビュー中に識別される、作業成果物中の誤り、不備、矛盾など。 3.2.2, 5.5 動的テスト (Dynamic Testing) ソフトウェアの実行を伴うテスト。静的テストと相互に補完し合う。 3.1.3 形式的レビュー (Formal Review) 厳密な定義プロセスに従い、インスペクションなど監査証跡が必要な場合に使用するレビュー種別。 3.2.4 非形式的レビュー (Informal Review) 定義されたプロセスに従わず、正式に文書化されたアウトプットを必要としないレビュー種別。 3.2.4 インスペクション (Inspection) 最も形式的なレビュー種別であり、不正を最大数発見することを主な目的とする。 3.2.4 レビュー (Review) 人手による確認を通じて作業成果物を評価する静的テスト技法。レビュープロセスは柔軟な枠組みを提供する。 3.1, 3.2.2 静的解析 (Static Analysis) ツールを使用して作業成果物を評価する静的テスト技法。コードの特定の欠陥を検出するために使用する。 3.1, 3.1.2 静的テスト (Static Testing) テスト対象のソフトウェアを実行せずに、人手やツールで評価するテスト。SDLC の初期段階で欠陥を検出できる。 3.1, 3.1.2 テクニカルレビュー (Technical Review) 技術的に適格なレビューアによって行われ、技術的な問題に関して合意を得て判断することを目的とするレビュー種別。 3.2.4 ウォークスルー (Walkthrough) 作成者が主導し、品質評価、不正の検出など多くの目的を達成できるレビュー種別。 3.2.4 第 4章：テスト分析と設計 キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） 受け入れ基準 (Acceptance Criteria) ユーザーストーリーの実装をステークホルダーが受け入れるために満たさなければならない条件。テスト条件とみなすことができる。 4.5.2 受け入れテスト駆動開発 (Acceptance Test-Driven Development, ATDD) テストファーストのアプローチで、顧客、開発担当者、テスト担当者などが共同でテストケースを作成する。 2.1.3, 4.5.3 ブラックボックステスト技法 (Black-box Test Technique) テスト対象の内部構造を参照することなく、仕様上の振る舞いの分析に基づく技法。 4.1, 4.2 境界値分析 (Boundary Value Analysis, BVA) 同値パーティションの境界を確認することに基づいた技法。2値 BVA と 3値 BVA がある。 4.2.2 ブランチカバレッジ (Branch Coverage) テストケースによって通したコード内のブランチの数を計測するカバレッジ指標。 4.3.2 チェックリストベースドテスト (Checklist-based Testing) チェックリストのテスト条件をカバーするようにテストケースを設計、実行する経験ベースの技法。 4.4.3 コラボレーションベースのテストアプローチ (Collaboration-based Test Approach) コラボレーションとコミュニケーションによる欠陥の回避に焦点を当てたアプローチ。 4.5 カバレッジ (Coverage) テストの徹底度を測る指標。 4.2, 4.3 カバレッジアイテム (Coverage Item) テスト技法を適用した際に、テストによって通過させる必要がある要素。 4.2, 4.3 デシジョンテーブルテスト (Decision Table Testing) 条件のさまざまな組み合わせがどのようにさまざまな結果をもたらすかを仕様化している要件の実装をテストするために使用する技法。 4.2.3 同値分割法 (Equivalence Partitioning, EP) データを同値パーティションに分割し、各パーティションから 1 つの値をテストするテストケースを作成する技法。 4.2.1 エラー推測 (Error Guessing) テスト担当者の知識に基づいて、エラー、欠陥、故障の発生を予測する経験ベースの技法。 4.4.1 経験ベースのテスト技法 (Experience-based Test Technique) テストケースの設計と実装にテスト担当者の知識と経験を効果的に利用する技法。 4.4 探索的テスト (Exploratory Testing) テスト担当者がテスト対象について学習しながら、テストケースを同時に設計、実行、評価する技法。 4.4.2 状態遷移テスト (State Transition Testing) システムの取り得る状態と有効な遷移をモデル化し、それに基づいてテストケースを導出する技法。 4.2.4 ステートメントカバレッジ (Statement Coverage) テストにより通過した実行可能なステートメント数を計測するカバレッジ指標。 4.3.1 テスト技法 (Test Technique) 比較的少ないながらも十分なテストケースのセットを体系的に開発するのに役立つ手法。 4.1 ホワイトボックステスト技法 (White-box Test Technique) テスト対象の内部構造や処理の分析に基づく技法。 4.1, 4.3 第 5章：テスト活動のマネジメント キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） 欠陥マネジメント (Defect Management) 報告された不正を発見から終結まで処理するためのワークフローを含むプロセス。 5.5 欠陥レポート (Defect Report) 報告された欠陥の処理・解決のための情報を提供する、または作業成果物の品質を追跡する目的で作成する文書。 5.5 開始基準 (Entry Criteria) ある活動を行うための事前条件を定義するもの。アジャイルでは「準備完了（Ready）の定義」とも呼ぶ。 5.1.3 終了基準 (Exit Criteria) 活動の完了を宣言するために何を達成しなければならないかを定義するもの。アジャイルでは「完了（done）の定義」とも呼ぶ。 5.1.3 プロダクトリスク (Product Risk) プロダクトの品質特性に関連するリスク。テストの深さと範囲に影響を与える。 5.2.2, 5.2.3 プロジェクトリスク (Project Risk) プロジェクトのマネジメントや統制に関連するリスク（例：納期遅れ、スキル不足）。 5.2.2 リスク (Risk) 顕在化することによって悪影響が生じる、潜在的な事象。 5.2.1 リスク分析 (Risk Analysis) リスク識別とリスクアセスメント（可能性と影響の決定）から構成される活動。 5.2.3 リスクアセスメント (Risk Assessment) 識別したリスクを分類し、リスクの可能性、リスクの影響、レベルを決定し、優先順位を付ける活動。 5.2.3 リスクコントロール (Risk Control) リスク軽減とリスクモニタリングから構成される、識別し評価したリスクに対応する手段。 5.2.4 リスク識別 (Risk Identification) リスクの包括的なリストを作成する活動。 5.2.3 リスクレベル (Risk Level) リスクの可能性とリスクの影響（損害）の二つの要素で表されるリスクの尺度。 5.2.1 リスクマネジメント (Risk Management) 組織が目的を達成する可能性を高め、プロダクトの品質を向上させることを可能にする活動。 5.2 リスク軽減 (Risk Mitigation) リスクアセスメントで提案された措置を実施し、リスクレベルを低減させること。 5.2.4 リスクモニタリング (Risk Monitoring) リスク軽減措置が効果的であることを確認し、新たなリスクを識別する活動。 5.2.4 リスクベースドテスト (Risk-based Testing) リスク分析とリスクコントロールに基づいてテスト活動を選択し、優先順位を付け、マネジメントしていくテストアプローチ。 5.2 テストアプローチ (Test Approach) テスト計画書の構成要素（テスト戦略やテストレベル、テストタイプ、テスト技法、テスト成果物など）。 5.1.1 テスト完了レポート (Test Completion Report) テストの特定の段階の完了時に作成し、テスト活動を要約するレポート。 5.3.2 テストコントロール (Test Control) テストモニタリングからの情報を用いて、必要な補正のアクションを提供する活動。 5.3 テストモニタリング (Test Monitoring) テストに関する情報を収集し、進捗を評価する活動。 5.3 テスト計画書 (Test Plan) テストプロジェクトの目的、リソース、プロセスを表す文書。 5.1.1 テスト計画 (Test Planning) テスト計画書を作成するプロセス。 5.1 テスト進捗レポート (Test Progress Report) テストの継続的なコントロールを支援するために定期的に作成するレポート。 5.3.2 テストピラミッド (Test Pyramid) 異なるテストレベルにおける粒度とテスト自動化の度合いを示すモデル。 5.1.6 テストの四象限 (Test Quadrants) テストレベルを、アジャイルソフトウェア開発における適切なテストタイプ、活動、技法、作業成果物に分類するモデル。 5.1.7 構成管理 (Configuration Management, CM) テストウェアなどの作業成果物を識別、コントロール、トラッキングするための規律。 5.4 第 6章：テストツール キーワード 概要（シラバス記載の学習対象の例） 参照節（ソースの該当箇所） テスト自動化 (Test Automation) テストツールを使用し、反復作業の削減や一貫性の向上などの利点をもたらす活動。ツールの導入、保守、トレーニングが必要となる。 6.2, 6.2.1"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/09/09/rails-8-1-release-notes-summary/",
title: "Rails 8.1 リリースノートまとめ",
image: "images/logo/rails_logo.svg",
date: "2025-09-09",
body: "Rails 8.1 リリースノートまとめ Rails 8.1 リリースノートについてまとめたものを備忘録として残しておく Rails 7 リリースノートまとめ Rails 7.1 リリースノートまとめ Rails 7.2 リリースノートまとめ Rails 8 リリースノートまとめ Rails 8.1 のリリースノートは以下の通り Rails 8.1 系での新機能および変更点 Railties rails credentials:fetch PATH コマンドが追加された フィクスチャで動的 ERB 式の代わりに静的 BCrypt パスワードダイジェストが生成されるようになった .gitignoreエントリが拡張され、すべてのキーファイルが無視されるようになった bin/setupに--reset オプションが追加された GitHub ActionsワークフローテンプレートのRuboCopジョブにRuboCopキャッシュ復元が追加された ActionMailerを使用しないアプリケーションで認証ジェネレータがメーラー関連ファイルの生成をスキップするようになった bin/ciが導入され、テスト、スタイルチェック、セキュリティ監査をローカルまたはクラウドで実行できるようになった 認証ジェネレータ実行時にセッションコントローラテストが生成されるようになった bin/bundler-auditとconfig/bundler-audit.ymlが追加され、アプリケーションgemの既知のセキュリティ問題を発見・管理できるようになった bin/bundlebinstubの生成が停止された SessionTestHelperモジュールが追加され、sign_in_as(user)とsign_outテストヘルパーが提供されるようになった 認証ジェネレータでパスワードリセットのレート制限が追加された rails new --minimalオプションが更新され、最近追加された機能が除外されるようになった アプリケーションレイアウトにapplication-nameメタデータが追加された ローカルでENVまたはcredentialsからsecret_key_baseが使用されるようになった 生成されたci.ymlファイルにRAILS_MASTER_KEYプレースホルダーが導入された 非標準環境でも Rails コンソールプロンプトがカラー化されるようになった 開発環境とテスト環境で YJIT が有効化されなくなった ポリシーが設定されている場合のみPermissionsPolicy::Middlewareが含まれるようになった Action Cable ActionCable::Channel#stream_for に複合チャネルを渡せるようになった 例: stream_for [ group, group.owner ] Redis のサブスクリプション接続識別子に nil を設定できるようになった Action Pack action_controller.loggerを nil または false に設定することで無効化できるようになった .md/.markdownが Markdown 拡張として追加され、デフォルトのmarkdown:レンダラーが追加された エンジンルート検査コマンドにヘッダーが追加された エラーページに「Copy as text」ボタンが追加された rate_limitメソッドにscope:オプションが追加された ActionDispatch::Executorでrack.response_finishedコールバックのサポートが追加された rescue_fromが呼び出されたときにログが生成されるようになった Rails 設定の hosts からのホストリダイレクトが許可されるようになった rate_limit.action_controller通知に追加のペイロードが含まれるようになった 組み込みヘルスコントローラーに JSON サポートが追加された ブラウザからクラッシュでソースファイルを開けるようになった クエリ文字列キーが値と同様に有効なエンコーディングかチェックされるようになった PublicExceptionsとDebugExceptionsで HEAD リクエストの空のボディが常に返されるようになった RFC 9111に従った HTTP Cache-Control リクエストディレクティブの包括的なサポートが追加された assert_in_body/assert_not_in_bodyがレスポンスボディ内のテキストをチェックする最も簡単な方法として追加された クッキー名が最大許可サイズの計算に含まれるようになった RFC 9111に従ったmust-understandディレクティブが実装された JSON レンダラーが HTML エンティティや Unicode 行区切り文字をエスケープしなくなった テストルートを挿入する前に遅延ルートセットが読み込まれるようになった レンダリング後に head が呼び出された場合にAbstractController::DoubleRenderErrorが発生するようになった Cookie Serializerがメッセージパックを使用する際にActive Support SafeBufferをシリアライズできるようになった Rails.application.reload_routes!がほぼすべてのルートをクリアする問題が修正された #resource または#resources に無効な :only または :except オプションが与えられた場合のArgumentErrorにリソース名が追加された 存在しないコントローラーを指すルートが 404 ではなく 500 を返すようになった ActionDispatch::Session::CacheStoreにcheck_collisionsオプションが追加された ExceptionWrapperでビルトインテンプレートとのバックトレース行のマッチングが改善された Mimeタイプ のシンボルでコンテンツタイプを設定できるようになった Action View preload_link_tagで生成される HTML と一致するように Link ヘッダーに fetchpriority が追加された preload_link_tagで生成される Link ヘッダーに CSP nonce が追加された current_page?がmethod:オプションで特定の HTTP メソッドとマッチできるようになった form_tag,token_tag,method_tagで生成される隠し入力から autocomplete=\u0026ldquo;off\u0026rdquo; が削除された button_to,check_box,select（multiple付き）,file_fieldフォームに含まれる隠しパラメータフィールドから autocomplete=\u0026ldquo;off\u0026rdquo; が削除された Action Viewテンプレート間の依存関係を追跡する戦略の設定が有効になった relative_time_in_wordsヘルパーが導入された nonce: falseが javascript_tag, javascript_include_tag, stylesheet_link_tag から nonce 属性を削除するようになった 無制限の数のオブジェクトから dom_id のような文字列を作成する dom_target ヘルパーが追加された collection_checkboxesが隠し\u0026lt;input\u0026gt;を生成する際にhtml_options[:form]が尊重されるようになった レイアウトが render に渡されるローカル変数にアクセスできるようになった テンプレートの strict locals に関連する引数エラーがActionView::StrictLocalsErrorを発生させるようになった ERB テンプレートまたは do-end ブロック内でエラーが発生した場合のマルチライン メソッドのエラーハイライトが改善された コンパイルされたテンプレートでソーステンプレートの終端を超えた行でエラーが発生した場合の ERB テンプレートエラーハイライトのクラッシュが修正された ERB テンプレートエラーハイライトの信頼性が向上し、ハイライトでの無限ループとクラッシュが修正され、代替 ERB ハンドラーの許容性が改善された hidden_fieldとhidden_field_tagがカスタム autocomplete 値を受け入れるようになった content_security_policy_nonce_directives設定オプションで指定されたディレクティブの影響を受けるタグに nonce を自動的に追加する新しい設定content_security_policy_nonce_autoが追加された Action Mailer deliver_all_laterが追加され、複数のメールを一度にエンキューできるようになった Active Record libpq \u0026gt;= 18とpg \u0026lt; 1.6.0の互換性問題により、cancel_any_running_queryでPG::Connection#cancelの呼び出しがスキップされるようになった 新しいデータベース設定オプションkeepalive,max_age、min_connectionsが導入され、 pool が max_connections にリネームされた LIMIT 検証がクエリ生成時から limit() が呼び出された時に移動された ActiveRecord::CheckViolationエラークラスがチェック制約違反用に追加された ActiveRecord::ExclusionViolationエラークラスが排他制約違反用に追加された filter_attributesでフィルタされた属性がfilter_parametersでもフィルタされるようになった connection.current_transaction.isolationAPIが現在のトランザクションの分離レベルをチェックできるようになった #mergeと#orまたは#andと属性と SQL 文字列の混合で不正なクエリが生成される問題が修正された スキーマダンパーが :ruby 形式でダンプする際にActiveRecord.dump_schemasを考慮するようになった update_column/update_columnsメソッドに :touch オプションが追加された Active Record バッチングが範囲を使用する際にさらに最適化された インデックスとテーブル名の長さ検証のエラーメッセージに現在の文字長が含まれるようになった PostgreSQL 用の rename_schema メソッドが追加された アソシエーションの非推奨化サポートが実装された PostgreSQL アダプタの create DB が locale_provider と locale をサポートするようになった PostgreSQL で ntuples を使用して row_count を populateするようになった 永続化されていないレコードが厳密に読み込まれた has_and_belongs_to_many アソシエーションに include? されるかどうかのチェックが修正された ブロック内のすべてのプールのトランザクション分離を変更する機能が追加された 順序に依存するファインダーメソッド（#first、#last）が順序値なしで呼び出された場合にActiveRecord::MissingRequiredOrderErrorが発生するようになった 多態性 belongs_to アソシエーションで :class_name が無効になった db:migrate:reset が複数データベースをサポートするようになった ActiveRecord::Resultに affected_rows が追加された 再試行可能な SqlLiterals を #where に渡すことができるようになった insert_all/upsert_allで主キーのデフォルトが設定されるようになった ActiveRecord::DatabaseConfigurations用のロードフックactive_record_database_configurationsが追加された SQLite クエリで boolean カラムに TRUE と FALSE が使用されるようになった サポートされる SQLite の最小バージョンが 3.23.0 に引き上げられた 割り当てられた Active Record がアソシエーションをルックアップできるようになった 暗号化が属性ごとにsupport_unencrypted_data: trueを設定することをサポートするようになった モデルジェネレータがデータベース接続なしでカラムタイプを検証できるようになった 署名付き ID 検証器がRails.application.message_verifiersで設定可能になった PostgreSQLのstructure_loadでextra_flagsが前置されるようになった implicit_order_columnで主キー/制約の追加をバイパスできるようになった データベース設定でschema_formatを設定できるようになった MySQL v8.0.0+ と MariaDB v10.6.0+でインデックスの無効化がサポートされた ActiveRecord::Relation#reverse_orderでimplicit_order_columnが尊重されるようになった SQLite3 用のActiveRecord::Resultにカラムタイプが追加された 読み取り専用ロールで悲観的ロックを使用した場合にActiveRecord::ReadOnlyErrorが発生するようになった Rails アプリケーション外で SQLite3Adapter の dbconsole メソッドを使用する問題が修正された ActiveRecord::PendingMigrationアクションで複数データベースのマイグレーションが修正された 接続エラーで冪等なアソシエーションクエリの自動再試行が有効になった sql.active_record 計装に allow_retry が追加された PostgreSQL と SQLite3 で JOIN を使用した UPDATE のサポートが改善された ActiveSupport::Testing::Parallelizationに before-fork フックが導入され、既存の接続がクリアされるようになった PoolConfig が接続クラスへの参照を保持しなくなった 非同期クエリを使用する際に SQL 通知が送信されない場合がある問題が修正された PostgreSQL でダンプされたスキーマキャッシュの読み込みクエリが排除された ActiveRecord::Coder::JSONがインスタンス化できるようになった アソシエーション内の永続化されていないレコードでinsert_all/upsert_allを使用することが非推奨になった index_exists?でカラム名がオプションになった sql.active_record通知のペイロード名がeager loadingで「SQL」から「#{model.name} Eager Load」に変更された 接続エラーで冪等な#exists?クエリの自動再試行が有効になった update_allとサポートされていないメソッドの併用が非推奨になった schema.rb内のテーブルカラムがアルファベット順にソートされるようになった スキーマダンパー用のバージョンフォーマッターが導入された シリアライズされた属性が比較可能としてマークできるようになった MySQLのデフォルト関数がカラムのnullabilityを変更する際に削除される問題が修正された SQLite拡張がconfig/database.ymlで設定できるようになった ActiveRecord::Middleware::ShardSelectorが細かいデータベース接続切り替えをサポートするようになった insert_all/upsert_all後にリレーションがリセットされるようになった 並列テストデータベースのサフィックスに_Nが使用されるようになった データベース接続が最近検証されたことを記憶するようになった 複数のレコードのキャッシュカウンターをリセットできるようになった sql.active_record通知にaffected_rowsが追加された グループ化された計算でsumが修正された データベースごとにトランザクションテストの有効/無効がサポートされるようになった URL 設定を使用する際に query_cache 値がキャストされるようになった NULLS NOT DISTINCTがUNIQUE CONSTRAINTとUNIQUE INDEXの両方で動作するようになった PG::UnableToSend: no connection to the serverが接続関連の例外として再試行可能になった Active Storage GCP メタデータサーバーへの不要な呼び出しが削除された ダイレクトアップロードの進行状況がサーバー処理時間を考慮するようになった ActiveStorage::Filename#to_strが#to_sに委譲されるようになった config.active_storage.checksum_implementationを通じて代替MD5実装のサポートが追加された Blob が関連する Attachment を自動保存しなくなった Active Model バリデーションコールバックに except_on: オプションが追加された ActiveRecord::NormalizationがActiveModel::Attributes::Normalizationにバックポートされた Active Support ActiveSupport::Cache::Store#namespace=と#namespaceが追加された 並列テスト実行用のparallel_worker_idヘルパーが作成された ActiveSupport::Cache::Strategy::LocalCache::Middlewareのキャッシュが更新可能になった ActiveSupport::EventReporter用のassert_events_reportedテストヘルパーが追加された ActiveSupport::TimeZone#standard_nameメソッドが追加された Rails.eventでアクセス可能なStructured Event Reporterが追加された ActiveSupport::Loggerが#freezeフレンドリーになった ActiveSupport::Gzip.compressが入力に基づいて決定論的になった ActiveSupport::BacktraceCleaner#clean_locationsメソッドが追加された CurrentAttributesとExecutionContextの状態管理がテストケースで改善された ActiveSupport::BacktraceCleaner#first_clean_locationメソッドが追加された FileUpdateCheckerとEventedFileUpdateCheckerが Gem.path の変更を無視するようになった ActiveSupport::BacktraceCleaner#first_clean_frameメソッドが追加された CurrentAttributesインスタンスが常にクリアされるようになった 並列テストでbefore_fork_hookのパブリック API が追加された 並列テストデータベースの作成をスキップする機能が実装された 最大キャッシュキーサイズの設定が可能になった ActiveSupport::Cache::RedisCacheStoreで非ブロッキング削除にUNLINKコマンドが使用されるようになった Cache#read_counterとCache#write_counterが追加された ActiveSupport::Testing::ErrorReporterAssertions#capture_error_reportsが導入された ActiveSupport::ErrorReporter#add_middlewareが導入された 実行ラッピングがすべての例外（Exceptionを含む）を報告するように変更された ActiveSupport::Testing::Parallelization.before_fork_hookでテストワーカーフォーク直前に呼び出されるコールバックの宣言が可能になった #freeze_timeテストヘルパーが日付または時間引数を受け入れるようになった ActiveSupport::JSONがオプションを受け入れるようになった ActiveSupport::Testing::NotificationAssertionsのassert_notificationがデフォルトでペイロードサブセットとマッチするようになった nil.to_query(\u0026quot;key\u0026quot;)がkeyを返すようになった ActiveSupport::Cache::RedisCacheStoreで :redis オプションが既に ConnectionPool の場合に Redis を ConnectionPool でラップしないようになった ERB::Util.tokenizeが ERB タグを含まない文字列で完全な入力文字列と :PLAIN トークンを返すように変更された ERB::Util.tokenizeでマルチバイト文字の前に ERB タグがある場合の不正なトークン化バグが修正された ActiveSupport::Testing::NotificationAssertionsモジュールがActiveSupport::Notificationsのテストを支援するために追加された ActiveSupport::CurrentAttributes#attributesが各呼び出しで新しいハッシュオブジェクトを返すようになった ActiveSupport::JSON.encodeがCIDR記法をサポートするようになった ActiveSupport::FileUpdateCheckerが多くのファイル拡張子をチェックする際に高速化された Active Job ActiveJob::Serializers::ObjectSerializers#klassメソッドがパブリックになった ActiveJob::Continuablez を使用してジョブを中断・再開できるようになった enqueue_after_transaction_commitが有効な場合の ActiveJob エンキューコールバックの呼び出しがコミット後に延期されるようになった ActiveJob::Base#retry_onと#discard_onにreport:オプションが追加された ActiveJob::ConfiguredJob#perform_laterがブロックを受け入れるようになった デシリアライゼーション時に以前にシリアライズされたジョブクラスが不明な場合により具体的なエラーが発生するようになった Action Text fill_in_rich_text_areaオプションが Capybara に転送されるようになった アタッチメントアップロードの進行状況がサーバー処理時間を考慮するようになった Trix 依存関係がベンダーファイルではなく action_text-trixgem で満たされるようになった ActionText::RichText#embedsの割り当てが before_save から before_validation に変更された Action Mailbox Mail::Message に reply_to_address 拡張メソッドが追加された 非推奨および削除された機能 Action Pack 以下が削除された パラメータ名の先頭の角括弧([])をスキップする機能 クエリ文字列のセミコロン(;)区切りのサポート 複数のパスに対するルート設定のサポート Rails.application.config.action_dispatch.ignore_leading_brackets が非推奨になった Active Record 以下が削除された SQLite3 アダプターの :retries オプション MySQL の以下のカラムメソッド :unsigned_float :unsigned_decimal Active Storage azure ストレージサービスが削除された Active Job 以下が削除された ActiveJob::Base.enqueue_after_transaction_commit を :never, :always, :default に設定するサポート Rails.application.config.active_job.enqueue_after_transaction_commit 内部の SuckerPunch アダプタ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/06/19/how-to-test-cookies-in-rspec/",
title: "RSpec で Cookie のテストを行う方法",
image: "images/logo/rails_logo.svg",
date: "2025-06-19",
body: "RSpec で Cookie のテストを行う方法 RSpec で Cookie のテストを行う方法を備忘録として残しておく 環境 ruby: 3.0.5 rails: 6.1.7 テスト方法 RSpec の Controller テストで Cookie のテストを行いたい場合、response.cookies[‘key’] で Cookieの内容を取得してテストする 例. Controller 側で以下のような Cookie を設定していた場合 def sample cookies[\u0026#34;sample\u0026#34;] = \u0026#39;ok\u0026#39; end RSpec 側は以下のようにして値のテストを行うことができる expect(response.cookies[\u0026#39;sample\u0026#39;]).to eq \u0026#39;ok\u0026#39;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/05/16/using-the-aws-sam-cli-for-lambda-local-debugging-in-a-serverless-configuration/",
title: "Serverless 構成で lambda ローカルデバッグ用に AWS SAM CLI を使用する",
image: "images/logo/aws_logo.svg",
date: "2025-05-16",
body: "Serverless 構成で lambda ローカルデバッグ用に AWS SAM CLI を使用する Serverless 構成で lambda ローカルデバッグ用に AWS SAM CLI を使用する方法を調査したものを備忘録として残しておく 環境 Infrastructure: AWS lambda: nodejs(20.X) Secret Manager RDS: PostgreSQL AWS API Gateway API Key あり AWS SAM CLI Docker Compose API 仕様書 OpenAPI 3.0 AWS SAM 環境について 必要なファイルの内、重要な部分のみ記載 フォルダ構成 ├── layers/ │ ├── package.json │ └── pg-layer.zip │ ├── scripts/ │ ├── create-pg-layer.sh │ ├── init-localstack.sh │ └── local-secret.json │ ├── .env ├── docker-compose.yml └── template.yaml 実際のファイル AWSTemplateFormatVersion: \u0026#39;2010-09-09\u0026#39; Transform: AWS::Serverless-2016-10-31 Globals: Function: Runtime: nodejs20.x Timeout: 30 MemorySize: 128 Environment: Variables: DB_NAME: !Sub \u0026#34;${DB_NAME}\u0026#34; DB_HOST: !Sub \u0026#34;${DB_HOST}\u0026#34; DB_USER: !Sub \u0026#34;${DB_USER}\u0026#34; DB_PORT: !Sub \u0026#34;${DB_PORT}\u0026#34; SECRET_NAME: !Sub \u0026#34;${SECRET_NAME}\u0026#34; IS_LOCAL: !Sub \u0026#34;${IS_LOCAL}\u0026#34; NODE_ENV: !Sub \u0026#34;${NODE_ENV}\u0026#34; AWS_ENDPOINT_SECRETS_MANAGER: !Sub \u0026#34;${AWS_ENDPOINT_SECRETS_MANAGER}\u0026#34; AWS_REGION: !Sub \u0026#34;${AWS_REGION}\u0026#34; AWS_ACCESS_KEY_ID: !Sub \u0026#34;${AWS_ACCESS_KEY_ID}\u0026#34; AWS_SECRET_ACCESS_KEY: !Sub \u0026#34;${AWS_SECRET_ACCESS_KEY}\u0026#34; AWS_SDK_LOAD_CONFIG: !Sub \u0026#34;${AWS_SDK_LOAD_CONFIG}\u0026#34; AWS_STS_REGIONAL_ENDPOINTS: !Sub \u0026#34;${AWS_STS_REGIONAL_ENDPOINTS}\u0026#34; AWS_NODEJS_CONNECTION_REUSE_ENABLED: !Sub \u0026#34;${AWS_NODEJS_CONNECTION_REUSE_ENABLED}\u0026#34; Resources: # API Gateway LocalApi: Type: AWS::Serverless::Api Properties: StageName: local Cors: AllowMethods: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; AllowHeaders: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; AllowOrigin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; Auth: ApiKeyRequired: true DefinitionBody: Fn::Transform: Name: AWS::Include Parameters: Location: ./docs/open_api.yml # Parameterized OpenAPI 3.0 file # Lambda Function GetUserDetailFunction: Type: AWS::Serverless::Function Properties: CodeUri: functions/getUserDetail/ Handler: index.handler Layers: - !Ref PgLayer Events: ApiEvent: Type: Api Properties: RestApiId: !Ref LocalApi Path: /users/{userId} Method: GET PgLayer: Type: AWS::Serverless::LayerVersion Properties: LayerName: pg-layer Description: PostgreSQL client for Node.js ContentUri: layers/pg-layer.zip CompatibleRuntimes: - nodejs20.x services: postgres: image: postgres:13 container_name: test-postgres environment: POSTGRES_DB: ${DB_NAME} POSTGRES_USER: ${DB_USER} POSTGRES_PASSWORD: ${DB_PASSWORD} ports: - \u0026#34;5432:5432\u0026#34; volumes: - postgres_data:/var/lib/postgresql/data healthcheck: test: [\u0026#34;CMD-SHELL\u0026#34;, \u0026#34;pg_isready -U postgres\u0026#34;] interval: 10s timeout: 5s retries: 5 localstack: image: localstack/localstack:latest ports: - \u0026#34;4566:4566\u0026#34; # LocalStack Gateway - \u0026#34;4510-4559:4510-4559\u0026#34; # External services port range environment: - DEBUG=${DEBUG} - DOCKER_HOST=${DOCKER_HOST} - LAMBDA_EXECUTOR=${LAMBDA_EXECUTOR} - PERSISTENCE=${PERSISTENCE} - SERVICES=${SERVICES} - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION} - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} volumes: - \u0026#34;${LOCALSTACK_VOLUME_DIR:-./volume}:/var/lib/localstack\u0026#34; - \u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34; - \u0026#34;./scripts/init-localstack.sh:/etc/localstack/init/ready.d/init-localstack.sh\u0026#34; - \u0026#34;./scripts/local-secret.json:/etc/localstack/local-secret.json\u0026#34; volumes: postgres_data: #!/bin/bash # LocalStackのエンドポイント ENDPOINT=\u0026#34;http://localhost:4566\u0026#34; # シークレット値を外部ファイルから読み込む SECRET_STRING=$(cat /etc/localstack/local-secret.json) # シークレットの作成 aws --endpoint-url=$ENDPOINT secretsmanager create-secret \\ --name local-secret \\ --description \u0026#34;Local development secret\u0026#34; \\ --secret-string \u0026#34;$SECRET_STRING\u0026#34; echo \u0026#34;LocalStack secrets initialized\u0026#34; { \u0026#34;password\u0026#34;: \u0026#34;postgres\u0026#34; } #!/bin/bash set -e LAYER_DIR=\u0026#34;layers/pg-layer\u0026#34; ZIP_FILE=\u0026#34;layers/pg-layer.zip\u0026#34; mkdir -p \u0026#34;$LAYER_DIR/nodejs\u0026#34; cp layers/package.json \u0026#34;$LAYER_DIR/nodejs/package.json\u0026#34; cd \u0026#34;$LAYER_DIR/nodejs\u0026#34; npm install --production cd ../../.. rm -f \u0026#34;$ZIP_FILE\u0026#34; cd \u0026#34;$LAYER_DIR\u0026#34; zip -r \u0026#34;../../$ZIP_FILE\u0026#34; . cd ../../ echo \u0026#34;pg-layer の作成が完了しました: $ZIP_FILE\u0026#34; rm -rf \u0026#34;$LAYER_DIR\u0026#34; # Only used for local debugging # DB DB_NAME=test_db DB_HOST=host.docker.internal DB_USER=postgres DB_PORT=5432 DB_PASSWORD=postgres # SecretsManager SECRET_NAME=local-secret # Lambda IS_LOCAL=true NODE_ENV=local AWS_ENDPOINT_SECRETS_MANAGER=http://host.docker.internal:4566 AWS_REGION=ap-northeast-1 AWS_ACCESS_KEY_ID=test AWS_SECRET_ACCESS_KEY=test AWS_SDK_LOAD_CONFIG=1 AWS_STS_REGIONAL_ENDPOINTS=regional AWS_NODEJS_CONNECTION_REUSE_ENABLED=1 # LocalStack DEBUG=1 DOCKER_HOST=unix:///var/run/docker.sock LAMBDA_EXECUTOR=docker PERSISTENCE=1 SERVICES=secretsmanager AWS_DEFAULT_REGION=ap-northeast-1 LOCALSTACK_VOLUME_DIR=./volume 使用方法 実施手順 $ docker-compose up -d Copy the DB in the Dev environment If the Layer is updated, do the following $ ./scripts/create-pg-layer.sh $ sam local start-api シークレットマネージャーに値が追加された場合 ローカルデバッグでは localstack を使用する scripts/local-secret.json を編集して、値を追加する docker-compose down \u0026amp; docker-compose up -d localstack の初期化スクリプトが実行され、シークレットマネージャーに値が追加される localstack のシークレットマネージャーに値が追加されたことを確認する $ docker-compose exec localstack bash $ aws --endpoint-url=http://localhost:4566 secretsmanager get-secret-value --secret-id local-secret"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/05/08/rails-8-what-to-check-if-you-get-a-403-error-in-rspec-requests-spec-when-using-docker/",
title: "Rails 8 で docker を使用している場合に rspec \u003e requests spec で 403 エラーが発生した場合の確認点について",
image: "images/logo/rails_logo.svg",
date: "2025-05-08",
body: "Rails 8 で docker を使用している場合に rspec \u003e requests spec で 403 エラーが発生した場合の確認点について Rails 8 で docker を使用している場合に rspec \u0026gt; requests spec で 403 エラーが発生した場合の確認点について調査したものを備忘録として残しておく 環境 ruby: 3.4.2 rails: 8.0.2 mode: API mode エラー内容 Rails 6 以降で追加された DNS リバインディングに関するエラーが発生している ※エラー内容と根本原因は異なるため注意 状況としては以下の通り Rails Server 起動しての実行は成功 docker-compose exec app bash bin/rails s -b 0.0.0.0 RSpec \u0026gt; Request 実行時に 403 エラーが発生 Request Spec 以外は成功 docker-compose exec app bash bin/rspec spec/requests/xxxx_spec.rb 下記の html が返却される \u0026lt;!-- 一部抜粋 --\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34; id=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;To allow requests to these hosts, make sure they are valid hostnames (containing only numbers, letters, dashes and dots), then add the following to your environment configuration:\u0026lt;/h2\u0026gt; \u0026lt;pre\u0026gt; config.hosts \u0026amp;lt;\u0026amp;lt; \u0026#34;www.example.com\u0026#34; \u0026lt;/pre\u0026gt; \u0026lt;p\u0026gt;For more details view: \u0026lt;a href=\u0026#34;https://guides.rubyonrails.org/configuring.html#actiondispatch-hostauthorization\u0026#34;\u0026gt;the Host Authorization guide\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; 確認点 Docker で使用している環境変数を確認する RAILS_ENV=development が設定されていないこと spec/rails_helper.rb を確認すると環境変数を設定してしまっている状態だと test 環境とならないようになっている そのため docker で環境を構築する際、環境変数として RAILS_ENV=development と設定していると test 環境として実行されないためエラーになる ENV[\u0026#39;RAILS_ENV\u0026#39;] ||= \u0026#39;test\u0026#39;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/04/14/rails-8-about-the-rails-new-command-options/",
title: "Rails 8 rails new コマンドのオプションについて",
image: "images/logo/rails_logo.svg",
date: "2025-04-14",
body: "Rails 8 rails new コマンドのオプションについて Rails 8 rails new コマンドのオプションについてまとめたものを備忘録として残しておく 環境 ruby: 3.4.2 rails: 8.0.2 mode: API mode 全オプション rails new -h で確認 Usage: rails new APP_PATH [options] Options: [--skip-namespace] # Skip namespace (affects only isolated engines) # Default: false [--skip-collision-check] # Skip collision check # Default: false -r, [--ruby=PATH] # Path to the Ruby binary of your choice # Default: /Users/kazuki_kawazoe/.rbenv/versions/3.4.2/bin/ruby -n, [--name=NAME] # Name of the app -m, [--template=TEMPLATE] # Path to some application template (can be a filesystem path or URL) -d, [--database=DATABASE] # Preconfigure for selected database # Default: sqlite3 # Possible values: mysql, trilogy, postgresql, sqlite3, mariadb-mysql, mariadb-trilogy -G, [--skip-git] # Skip git init, .gitignore and .gitattributes [--skip-docker] # Skip Dockerfile, .dockerignore and bin/docker-entrypoint [--skip-keeps] # Skip source control .keep files -M, [--skip-action-mailer] # Skip Action Mailer files [--skip-action-mailbox] # Skip Action Mailbox gem [--skip-action-text] # Skip Action Text gem -O, [--skip-active-record] # Skip Active Record files [--skip-active-job] # Skip Active Job [--skip-active-storage] # Skip Active Storage files -C, [--skip-action-cable] # Skip Action Cable files -A, [--skip-asset-pipeline] # Indicates when to generate skip asset pipeline -J, --skip-js, [--skip-javascript] # Skip JavaScript files [--skip-hotwire] # Skip Hotwire integration [--skip-jbuilder] # Skip jbuilder gem -T, [--skip-test] # Skip test files [--skip-system-test] # Skip system test files [--skip-bootsnap] # Skip bootsnap gem [--skip-dev-gems] # Skip development gems (e.g., web-console) [--skip-thruster] # Skip Thruster setup [--skip-rubocop] # Skip RuboCop setup [--skip-brakeman] # Skip brakeman setup [--skip-ci] # Skip GitHub CI files [--skip-kamal] # Skip Kamal setup [--skip-solid] # Skip Solid Cache, Queue, and Cable setup [--dev], [--no-dev], [--skip-dev] # Set up the application with Gemfile pointing to your Rails checkout [--devcontainer], [--no-devcontainer], [--skip-devcontainer] # Generate devcontainer files [--edge], [--no-edge], [--skip-edge] # Set up the application with a Gemfile pointing to the 8-0-stable branch on the Rails repository --master, [--main], [--no-main], [--skip-main] # Set up the application with Gemfile pointing to Rails repository main branch [--rc=RC] # Path to file containing extra configuration options for rails command [--no-rc] # Skip loading of extra configuration options from .railsrc file [--api], [--no-api], [--skip-api] # Preconfigure smaller stack for API only apps # Default: false [--minimal], [--no-minimal], [--skip-minimal] # Preconfigure a minimal rails app -j, --js, [--javascript=JAVASCRIPT] # Choose JavaScript approach # Default: importmap # Possible values: importmap, bun, webpack, esbuild, rollup -c, [--css=CSS] # Choose CSS processor. Check https://github.com/rails/cssbundling-rails for more options # Possible values: tailwind, bootstrap, bulma, postcss, sass -B, [--skip-bundle] # Don\u0026#39;t run bundle install [--skip-decrypted-diffs] # Don\u0026#39;t configure git to show decrypted diffs of encrypted credentials Runtime options: -f, [--force] # Overwrite files that already exist -p, [--pretend], [--no-pretend], [--skip-pretend] # Run but do not make any changes -q, [--quiet], [--no-quiet], [--skip-quiet] # Suppress status output -s, [--skip], [--no-skip], [--skip-skip] # Skip files that already exist Rails options: -h, [--help], [--no-help], [--skip-help] # Show this help message and quit -v, [--version], [--no-version], [--skip-version] # Show Rails version number and quit Description: The `rails new` command creates a new Rails application with a default directory structure and configuration at the path you specify. You can specify extra command-line arguments to be used every time `rails new` runs in the .railsrc configuration file in your home directory, or in $XDG_CONFIG_HOME/rails/railsrc if XDG_CONFIG_HOME is set. Note that the arguments specified in the .railsrc file don\u0026#39;t affect the default values shown above in this help message. You can specify which version to use when creating a new rails application using `rails _\u0026lt;version\u0026gt;_ new`. Examples: `rails new ~/Code/Ruby/weblog` This generates a new Rails app in ~/Code/Ruby/weblog. `rails _\u0026lt;version\u0026gt;_ new weblog` This generates a new Rails app with the provided version in ./weblog. `rails new weblog --api` This generates a new Rails app in API mode in ./weblog. `rails new weblog --skip-action-mailer` This generates a new Rails app without Action Mailer in ./weblog. Any part of Rails can be skipped during app generation. 不要そうなオプション(skip しても良さそうなオプション) \u0026ndash;skip-docker Skip Dockerfile, .dockerignore and bin/docker-entrypoint ここでいう Dockerfile は Deploy 用のため他ツールを使用する場合は不要 \u0026ndash;skip-asset-pipeline api モードではアセットは使用しないため不要 \u0026ndash;skip-javascript api モード では javascript は使用しないため不要 \u0026ndash;skip-hotwire api モード では Hotwire は使用しないため不要 \u0026ndash;skip-jbuilder jbuilder 以外の gem を使用する場合は不要 \u0026ndash;skip-test rspec 使用の場合は不要 \u0026ndash;skip-system-test rspec 使用の場合は不要 \u0026ndash;skip-thruster api モード では HTTP/2プロキシ「Thruster」は使用しないため不要 \u0026ndash;skip-kamal Deploy tool に他を使用する場合は不要 \u0026ndash;skip-devcontainer devcontainer を使用しない場合は不要 \u0026ndash;skip-bundle bundle install をさせたくない場合は不要 必要そうなオプション(skip しない方が良さそうなオプション) \u0026ndash;skip-git Skip git init, .gitignore and .gitattributes git 関連のファイルを作成しない \u0026ndash;skip-keeps Skip source control .keep files .keep ファイルを作成しない 空のディレクトリを Git に含めるために必要 \u0026ndash;skip-rubocop ruby コードの静的チェック \u0026ndash;skip-brakeman ソースコードに、SQL インジェクションや XSS 等の脆弱性がないかを解析してくれる Gem \u0026ndash;skip-ci GitHub CI files を生成しない \u0026ndash;skip-active-record Active Record を使用しない \u0026ndash;skip-active-storage Active Storage を使用しない FE からファイルアップロードを行う場合は必要 \u0026ndash;skip-bootsnap bootsnap を使用しない bootsnap は起動を高速化させるので必要 \u0026ndash;skip-dev-gems Gemfile 内の development 記載をしない development の gem を自分で記載する場合は必要 \u0026ndash;skip-active-job Active Job(Queue 機能)を使用する場合は必要 \u0026ndash;skip-action-cable Active Cable(Websocket 通信)を使用する場合は必要 \u0026ndash;skip-solid 以下の機能を使用する場合は必要 Solid Cache(Cache 機能) Queue(Queue 機能) Cable(Websocket 通信) \u0026ndash;skip-action-mailer Action Mailer を使用する場合は必要 \u0026ndash;skip-action-mailbox Action Mailbox を使用する場合は必要 \u0026ndash;skip-action-text Action Text を使用する場合は必要 使用例 App Name: myapp 以下の option を指定 \u0026ndash;api \u0026ndash;ruby-version 3.4.2 \u0026ndash;rails-version 8.0.2 \u0026ndash;database=postgresql \u0026ndash;skip-docker \u0026ndash;skip-asset-pipeline \u0026ndash;skip-javascript \u0026ndash;skip-hotwire \u0026ndash;skip-jbuilder \u0026ndash;skip-test \u0026ndash;skip-system-test \u0026ndash;skip-thruster \u0026ndash;skip-kamal \u0026ndash;skip-bundle rails new myapp --api --ruby-version 3.4.2 --rails-version 8.0.2 --database=postgresql --skip-docker --skip-asset-pipeline --skip-javascript --skip-hotwire --skip-jbuilder --skip-test --skip-system-test --skip-thruster --skip-ci --skip-kamal --skip-bundle"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/04/03/how-cursor-works-with-confluence-and-jira/",
title: "Cursor と Confluence および Jira との連携方法",
image: "images/logo/cursor_logo.png",
date: "2025-04-03",
body: "Cursor と Confluence および Jira との連携方法 Model Context Protocol(以下、MCP)を使用して連携する ※MCP Atlassianを参照 連携方法 MCP Atlassian の導入 API トークンの取得 Atlassian Account にアクセス API トークンを作成 コピー 環境変数(例. ATLASSIAN_API_TOKEN)に設定 uv のインストール brew install uv uvx mcp-atlassian Cursor の MCP設定 { \u0026#34;mcpServers\u0026#34;: { \u0026#34;mcp-atlassian\u0026#34;: { \u0026#34;command\u0026#34;: \u0026#34;uvx\u0026#34;, \u0026#34;args\u0026#34;: [ \u0026#34;mcp-atlassian\u0026#34;, \u0026#34;--confluence-url=https://\u0026lt;\u0026lt;Your Domain Name\u0026gt;\u0026gt;.atlassian.net/wiki\u0026#34;, \u0026#34;--confluence-username=\u0026lt;\u0026lt;Your Mail Address\u0026gt;\u0026gt;\u0026#34;, \u0026#34;--confluence-token=\u0026lt;\u0026lt;ATLASSIAN_API_TOKEN\u0026gt;\u0026gt;\u0026#34;, \u0026#34;--jira-url=https://wlc-poc.atlassian.net\u0026#34;, \u0026#34;--jira-username=\u0026lt;\u0026lt;Your Mail Address\u0026gt;\u0026gt;\u0026#34;, \u0026#34;--jira-token=\u0026lt;\u0026lt;ATLASSIAN_API_TOKEN\u0026gt;\u0026gt;\u0026#34; ] } } } 利用方法 Issueの取得：「JIRA から \u0026laquo;Ticket 番号\u0026raquo; について教えて」"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/03/19/rails-8-release-notes-summary/",
title: "Rails 8 リリースノートまとめ",
image: "images/logo/rails_logo.svg",
date: "2025-03-19",
body: "Rails 8 リリースノートまとめ Rails 8 リリースノートについてまとめたものを備忘録として残しておく Rails 7 リリースノートまとめ Rails 7.1 リリースノートまとめ Rails 7.2 リリースノートまとめ Rails 8 系での新機能および変更点 Kamal（Docker コンテナのデプロイツール） Kamalという Docker コンテナを本番環境に簡単にデプロイするツールが同梱されるようになった ※Rails アプリケーションのデプロイで使用されていた Capistrano をコンテナように置き換えたツールのイメージ Thruster（HTTP/2 プロキシサーバ） Rails アプリケーションの Docker ファイルに、Thruster と呼ばれるプロキシサーバの設定が含まれ、Puma の前段に配置するようになった これにより、Nginx など別の Web サーバーを用意する必要がなくなる Thrusterの機能 HTTP/2のサポート Let\u0026rsquo;s Encrypt による自動化された TLS 証明書の管理 公開アセット（JavaScript、CSS、画像など）の HTTP キャッシュ X-Sendfile のサポートと圧縮 Solid Cable Solid Cable によって Redis を使用せずに WebSocket を使用したリアルタイム機能を使用することができる Solid Cache Solid Cache によってメモリを使用した Redis や Memcached よりも長期間にわたって大容量のアプリケーションのデータのキャッシュを行うことができる Solid Queue Solid Queue は、Redis を使用した Sidekiq や Resque といったジョブ実行システムと同様に、単純なジョブのエンキューや実行だけでなく、遅延実行、同期処理の制御、定期（繰り返し）実行、キューの停止、優先順序づけなど本格的な実用に耐えるものが実現できる Solid Queue では、以下の4種類のアクター（Actor）がプロセスとして実行される ※英語で複数形になっているものは複数実行され、The がついているものは1つのみ実行 ワーカ（Workers） キューからジョブを取り出し実行を行う solid_queue_ready_executions テーブルに登録されたジョブに対して操作を行う ディスパッチャ（Dispatchers） スケジューリングされたジョブを選択し、ワーカが実行できるようにする solid_queue_scheduled_executions テーブルから solid_queue_ready_executions テーブルにジョブを移動する スケジューラ（The scheduler） 定期（繰り返し）実行の際にジョブをエンキューする スーパーバイザ（The supervisor） ワーカとディスパッチャを設定に基づいて実行し、動作状況をハートビートで監視し、必要に応じて停止と起動を行う Propshaft で Sprockets を置き換え Rails 8 で新しく生成されたアプリケーションのアセットパイプラインが、これまで長い間使用されていた Sprockets から Propshaft に変更された Propshaft はアセットのロードパスの設定と、Digest の付与、開発用のサーバーといった単純な機能に絞ることで、実装としてはよりシンプルで高速に動作する 認証機能の生成 bin/rails generate authentication で認証機能の生成が可能になった これらは Rails 5 で導入された has_secure_password や Rails 7.1 で導入された authenticate_by を拡張したもので、以下のコードを生成する Sessionモデル ユーザID, トークン, IPアドレス, User-Agent などセッション関連 Userモデル メールアドレス, ダイジェスト化されたパスワードなどユーザ関連 PasswordsController と view ファイル, PasswordsMailer パスワードリセット機能 SessionsController と view ファイル ログイン、ログアウトの機能 Authentication concern セッション情報を元に、ログイン関連メソッドをコントローラに提供するモジュール 上記に関連したマイグレーションファイル Devise など外部のライブラリを使用しなくても、簡単なパスワードログイン機能を Rails だけで実現可能となった"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/03/19/rails-7-2-release-notes-summary/",
title: "Rails 7.2 リリースノートまとめ",
image: "images/logo/rails_logo.svg",
date: "2025-03-19",
body: "Rails 7.2 リリースノートまとめ Rails 7.2 リリースノートについてまとめたものを備忘録として残しておく 他バージョンのリリースノートまとめ Rails 7 リリースノートまとめ Rails 7.1 リリースノートまとめ Rails 7.2 系での新機能および変更点 開発用のDockerコンテナ（devコンテナ） Docker コンテナをフル機能の開発環境として使用できる dev コンテナと呼ばれる新機能が追加されました。 デフォルトでは、以下のようなコンテナが含まれています。 データベース（SQLite, PostgreSQL, MySQL, MariaDBなど） Active Storage Redis システムテスト（Headless Chrome） 新規のアプリケーションで dev コンテナを使用するには、rails new でアプリケーションを生成する際に --devcontainer オプションを追加する rails new myapp --devcontainer YJIT のデフォルト化 YJIT は Ruby の JIT コンパイラで、有効にすることで Rails アプリケーションのパフォーマンスを大幅に向上させ、レイテンシを15〜25%改善することができる Rails 7.2 で Ruby 3.3以上を使用している場合は、YJIT がデフォルトで有効となる 無効にする場合は以下の設定が必要 Rails.application.config.yjit = false ブラウザのバージョンの Guard デフォルト化 アプリケーション生成時に以下の設定が Application Controller に追加されるようになった allow_browser versions: :modern リクエストのヘッダの User-Agent に基づいて、モダンブラウザ（WebP画像、Import maps、CSS入れ子などの機能をサポート）のアクセスを許可する ※古いバージョンのブラウザに対しては許可せず、HTTP status 406を返す ※User-Agent がリクエストのヘッダに含まれない場合もアクセスを許可するため注意 以下のように特定のブラウザの特定のバージョン以上を各コントローラ毎に許可することも可能 # Safari 16.4+、Firefox 121+をサポートし、IEをサポートしない allow_browser versions: { safari: 16.4, firefox: 121, ie: false } また、only オプションをつけることによって、コントローラの特定のアクションのみ、ブラウザのバージョンの制限をかけることも可能 # showアクションで、Opera 104+、Chrome 119+をサポートする allow_browser versions: { opera: 104, chrome: 119 }, only: :show PWA(Progressive Web Application)ファイルのデフォルト化 Rails で PWA アプリケーションを作成できるように、デフォルトで manifest.json ファイルと service-worker.js ファイルを app/view/pwa 配下に生成する ※ルーティングも追加される get \u0026#34;service-worker\u0026#34; =\u0026gt; \u0026#34;rails/pwa#service_worker\u0026#34;, as: :pwa_service_worker get \u0026#34;manifest\u0026#34; =\u0026gt; \u0026#34;rails/pwa#manifest\u0026#34;, as: :pwa_manifest よく使用される GEM のデフォルト化 RuboCop Rrakeman GitHub CI ワークフローのデフォルト化 デフォルトで GitHub CI ワークフローが作成されるようになり、.github/workflows/ci.yml, .github/dependabot.ymlファイルが生成されるようになった ※rails new を実行する際に、\u0026ndash;skip-ciオプションをつけることで、ファイルの生成をスキップすることができる 初期状態では GitHub CI でテストと、前述した RuboCop と Brakeman を実行することができる ※テストで RSpec を実行したり、カスタマイズを行う場合は .github/workflows/ci.yml ファイルを修正する必要があり DBのトランザクションへのコールバックの追加 DB のトランザクションのコミットやロールバックの前後にコールバックを指定して、実行できるようになった 具体的には、ActiveRecord::Base.transaction メソッドが、ActiveRecord::Transaction オブジェクトをブロックに渡すようになった 例えば transaction.after_commit でトランザクション内でコールバックを指定できるようになった 例. トランザクション内でメール送信のジョブをエンキューするのではなく、トランザクションのコミットを行ってから、エンキューを行う Article.transaction do |transaction| article.update(published: true) transaction.after_commit do PublishNotificationMailer.with(article: article).deliver_later end end DB のトランザクション内でジョブをエンキューした場合はトランザクション外で実行 トランザクション内にジョブをエンキューするコードを含む場合に、自動で上記の after_commit コールバックを使用して、コミット後に処理を行うようになった ※コミットに失敗した場合は、エンキューされたジョブは破棄される Topic.transaction do topic = Topic.create NewTopicNotificationJob.perform_later(topic) end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/03/18/rails-7-1-release-notes-summary/",
title: "Rails 7.1 リリースノートまとめ",
image: "images/logo/rails_logo.svg",
date: "2025-03-18",
body: "Rails 7.1 リリースノートまとめ Rails 7.1 リリースノートについてまとめたものを備忘録として残しておく 他バージョンのリリースノートまとめ Rails 7 リリースノートまとめ Rails 7.1 系での新機能および変更点 Dockerfileの生成 新規アプリケーションで Dockerfile が自動生成されるようになった 複合プライマリキーのサポート 複合プライマリキーがサポートされ、マイグレーションや、Active Record のクエリメソッドなど Rails のアプリケーション全般で使用できるようになった DB に複合プライマリキーを使用したテーブルを作成するには、以下のようにマイグレーションの change_table の primary_key: オプションにカラム名の配列を渡す class CreateBooks \u0026lt; ActiveRecord::Migration[7.1] def change create_table :books, primary_key: [:store_id, :sku] do |t| t.integer :store_id t.string :sku t.string :name t.text :description end end end 使用例 クエリメソッド Product.find([3, \u0026#34;XYZ12345\u0026#34;]) # store_id: 3, sku: \u0026#34;XYZ12345\u0026#34;を指定 Product.where(Product.primary_key =\u0026gt; [[1, \u0026#34;ABC98765\u0026#34;], [7, \u0026#34;ZZZ11111\u0026#34;]]) # store_id: 3, sku: \u0026#34;XYZ12345\u0026#34;とstore_id: 7, sku: \u0026#34;ZZZ11111\u0026#34; Product.first # SELECT * FROM products ORDER BY products.store_id ASC, products.sku ASC LIMIT 1 モデルの関連 従来の id ではなく、複合プライマリキーを使用するには、has_many や belongs_to などのオプションで query_constraints を使用する class Author \u0026lt; ApplicationRecord self.primary_key = [:first_name, :last_name] has_many :books, query_constraints: [:first_name, :last_name] end class Book \u0026lt; ApplicationRecord belongs_to :author, query_constraints: [:author_first_name, :author_last_name] end ActiveRecord::Base.normalizes によるモデルの属性の正規化 メールアドレスの小文字化、電話番号のハイフン削除などの正規化を、モデル内で行えるようになった 使用例 class User \u0026lt; ApplicationRecord normalizes :email, with: -\u0026gt; email { email.downcase } normalizes :tel, with: -\u0026gt; tel { tel.delete(\u0026#34;-\u0026#34;) } end 上記の定義を行っている場合、以下のような正規化が行われる user = User.new(email: \u0026#39;SMITH@example.com\u0026#39;, tel: \u0026#39;090-1234-5678\u0026#39;) =\u0026gt; #\u0026lt;User:0x0000000108142a68 id: nil, email: \u0026#34;smith@example.com\u0026#34;, tel: \u0026#34;09012345678\u0026#34;, created_at: nil, updated_at: nil\u0026gt; Active Record の where, exists? に正規化前の値を渡すと正規化されて SQL が実行される User.where(email: \u0026#39;SMITH@example.com\u0026#39;) #=\u0026gt; User Load (0.2ms) SELECT \u0026#34;users\u0026#34;.* FROM \u0026#34;users\u0026#34; WHERE \u0026#34;users\u0026#34;.\u0026#34;email\u0026#34; = ? /* loading for pp */ LIMIT ? [[\u0026#34;email\u0026#34;, \u0026#34;smith@example.com\u0026#34;], [\u0026#34;LIMIT\u0026#34;, 11]] User.exists?(email: \u0026#39;SMITH@example.com\u0026#39;) #=\u0026gt; User Exists? (0.3ms) SELECT 1 AS one FROM \u0026#34;users\u0026#34; WHERE \u0026#34;users\u0026#34;.\u0026#34;email\u0026#34; = ? LIMIT ? [[\u0026#34;email\u0026#34;, \u0026#34;smith@example.com\u0026#34;], [\u0026#34;LIMIT\u0026#34;, 1]] Active Record に非同期クエリのメソッドが追加 Active Recordに、以下の async_ で始まる各種の非同期クエリのメソッドが追加された async_count async_sum async_minimum async_maximum async_average async_pluck async_pick async_ids async_find_by_sql async_count_by_sql 使用例 メソッド呼出後に、クエリの実行状態を持つ ActiveRecord::Promise オブジェクトを返す 実行が完了している場合は、#value メソッドで値を取得することができる promise = Book.where(published: true).async_count promise.value # =\u0026gt; 5 Trilogy MySQL アダプタのサポート trilogy は従来の mysql2 アダプタに比べて高速で軽量に動作する 使用例 development: adapter: trilogy database: blog_development pool: 5 ジョブの一括エンキュー（perform_all_later） 複数のジョブを一括でエンキューする、 perform_all_later が ActiveJob のクラスメソッドとして追加された このメソッドを使用することで、 Sidekiq など、Active Job のアダプタで enqueue_all メソッドを使用できるジョブ実行システムの場合では、個別にジョブをエンキューすることなく効率よくジョブを実行できるようになった。 ※上記の場合 Active Job のエンキュー用のコールバックが実行されないことに注意 また、enqueue_all を使用できない場合は、ループで個別のジョブをエンキューを行う ActiveSupport::MessagePack のサポート Ruby オブジェクトをシリアライズする際に従来は JSON や Marshal のシリアライザを使用していた 今回のアップデートでより高速で、データが軽量になる msgpack gem を使用した ActiveSupport::MessagePackが利用できるようにようになった Rails アプリケーションの各種設定でも、以下の例のように :message_pack が指定できるようになりました。 Autoload の強化 config.autoload_lib config.autoload_lib_once lib ディレクトリ以下にあるクラスやモジュールを自動読み込みする設定が追加された 以下のように指定することで、lib/assets, lib/tasks, lib/generators 以外の lib ディレクトリ内のファイルにある、モジュールやクラスが起動時に自動読み込みされ、起動中にファイルの変更を行った場合は（モデルやコントローラと同様に）リロードされる config.autoload_lib(ignore: %w[assets tasks generators]) autoload_lib の代わりに config.autoload_lib_once を使用した場合は、起動時に1度だけ読み込まれ、変更後はリロードされない"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/03/18/rails-7-release-notes-summary/",
title: "Rails 7 リリースノートまとめ",
image: "images/logo/rails_logo.svg",
date: "2025-03-18",
body: "Rails 7 リリースノートまとめ Rails 7 リリースノートについてまとめたものを備忘録として残しておく Rails 7 系での新機能および変更点 JavaScriptフロントエンドの刷新 ESM（ECMAScript modules）や import maps を使用し、Node.js をインストールせずにモダンな JavaScript が利用可能 ※デフォルトでは Hotwire, Stimulus, Turbo がインストールされる CSS Bundling 以下のサポートが追加 Tailwind CSS PostCSS アプリケーション新規作成時に指定可能 rails new myapp --css tailwind 既存に追加する場合は Gemfile に以下を追加して gem \u0026#39;cssbundling-rails\u0026#39; 以下のコマンドを実行することでインストールおよび初期設定が可能 bin/bundle install bin/rails css:install:tailwind Active Recordの実行時暗号化機能 データの暗号化が可能になった bin/rails db:encryption:init コマンドを実行してランダムなキーを生成 結果をbin/rails credentials:editで開いたエディタの画面に貼り付けて保存 Model で以下のように指定 class User \u0026lt; ApplicationRecord encrypts :name end Spring のデフォルト値の変更 大規模なアプリケーション以外では Spring があまり意味をなさなくなったため、デフォルトがオフに変更 Sass と CSS ジェネレータの非標準化 最近では CSS フレームワークを使うようになっているため、Sass は使用されなくなってきている そのため sass-rails Gem が標準では Gemfile に含まれないようになった また、自動生成される CSS ファイルも拡張子が .scss ではなく .css のファイルになった そして、モデルごとに CSS ファイルを生成しないようになった ActiveRecordの新機能 以下が追加および変更になった ActiveRecord::Base.normalizes generates_token_for async Active Jobの変更 perform_all_later が追加された Bunのサポート JavaScript ランタイムとして Bun がサポートされた 非同期のSQLクエリによる結果の取得 ActiveRecord::Relation#load_async を使用することで、非同期で SQL クエリを実行できる def index @articles = Article.per(params[:per]).page(params[:page]).load_async @categories = Category.active.load_async end バルクインサートで自動的にタイムスタンプを記録できる Active Record の insert_all や upsert_all メソッドなどでバルクインサート・バルクアップサートでレコードを作成、更新する際に created_at や updated_at などのタイムスタンプを自動でセットできるようになった 使用する場合は Methods の record_timestamps オプションに true を渡す必要がある Article.insert_all([{ title: \u0026#34;What\u0026#39;s new in Rails 7\u0026#34; }], record_timestamps: true) Active Recordに in_order_of メソッドが追加 レコードを指定した順番で取得できる in_order_of メソッドが Active Record に追加された 例. ユーザID が1, 5, 3の順番になるように取得 User.in_order_of(:id, [1, 5, 3]) # SELECT \u0026#34;users\u0026#34;.* FROM \u0026#34;users\u0026#34; ORDER BY FIELD(\u0026#34;users\u0026#34;.\u0026#34;id\u0026#34;, 1, 5, 3) SQLクエリにコメント自動付与 SQLのクエリに自動的にアプリケーション側の情報（Active Recordのメソッドが呼び出された、コントローラやジョブなどを含む）をコメントとして付与する機能 設定方法 config.active_record.query_log_tags = [ :application, :controller, :action, :job ] 出力例 class BooksController \u0026lt; ApplicationController def index @books = Book.all end end #=\u0026gt; SELECT * FROM books /*application:MyApp;controller:books;action:index*/ Active Record に structurally_compatible? メソッドが追加 Active Record のリレーションが他のリレーションとデータの構造が同じかどうかチェックする structurally_compatible? メソッドが追加 Book.where(\u0026#34;id = 1\u0026#34;).structurally_compatible?(Book.where(\u0026#34;author_id = 3\u0026#34;)) # =\u0026gt; true Book.joins(:categories).structurally_compatible?(Book.where(\u0026#34;id = 1\u0026#34;)) # =\u0026gt; false weekday_options_for_select ヘルパメソッドの追加 曜日選択の option タグを生成する weekday_options_for_select タグが追加された weekday_options_for_select # =\u0026gt; \u0026#34;\u0026lt;option value=\\\u0026#34;Sunday\\\u0026#34;\u0026gt;Sunday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;Monday\\\u0026#34;\u0026gt;Monday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;Tuesday\\\u0026#34;\u0026gt;Tuesday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;Wednesday\\\u0026#34;\u0026gt;Wednesday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;Thursday\\\u0026#34;\u0026gt;Thursday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;Friday\\\u0026#34;\u0026gt;Friday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;Saturday\\\u0026#34;\u0026gt;Saturday\u0026lt;/option\u0026gt;\u0026#34; weekday_options_for_select(nil, index_as_value: true) # =\u0026gt; \u0026#34;\u0026lt;option value=\\\u0026#34;0\\\u0026#34;\u0026gt;Sunday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;1\\\u0026#34;\u0026gt;Monday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;2\\\u0026#34;\u0026gt;Tuesday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;3\\\u0026#34;\u0026gt;Wednesday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;4\\\u0026#34;\u0026gt;Thursday\u0026lt;/option\u0026gt;\\n\u0026lt;option value=\\\u0026#34;5\\\u0026#34;\u0026gt;Friday\u0026lt;/option\u0026gt;\\n # \u0026lt;option value=\\\u0026#34;6\\\u0026#34;\u0026gt;Saturday\u0026lt;/option\u0026gt;\u0026#34; button_to が HTTP メソッドとして PATCH を使用するように変更 以前のバージョンでは、 button_to タグは HTTP メソッドとして、 POST を使用されていた Rails 7 からは PATCH を使用するようになったため、以前の挙動に合わせるには、button_to メソッドのオプションとして、method: :post を渡す必要がある Active Storage の画像処理で使用されるライブラリの変更 Active Storage で画像処理に使われる Gem は、以前のバージョンでは mini_magick を使用していたが、Rails 7 からは vips に変更された"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/03/14/tips-on-tbls/",
title: "Tbls についての Tips",
image: "images/logo/tbls_logo.png",
date: "2025-03-14",
body: "Tbls についての Tips Tbls についての Tipsを備忘録として残しておく 環境 OS: macOS 15.3 手順 Tbls について 実際の DB に接続してテーブル定義書を生成してくれるツール 様々な形式(markdown, Excel 等)で生成してくれる ※詳細は Tbls を参照 設定ファイルについて # # @see https://github.com/k1LoW/tbls # # Data Source Name ## @see https://github.com/k1LoW/tbls#dsn # dsn: postgres://\u0026lt;\u0026lt;user\u0026gt;\u0026gt;:\u0026lt;\u0026lt;pass\u0026gt;\u0026gt;@localhost:5432/\u0026lt;\u0026lt;dbname\u0026gt;\u0026gt; # To connect with SSL mode disabled # dsn: postgres://\u0026lt;\u0026lt;user\u0026gt;\u0026gt;:\u0026lt;\u0026lt;pass\u0026gt;\u0026gt;@localhost:5432/\u0026lt;\u0026lt;dbname\u0026gt;\u0026gt;?sslmode=disable # DSN configuration values should be found in the .env file TBLS_DSN # Disable output of schema data # Default is false disableOutputSchema: false format: # Adjust the column width of Markdown format table # Default is false adjust: true # Sort the order of table list and columns # Default is false sort: false # Display sequential numbers in table rows # Default is false number: false # The comments for each table in the Tables section of the index page will display the text up to the first double newline (first paragraph). # Default is false showOnlyFirstParagraph: true # Hide table columns without values # Default is false hideColumnsWithoutValues: false # It can be boolean or array # hideColumnsWithoutValues: [\u0026#34;Parents\u0026#34;, \u0026#34;Children\u0026#34;] er: # Skip generation of ER diagram # Default is false skip: false # ER diagram image format (`png`, `jpg`, `svg`, `mermaid`) # Default is `svg` format: mermaid # Add table/column comment to ER diagram # Default is false comment: false # Hide relation definition from ER diagram # Default is false hideDef: true # Show column settings in ER diagram. If this section is not set, all columns will be displayed (default). showColumnTypes: # Show related columns related: true # Show primary key columns primary: true # Distance between tables that display relations in the ER # Default is 1 distance: 1 # ER diagram (png/jpg) font (font name, font file, font path or keyword) # Default is \u0026#34;\u0026#34; ( system default ) font: \u0026#34;\u0026#34; detectVirtualRelations: enabled: true strategy: default # Exclude tables exclude: - goose_db_version docPath: docs/ja/ comments: - table: mst_books tableComment: |- 書籍情報を管理するテーブル columnComments: name: 書籍名 TBLS_DSN=postgres://postgres:postgres@localhost:5432/olbdb?sslmode=disable 出力ファイルの上書きについて # markdown tbls doc --config .tbls.yml --rm-dist # Excel tbls out --config .tbls.yml -t xlsx -o schema.xlsx DSN の設定について ローカルで実施する場合は以下のどちらかで可能 Port Forwarding ※推奨 ローカルに各環境からテーブル定義のみインポートして実行 mkdocs との連携 S3 等にアップロードして公開する場合は、mkdocs と連携して公開することも可能 site_name: \u0026#34;DB Schema Tables\u0026#34; docs_dir: docs theme: name: material language: ja features: - search.suggest - search.highlight - search.share extra_css: - assets/stylesheets/extra.css extra_javascript: - assets/javascripts/custom.js plugins: - search - i18n: default_language: ja languages: ja: name: 日本語 build: true en: name: English build: true markdown_extensions: - pymdownx.highlight: anchor_linenums: true line_spans: __span pygments_lang_class: true - pymdownx.inlinehilite - pymdownx.snippets - pymdownx.superfences: custom_fences: - name: mermaid class: mermaid format: !!python/name:pymdownx.superfences.fence_code_format nav: - Home: README.md - 日本語/Japanese: - テーブル一覧: ja/README.md - English: - Table List: en/README.md babel==2.17.0 backrefs==5.9 certifi==2025.7.9 charset-normalizer==3.4.2 click==8.2.1 colorama==0.4.6 ghp-import==2.1.0 mkdocs-i18n==0.4.6 idna==3.10 Jinja2==3.1.6 Markdown==3.8.2 MarkupSafe==3.0.2 mergedeep==1.3.4 mkdocs==1.6.1 mkdocs-get-deps==0.2.0 mkdocs-glightbox==0.4.0 mkdocs-material==9.6.15 mkdocs-material-extensions==1.3.1 packaging==25.0 paginate==0.5.7 pathspec==0.12.1 platformdirs==4.3.8 py==1.11.0 Pygments==2.19.2 pymdown-extensions==10.16 python-dateutil==2.9.0.post0 PyYAML==6.0.2 pyyaml_env_tag==1.1 requests==2.32.4 six==1.17.0 urllib3==2.5.0 watchdog==6.0.0"
},
{
url: "https://kkawazoe.github.io/amp/blog/2025/01/07/how-to-configure-terminal-ghostty/",
title: "Terminal Ghostty の設定方法",
image: "images/logo/ghostty_logo.png",
date: "2025-01-07",
body: "Terminal Ghostty の設定方法 Terminal Ghostty の設定方法について調査した結果を備忘録として残しておく 環境 OS: macOS 14.7 手順 Ghostty のセットアップ フォントのインストール brew install --cask font-monaspace # Hack Nerd Font brew install font-hack-nerd-font # HackGen brew install font-hackgen # HackGen Nerd brew install font-hackgen-nerd 以下のコマンドを実行する brew install --cask ghostty mkdir -p ~/.config/ghostty vim ~/.config/ghostty/config config ファイルを修正する 設定値については参考を参照 theme = iTerm2 Pastel Dark Background font-family = HackGen35 Console NF font-size = 16 macos-non-native-fullscreen = true macos-titlebar-proxy-icon = hidden macos-titlebar-style = tabs window-padding-x = 20 window-padding-y = 20 # クイックターミナルの位置を画面下部に設定 quick-terminal-position = \u0026quot;bottom\u0026quot; # クイックターミナルを表示するスクリーンを設定 (メインスクリーン) quick-terminal-screen = \u0026quot;main\u0026quot; # アニメーション時間を設定（0で即時表示） quick-terminal-animation-duration = 0 # グローバルホットキーを設定 keybind = \u0026quot;global:ctrl+cmd+`=toggle_quick_terminal\u0026quot; Ghostty チートシート キーバインディング 内容 ⌘+T 新規タブ作成 ⌘+[ or ⌘+] タブを移動 ⌘+D 横にスプリット ⇧+⌘+D 縦にスプリット ⌘+[ or ⌘+] スプリットを移動 ⇧+⌘+↵ スプリットをズーム、ズームアウト option+click クリックしたところにカーソルを合わせられます テーマのプレビュー ghostty +list-themes"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/12/24/how-to-make-a-part-of-a-columns-of-type-jsonb-a-search-condition-in-postgresql/",
title: "PostgreSQL で jsonb 型のカラムの一部を検索条件にする方法",
image: "images/logo/postgre_sql_logo.svg",
date: "2024-12-24",
body: "PostgreSQL で jsonb 型のカラムの一部を検索条件にする方法 PostgreSQL で jsonb 型のカラムの一部を検索条件にする方法を備忘録として残しておく 詳細は公式を参照 方法 以下の DB 構成およびレコードの場合 Books Table id field: SERIAL type ※Primary Key value1: 1 value2: 2 options field: JSONB type value1: {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;aaa\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;bbb\u0026rdquo;} value2: {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;ccc\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;ddd\u0026rdquo;} SELECT options-\u0026gt;\u0026gt;\u0026#39;key_2\u0026#39; FROM books WHERE options-\u0026gt;\u0026gt;\u0026#39;key_1\u0026#39; = \u0026#39;ccc\u0026#39;; #=\u0026gt; \u0026#39;ddd\u0026#39; 以下の DB 構成およびレコードの場合(配列) Books Table id field: SERIAL type ※Primary Key value1: 1 value2: 2 options field: JSONB type value: [{\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;aaa\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;bbb\u0026rdquo;}, {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;ccc\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;ddd\u0026rdquo;}] value: [{\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;eee\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;fff\u0026rdquo;}, {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;ggg\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;hhh\u0026rdquo;}] SELECT options-\u0026gt;\u0026gt;\u0026#39;key_2\u0026#39; FROM books, JSONB_ARRAY_ELEMENTS(options) option WHERE option-\u0026gt;\u0026gt;\u0026#39;key_1\u0026#39; = \u0026#39;ccc\u0026#39;; #=\u0026gt; \u0026#39;ddd\u0026#39;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/12/11/how-to-update-some-columns-of-type-jsonb-in-postgresql/",
title: "PostgreSQL で jsonb 型のカラムの一部を更新する方法",
image: "images/logo/postgre_sql_logo.svg",
date: "2024-12-11",
body: "PostgreSQL で jsonb 型のカラムの一部を更新する方法 PostgreSQL で jsonb 型のカラムの一部を更新する方法を備忘録として残しておく 方法 以下の DB 構成および更新前のレコードの場合 Book Table id field: SERIAL type ※Primary Key value: 1 options field: JSONB type value: {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;aaa\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;bbb\u0026rdquo;} UPDATE book SET options = options || \u0026#39;{\u0026#34;key_1\u0026#34;: \u0026#34;ccc\u0026#34;}\u0026#39;, WHERE id = 1; 更新後 Book Table id field: SERIAL type ※Primary Key value: 1 options field: JSONB type value: {\u0026ldquo;key_1\u0026rdquo;: \u0026ldquo;ccc\u0026rdquo;, \u0026ldquo;key_2\u0026rdquo;: \u0026ldquo;bbb\u0026rdquo;}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/11/22/how-to-sort-numeric-strings/",
title: "数値文字列の並び替え方法",
image: "images/logo/nodejs_logo.svg",
date: "2024-11-22",
body: "数値文字列の並び替え方法 数値文字列の並び替え方法を備忘録として残しておく 方法 localeCompare メソッドの option numeric を使用する 例. 数値以外の文字を含むパターン Before Sort [\u0026ldquo;v1.0\u0026rdquo;, \u0026ldquo;v2.1\u0026rdquo;, \u0026ldquo;v1.4\u0026rdquo;, \u0026ldquo;v2.0\u0026rdquo;, \u0026ldquo;v1.11.3\u0026rdquo;, \u0026ldquo;v1.1.4\u0026rdquo;, \u0026ldquo;v1.1.1\u0026rdquo;] After Sort [\u0026ldquo;v2.1\u0026rdquo;, \u0026ldquo;v2.0\u0026rdquo;, \u0026ldquo;v1.11.3\u0026rdquo;, \u0026ldquo;v1.4\u0026rdquo;, \u0026ldquo;v1.1.4\u0026rdquo;, \u0026ldquo;v1.1.1\u0026rdquo;, \u0026ldquo;v1.0\u0026rdquo;] 数値以外の文字を含まないパターン Before Sort [\u0026ldquo;1.0\u0026rdquo;, \u0026ldquo;2.1\u0026rdquo;, \u0026ldquo;1.4\u0026rdquo;, \u0026ldquo;2.0\u0026rdquo;, \u0026ldquo;1.11.3\u0026rdquo;, \u0026ldquo;1.1.4\u0026rdquo;, \u0026ldquo;1.1.1\u0026rdquo;] After Sort [\u0026ldquo;2.1\u0026rdquo;, \u0026ldquo;2.0\u0026rdquo;, \u0026ldquo;1.11.3\u0026rdquo;, \u0026ldquo;1.4\u0026rdquo;, \u0026ldquo;1.1.4\u0026rdquo;, \u0026ldquo;1.1.1\u0026rdquo;, \u0026ldquo;1.0\u0026rdquo;] 実際のコード"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/11/21/solution-if-you-want-to-keep-amazon-rds-stopped/",
title: "長期間使用していない AWS Lambda の inactive 状態を active 状態にする方法",
image: "images/logo/aws_logo.svg",
date: "2024-11-21",
body: "長期間使用していない AWS Lambda の inactive 状態を active 状態にする方法 長期間使用していない AWS Lambda の inactive 状態を active 状態にする方法を備忘録として残しておく 事象 関数が数週間アイドルのままの場合、Inactive 状態になり、その状態で関数を呼び出すとエラーになる 詳細は以下を参照 AWS Lambda関数の状態の追跡 対象の洗い出し 以下のスクリプトを AWS CLI にて使用することで対象の洗い出しが行える #!/bin/sh aws --profile \u0026lt;\u0026lt;プロフィール名\u0026gt;\u0026gt; lambda list-functions --region \u0026lt;\u0026lt;リージョン名\u0026gt;\u0026gt; --query \u0026#39;Functions[?starts_with(FunctionName, `\u0026lt;\u0026lt;関数名プレフィックス\u0026gt;\u0026gt;`) == `true`].FunctionName\u0026#39; \u0026gt; lambda_list.json lambda_names=`jq -r .[] lambda_list.json` for lambda_name in $lambda_names; do aws --profile \u0026lt;\u0026lt;プロフィール名\u0026gt;\u0026gt; lambda get-function --output text --function-name $lambda_name --query \u0026#39;Configuration.[FunctionName, State, LastUpdateStatus]\u0026#39; | sort -k 1 | column -t -s \u0026#34;`printf \u0026#39;\\t\u0026#39;`\u0026#34; done 解消方法 inactive の状態で lambda を実行するとエラーになるがしばらくすると active 状態となり実行可能となる もしくは、以下のスクリプトを AWS Console 上で実行することで inactive =\u0026gt; active に状態を更新できる publish-version(※1)で active 状態に更新されない場合は invoke(※2)に切り替えて実施する #!/bin/bash -eu all_lambda_name_list=() inactive_lambda_name_list=() # 最初にアカウント上のすべての関数名を取得 function get_all_lambda_name_list() { echo \u0026#34;【Start get_all_lambda_name_list】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; readonly lambda_list=$(aws lambda list-functions \\ | jq -r \u0026#39;.Functions\u0026#39;) len=$(echo $lambda_list | jq length) for i in $( seq 0 $(($len - 1)) ); do all_lambda_name_list+=($(echo $lambda_list | jq -r .[$i].FunctionName)) done echo \u0026#34;【End get_all_lambda_name_list】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; } # 関数が state = Active かどうかの判定 function is_lambda_active() { local lambda_name=$1 local state=$(aws lambda get-function-configuration \\ --function-name $lambda_name \\ | jq -r \u0026#39;.State\u0026#39;) if [ $state = \u0026#34;Active\u0026#34; ]; then echo \u0026#34;true\u0026#34; else echo \u0026#34;false\u0026#34; fi } # Active でない関数のみを抽出 function filter_inactive_resources() { echo \u0026#34;【Start filter_inactive_resources】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; for lambda_name in ${all_lambda_name_list[@]}; do is_active=$(is_lambda_active $lambda_name) if [ \u0026#34;${is_active}\u0026#34; = \u0026#34;false\u0026#34; ]; then echo $lambda_name inactive_lambda_name_list+=($lambda_name) fi done echo \u0026#34;【End filter_inactive_resources】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; } # Active でない関数に対して publish-version を実行する function publish_lambda() { echo \u0026#34;【Start publish_lambda】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; if [ ${#inactive_lambda_name_list[@]} -eq 0 ]; then echo \u0026#34;there is no lambda to publish\u0026#34; return 0 fi for lambda_name in ${inactive_lambda_name_list[@]}; do echo \u0026#34;now publishing ${lambda_name}\u0026#34; aws lambda publish-version --function-name $lambda_name # ※1 # aws lambda invoke --function-name $lambda_name lambda_invoke.log # ※2 aws lambda wait function-active --function-name $lambda_name # 関数が Active になるまで待機 done echo \u0026#34;【End publish_lambda】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; } echo \u0026#34;【Start Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; get_all_lambda_name_list filter_inactive_resources publish_lambda echo \u0026#34;【End Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; AWS CLI で実行する場合は以下を参考にする publish-version(※1)で active 状態に更新されない場合は invoke(※2)に切り替えて実施する #!/bin/sh # Shared AWS_PROFILE_PREFIX={AWS プロファイルのプレフィックス} #自分の設定に書き換える LOG_FOLDER=log LOG_FILE=${LOG_FOLDER}/make_active_all_lambda.log all_lambda_name_list=() inactive_lambda_name_list=() read -p \u0026#34;Which environment connect to? (dev/stg/prd): \u0026#34; input_environment # Check the environment case \u0026#34;${input_environment}\u0026#34; in \u0026#34;dev\u0026#34; | \u0026#34;stg\u0026#34; | \u0026#34;prd\u0026#34;) echo \u0026#34;Connecting to ${environment}environment...\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 if [ $input_environment = \u0026#34;prd\u0026#34; ]; then # AWS MFA Authentication aws-mfa --profile=${AWS_PROFILE_PREFIX}-${input_environment} fi;; *) echo \u0026#34;Please enter the correct environment.\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 echo \u0026#34;【End Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 exit;; esac # アカウント内全ての関数名を取得 function get_all_lambda_name_list() { readonly lambda_list=$(aws lambda --profile=${AWS_PROFILE_PREFIX}-${input_environment} list-functions \\ | jq -r \u0026#39;.Functions\u0026#39;) len=$(echo $lambda_list | jq length) for i in $( seq 0 $(($len - 1)) ); do all_lambda_name_list+=($(echo $lambda_list | jq -r .[$i].FunctionName)) done } # 関数の state == Active かどうかを返す function is_lambda_active() { local lambda_name=$1 local state=$(aws lambda --profile=${AWS_PROFILE_PREFIX}-${input_environment} get-function-configuration \\ --function-name $lambda_name \\ | jq -r \u0026#39;.State\u0026#39;) if [ $state = \u0026#34;Active\u0026#34; ]; then echo \u0026#34;true\u0026#34; else echo \u0026#34;false\u0026#34; fi } # 関数の state == Active でないものを抽出 function filter_inactive_resources() { echo \u0026#34;== following lambda is inactive ==\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 for lambda_name in ${all_lambda_name_list[@]}; do is_active=$(is_lambda_active $lambda_name) if [ \u0026#34;${is_active}\u0026#34; = \u0026#34;false\u0026#34; ]; then echo $lambda_name inactive_lambda_name_list+=($lambda_name) fi done echo \u0026#34;== that\u0026#39;s all ==\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 } # 関数を Active にする function publish_lambda() { if [ ${#inactive_lambda_name_list[@]} -eq 0 ]; then echo \u0026#34;there is no lambda to publish\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 return 0 fi for lambda_name in ${inactive_lambda_name_list[@]}; do echo \u0026#34;now publishing ${lambda_name}\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 aws lambda --profile=${AWS_PROFILE_PREFIX}-${input_environment} publish-version --function-name $lambda_name # ※1 # aws lambda --profile=${AWS_PROFILE_PREFIX}-${input_environment} invoke --function-name $lambda_name ${LOG_FOLDER}/lambda_invoke.log \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # ※2 aws lambda --profile=${AWS_PROFILE_PREFIX}-${input_environment} wait function-active --function-name $lambda_name # 関数が Active になるまで待つ done } echo \u0026#34;【Start Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 get_all_lambda_name_list filter_inactive_resources publish_lambda echo \u0026#34;【End Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/11/12/how-to-filter-by-mail-address-except-aliases-in-gmail/",
title: "Gmail でエイリアスを除くメールアドレスでフィルターをかける方法",
image: "images/logo/gmail_logo.svg",
date: "2024-11-12",
body: "Gmail でエイリアスを除くメールアドレスでフィルターをかける方法 Gmail でエイリアスを除くメールアドレスでフィルターをかける方法を備忘録として残しておく 方法 「\u0026quot;」で囲んだ上で「@」を半角空白に置換してフィルターをかける 例. メールアドレス: mail-address@gmail.com =\u0026gt; \u0026quot;mail-address gmail.com\u0026quot;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/11/05/how-to-compile-dmarc-reports-on-your-own/",
title: "DMARC Reports を自前で集計する方法",
image: "images/logo/gas_logo.svg",
date: "2024-11-05",
body: "DMARC Reports を自前で集計する方法 DMARC Reports を自前で集計する方法を備忘録として残しておく 方法 GAS(Google Apps Script) を使用して集約する 新規で Spread Sheet を作成 「拡張機能」\u0026gt;「Apps Script」を選択 「ファイル」\u0026gt;「コード.gs」のデフォルトで記載されているソースを削除して以下を貼り付ける let today = new Date(); let targetDate = new Date(today); let nextDate = new Date(today); targetDate.setDate(today.getDate() - 1); nextDate.setDate(targetDate.getDate() + 1); const folderId = '\u0026lt;\u0026lt;Folder ID\u0026gt;\u0026gt;'; // レポートファイルを保存する親フォルダIDを指定 const sheetId = '\u0026lt;\u0026lt;Sheet ID\u0026gt;\u0026gt;'; // レポートを出力するスプレッドシートIDを指定 // 実行日の前日のメールを検索 // DMARC レポートを取得できる検索条件を指定する const query = 'From:noreply-dmarc-support@google.com after:' + Utilities.formatDate(targetDate, Session.getScriptTimeZone(), 'yyyy/MM/dd') + ' before:' + Utilities.formatDate(nextDate, Session.getScriptTimeZone(), 'yyyy/MM/dd'); function executeAll(){ saveAttachmentsFromEmails(); parseDMARCReports(); calculateAndAppendHeaderFromTotals(); } function saveAttachmentsFromEmails() { // 日付のフォーマットをYYYYMMDDに変換 let formattedDate = Utilities.formatDate(targetDate, Session.getScriptTimeZone(), 'yyyyMMdd'); let threads = GmailApp.search(query); let parentFolder = DriveApp.getFolderById(folderId); if (threads.length === 0) { return; } // 日付別のフォルダを作成 let dateFolder = parentFolder.createFolder(formattedDate); let totalAttachments = threads.reduce((sum, thread) =\u0026gt; sum + thread.getMessages().reduce((sum, message) =\u0026gt; sum + message.getAttachments().length, 0), 0); let processedAttachments = 0; for (let i = 0; i \u0026lt; threads.length; i++) { let messages = threads[i].getMessages(); for (let j = 0; j \u0026lt; messages.length; j++) { let attachments = messages[j].getAttachments(); for (let k = 0; k \u0026lt; attachments.length; k++) { let attachment = attachments[k]; let file = dateFolder.createFile(attachment); Logger.log('File saved: ' + file.getName()); // ZIPファイルの解凍処理 if (attachment.getContentType() === 'application/zip') { let zipBlob = attachment.copyBlob(); let unzippedFiles = Utilities.unzip(zipBlob); for (let m = 0; m \u0026lt; unzippedFiles.length; m++) { dateFolder.createFile(unzippedFiles[m]); Logger.log('Unzipped file saved: ' + unzippedFiles[m].getName()); } // ZIPファイル自体は削除する file.setTrashed(true); } // GZファイルの解凍処理 else if (attachment.getContentType() === 'application/gzip' || attachment.getName().endsWith('.gz')) { let gzBlob = attachment.copyBlob(); gzBlob.setContentType(\u0026quot;application/x-gzip\u0026quot;); let decompressedData = Utilities.ungzip(gzBlob); let gzFileName = attachment.getName().replace('.gz', ''); let decompressedBlob = Utilities.newBlob(\u0026quot;\u0026quot;, 'application/xml', gzFileName).setDataFromString(decompressedData.getDataAsString(), \u0026quot;UTF8\u0026quot;);; dateFolder.createFile(decompressedBlob); Logger.log('Decompressed file saved: ' + gzFileName); // GZファイル自体は削除する file.setTrashed(true); } processedAttachments++; let progress = ((processedAttachments / totalAttachments) * 100).toFixed(2); Logger.log('Progress: ' + progress + '%'); } } } } function parseDMARCReports() { let parentFolder = DriveApp.getFolderById(folderId); let spreadsheet = SpreadsheetApp.openById(sheetId); let formattedDate = Utilities.formatDate(targetDate, Session.getScriptTimeZone(), 'yyyyMMdd'); let dateFolder = parentFolder.getFoldersByName(formattedDate); let folder = dateFolder.hasNext() ? dateFolder.next() : null; if (!folder) { Logger.log('Folder for ' + formattedDate + ' does not exist.'); return; } // 新しいシートを作成 ※左から3番目にシートを作成 // 既にシートが存在する場合は追記 let sheet = spreadsheet.getSheetByName(formattedDate) || spreadsheet.insertSheet(formattedDate, 2); // シートのヘッダーを設定 let headers = ['Source IP', 'Count', 'DMARC', 'Disposition', 'DKIM', 'SPF', 'Envelope To', 'Envelope From', 'Header From', 'DKIM Result', 'SPF Result']; sheet.appendRow(headers); let files = folder.getFiles(); while (files.hasNext()) { let file = files.next(); if (file.getMimeType() === 'text/xml') { let xmlContent = file.getBlob().getDataAsString(); let document = XmlService.parse(xmlContent); let root = document.getRootElement(); // 解析ロジック let records = root.getChildren('record'); let rowsData = []; for (let i = 0; i \u0026lt; records.length; i++) { let record = records[i]; let row = record.getChild('row'); let identifiers = record.getChild('identifiers'); let auth_results = record.getChild('auth_results'); let sourceIp = row.getChildText('source_ip'); let count = row.getChildText('count'); let disposition = row.getChild('policy_evaluated').getChildText('disposition'); let dkim = row.getChild('policy_evaluated').getChildText('dkim'); let spf = row.getChild('policy_evaluated').getChildText('spf'); let dmarc = (dkim === 'pass' || spf === 'pass') ? 'OK' : 'NG'; let envelopeTo = identifiers ? identifiers.getChildText('envelope_to') : ''; let envelopeFrom = identifiers ? identifiers.getChildText('envelope_from') : ''; let headerFrom = identifiers ? identifiers.getChildText('header_from') : ''; let dkimResultNode = auth_results.getChild('dkim'); let spfResultNode = auth_results.getChild('spf'); let dkimResult = dkimResultNode ? dkimResultNode.getChildText('result') : ''; let spfResult = spfResultNode ? spfResultNode.getChildText('result') : ''; let rowData = [sourceIp, count, dmarc, disposition, dkim, spf, envelopeTo, envelopeFrom, headerFrom, dkimResult, spfResult]; rowsData.push(rowData); } if (rowsData.length \u0026gt; 0) { sheet.getRange(sheet.getLastRow() + 1, 1, rowsData.length, headers.length).setValues(rowsData); } } } } function calculateAndAppendHeaderFromTotals() { let spreadsheet = SpreadsheetApp.openById(sheetId); let formattedDate = Utilities.formatDate(targetDate, Session.getScriptTimeZone(), 'yyyyMMdd'); let sheet = spreadsheet.getSheetByName(formattedDate); if (!sheet) { Logger.log('Sheet for ' + formattedDate + ' does not exist.'); return; } let data = sheet.getDataRange().getValues(); let headerFromTotals = {}; // 集計処理 for (let i = 1; i \u0026lt; data.length; i++) { // ヘッダー行をスキップするためにiを1から開始 let cValue = data[i][2]; // C列の値 let bValue = data[i][1]; // B列の値 let hValue = data[i][8]; // H列の値 let dValue = data[i][3]; // D列の値 if (!headerFromTotals[hValue]) { headerFromTotals[hValue] = { passTotal: 0, failTotal: 0, noneCount: 0, quarantineCount: 0, rejectCount: 0 }; } if (cValue === 'OK') { headerFromTotals[hValue].passTotal += bValue; } else { headerFromTotals[hValue].failTotal += bValue; } // D列の値をカウント if (dValue === 'quarantine') { headerFromTotals[hValue].quarantineCount += bValue; } else if (dValue === 'reject') { headerFromTotals[hValue].rejectCount += bValue; } else if (dValue === 'none') { headerFromTotals[hValue].noneCount += bValue; } } // 結果をスプレッドシートに書き込む let resultSheet = spreadsheet.getSheetByName('Results') || spreadsheet.insertSheet('Results'); if (resultSheet.getLastRow() === 0) { resultSheet.appendRow(['Header From', 'Date', 'Pass Total', 'Fail Total', 'Success Rate', 'None Count', 'Quarantine Count', 'Reject Count', 'Quarantine + Reject Rate']); } for (let headerFrom in headerFromTotals) { let passTotal = headerFromTotals[headerFrom].passTotal; let failTotal = headerFromTotals[headerFrom].failTotal; let successRate = Math.floor((passTotal / (passTotal + failTotal)) * 10000) / 100; // 切り捨て let successRateStr = successRate.toFixed(2) + '%'; // 小数点第2位まで表示 let noneCount = headerFromTotals[headerFrom].noneCount; let quarantineCount = headerFromTotals[headerFrom].quarantineCount; let rejectCount = headerFromTotals[headerFrom].rejectCount; let quarantineRejectRate = Math.floor(((quarantineCount + rejectCount) / failTotal) * 10000) / 100; // 切り捨て let quarantineRejectRateStr = Number.isNaN(quarantineRejectRate) ? '0.00%' : quarantineRejectRate.toFixed(2) + '%'; // 小数点第2位まで表示 resultSheet.appendRow([headerFrom, formattedDate, passTotal, failTotal, successRateStr, noneCount, quarantineCount, rejectCount, quarantineRejectRateStr]); } } 「トリガー」\u0026gt;「トリガーを追加」ボタンを押下 以下の設定でトリガーを追加する 実行する関数を選択: executeAll 実行するデプロイを選択: Head イベントのソースを選択: 時間主導型 時間ベースのトリガーのタイプを選択: 日付ベースのタイマー 時間の間隔を選択（時間）: 実行したい時刻を指定 エラー通知設定: 任意の設定を指定"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/10/29/solution-if-you-want-to-keep-amazon-rds-stopped/",
title: "Amazon RDS を停止させたままにしたい場合の解決法",
image: "images/logo/aws_logo.svg",
date: "2024-10-29",
body: "Amazon RDS を停止させたままにしたい場合の解決法 Amazon RDS は一時停止した場合、最大7日間までしか停止できない しかし停止させたままにしたい状況が発生したため調査を行なった その際のまとめを備忘録として残しておく 解決案 Lambda 関数を使用する 公式推奨 EventBridge を使用する どちらかというと夜間休日止めるのに最適 実際の手順 Lambda 関数を使用する IAM \u0026gt; ポリシー を選択 以下でポリシーを作成 { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Sid\u0026#34;: \u0026#34;VisualEditor0\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;rds:StartDBCluster\u0026#34;, \u0026#34;rds:StopDBCluster\u0026#34;, \u0026#34;rds:ListTagsForResource\u0026#34;, \u0026#34;rds:DescribeDBInstances\u0026#34;, \u0026#34;rds:StopDBInstance\u0026#34;, \u0026#34;rds:DescribeDBClusters\u0026#34;, \u0026#34;rds:StartDBInstance\u0026#34; ], \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; } ] } IAM \u0026gt; ロール を選択 以下でロールを作成 信頼できるエンティティタイプを選択: AWS サービス またはサービスを選択してユースケースを表示: Lambda ポリシー: 手順 2 で作成したポリシー RDS \u0026gt; データベース \u0026gt; \u0026laquo;該当の DB インスタンス\u0026raquo; を選択 以下の様にタグを設定 autostart: yes autostop: yes Lambda \u0026gt; 関数 を選択 以下の設定で関数を作成 オプション: 一から作成 関数名: 任意 ランタイム: Python 3.* アーキテクチャ: x86_64 デフォルトの実行ロールの変更: 手順 4 で作成したロール コード \u0026gt; [コードソース]エディタでサンプルコードを削除して次のコードを入力 import boto3 rds = boto3.client(\u0026#39;rds\u0026#39;) def lambda_handler(event, context): #Start DB Instances dbs = rds.describe_db_instances() for db in dbs[\u0026#39;DBInstances\u0026#39;]: #Check if DB instance stopped. Start it if eligible. if (db[\u0026#39;DBInstanceStatus\u0026#39;] == \u0026#39;stopped\u0026#39;): try: GetTags=rds.list_tags_for_resource(ResourceName=db[\u0026#39;DBInstanceArn\u0026#39;])[\u0026#39;TagList\u0026#39;] for tags in GetTags: #if tag \u0026#34;autostart=yes\u0026#34; is set for instance, start it if(tags[\u0026#39;Key\u0026#39;] == \u0026#39;autostart\u0026#39; and tags[\u0026#39;Value\u0026#39;] == \u0026#39;yes\u0026#39;): result = rds.start_db_instance(DBInstanceIdentifier=db[\u0026#39;DBInstanceIdentifier\u0026#39;]) print (\u0026#34;Starting instance: {0}.\u0026#34;.format(db[\u0026#39;DBInstanceIdentifier\u0026#39;])) except Exception as e: print (\u0026#34;Cannot start instance {0}.\u0026#34;.format(db[\u0026#39;DBInstanceIdentifier\u0026#39;])) print(e) if __name__ == \u0026#34;__main__\u0026#34;: lambda_handler(None, None) デプロイする 関数の概要 \u0026gt; トリガーを追加 を選択 EventBridge (CloudWatch Events) を選択し、[新しいルールを作成] を作成 ルール名: 任意 スケジュール式: RDS メンテナンス時間の 30 分前等を指定(cron 式) 例. cron(30 21 ? * SUN *) 手順 7 〜 12 を行い RDS 自動停止用の関数を作成 import boto3 rds = boto3.client(\u0026#39;rds\u0026#39;) def lambda_handler(event, context): #Stop DB instances dbs = rds.describe_db_instances() for db in dbs[\u0026#39;DBInstances\u0026#39;]: #Check if DB instance is not already stopped if (db[\u0026#39;DBInstanceStatus\u0026#39;] == \u0026#39;available\u0026#39;): try: GetTags=rds.list_tags_for_resource(ResourceName=db[\u0026#39;DBInstanceArn\u0026#39;])[\u0026#39;TagList\u0026#39;] for tags in GetTags: #if tag \u0026#34;autostop=yes\u0026#34; is set for instance, stop it if(tags[\u0026#39;Key\u0026#39;] == \u0026#39;autostop\u0026#39; and tags[\u0026#39;Value\u0026#39;] == \u0026#39;yes\u0026#39;): result = rds.stop_db_instance(DBInstanceIdentifier=db[\u0026#39;DBInstanceIdentifier\u0026#39;]) print (\u0026#34;Stopping instance: {0}.\u0026#34;.format(db[\u0026#39;DBInstanceIdentifier\u0026#39;])) except Exception as e: print (\u0026#34;Cannot stop instance {0}.\u0026#34;.format(db[\u0026#39;DBInstanceIdentifier\u0026#39;])) print(e) if __name__ == \u0026#34;__main__\u0026#34;: lambda_handler(None, None) EventBridge を使用する 以下の CloudFormation テンプレートを使用して stack を作成 --- AWSTemplateFormatVersion: \u0026#39;2010-09-09\u0026#39; Description: EventBridge Scheduler to stop RDS instance Parameters: InstanceId: Type: String ScheduleStopTime: Type: String Default: \u0026#34;cron(0 20 * * ? *)\u0026#34; ScheduleTimezone: Type: String Default: Japan Resources: # EventBridgeScheduler??? ScheduleRDSStop: Type: AWS::Scheduler::Schedule Properties: Name: !Sub \u0026#39;RDS-Stop-${InstanceId}\u0026#39; Description: Stop RDS Instance ScheduleExpression: !Ref ScheduleStopTime ScheduleExpressionTimezone: !Ref ScheduleTimezone FlexibleTimeWindow: Mode: \u0026#34;OFF\u0026#34; State: ENABLED Target: Arn: arn:aws:scheduler:::aws-sdk:rds:stopDBInstance Input: !Sub |- { \u0026#34;DbInstanceIdentifier\u0026#34;: \u0026#34;${InstanceId}\u0026#34; } RoleArn: Fn::GetAtt: - SchedulerRDSStopRole - Arn # EventBridgeScheduler?????IAM?????? SchedulerRDSStopRole: Type: AWS::IAM::Role Properties: AssumeRolePolicyDocument: Version: \u0026#39;2012-10-17\u0026#39; Statement: - Effect: Allow Principal: Service: - scheduler.amazonaws.com Action: - sts:AssumeRole Path: \u0026#34;/\u0026#34; Policies: - PolicyName: rdsstop PolicyDocument: Version: \u0026#34;2012-10-17\u0026#34; Statement: - Effect: Allow Action: - rds:StopDBInstance Resource: - \u0026#34;*\u0026#34; 以下のパラメータを指定 対象のインスタンス(DB 識別子) 例. sample-db 停止のスケジュール(cron 式) 例. cron(0 20 * * ? *) タイムゾーン 例. japan 作成されたリソースを確認 3-1. Amazon EventBridge \u0026gt; スケジュール \u0026gt; \u0026laquo;対象のスケジュール\u0026raquo;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/10/02/how-to-export-collections-with-postman-in-vscode-extension/",
title: "VSCode Extension の Postman でコレクションをエクスポートする方法",
image: "images/logo/postman_logo.svg",
date: "2024-10-02",
body: "VSCode Extension の Postman でコレクションをエクスポートする方法 VSCode Extension の Postman でコレクションをエクスポートする方法について調査した結果を備忘録として残しておく 前提 VSCode Extension の Postman にはコレクションのインポート機能は存在するがエクスポート機能は存在しない そのため、Postman のアカウントに紐づいていることを利用して Web 版の Postman にてエクスポートする 手順 Web 版の Postman にアクセスする VSCode Extension の Postman と同じアカウントにログインする Workspaces \u0026gt; 該当の Workspace を選択 エクスポートしたいコレクションのメニューより「Export」を選択 エクスポートを行う"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/09/30/how-to-configure-terminal-alacritty/",
title: "Terminal Alacritty の設定方法",
image: "images/logo/alacritty_logo.svg",
date: "2024-09-30",
body: "Terminal Alacritty の設定方法 Terminal Alacritty の設定方法について調査した結果を備忘録として残しておく 環境 OS: macOS 14.7 手順 Alacritty のセットアップ フォントのインストール brew install --cask font-monaspace # Hack Nerd Font brew install font-hack-nerd-font # HackGen brew install font-hackgen # HackGen Nerd brew install font-hackgen-nerd 以下のコマンドを実行する brew install --cask alacritty mkdir -p ~/.config/alacritty vim ~/.config/alacritty/alacritty.toml config ファイルを修正する 設定値については参考を参照 import = [ \u0026#34;~/.config/alacritty/themes/themes/pastel_dark.toml\u0026#34; # theme ] [env] TERM = \u0026#34;xterm-256color\u0026#34; [window] padding.x = 10 padding.y = 10 decorations = \u0026#34;Full\u0026#34; opacity = 0.9 # 透過率 blur = false option_as_alt = \u0026#34;Both\u0026#34; [font] normal.family = \u0026#34;HackGen35 Console NF\u0026#34; # Font Family を指定 normal.style = \u0026#34;Bold\u0026#34; size = 16 alaciritty-themes のセットアップ ~/.config/alacritty/alacritty.toml の import にて指定する theme の詳細は公式を参照 cd ~/.config/alacritty git clone https://github.com/alacritty/alacritty-theme themes zsh-autosuggestions, zsh-syntax-highlighting のセットアップ brew install zsh-autosuggestions echo \u0026#34;source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh\u0026#34; \u0026gt;\u0026gt; ~/.zshrc brew install zsh-syntax-highlighting echo \u0026#34;source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh\u0026#34; \u0026gt;\u0026gt; ~/.zshrc source ~/.zshrc zellij or tmux のセットアップ zellij brew install zellij mkdir ~/.config/zellij zellij setup --dump-config \u0026gt; ~/.config/zellij/config.kdl tmux brew install tmux touch ~/.config/tmux/.tmux.conf .tmux.conf の設定内容は dotfiles 参照 zellij or tmuxの起動 zellij ターミナル起動時に zellij を自動起動させる場合は config ファイルに以下を追記する ※以下は、homebrew で zellij をインストールした場合 path を which tmux で確認すること！ [shell] program = \u0026#34;/bin/zsh\u0026#34; args = [ \u0026#34;-l\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/opt/homebrew/bin/zellij attach --index 0 --create\u0026#34;, ] ターミナル起動時に tmux を自動起動させる場合は config ファイルに以下を追記する ※以下は、homebrew で tmux をインストールした場合 path を which tmux で確認すること！ [shell] program = \u0026#34;/bin/zsh\u0026#34; args = [ \u0026#34;-l\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;/opt/homebrew/bin/tmux a -t 0 || /opt/homebrew/bin/tmux -u\u0026#34;, ] Alacritty のアイコンの変更 issueで議論されている件 置換前 Alacritty アイコン 置換後 Alacritty アイコン 以下のコマンドを実行 /bin/bash -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/hmarr/dotfiles/refs/heads/main/bin/update-alacritty-icon.sh)\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/09/17/how-to-set-up-google-form-to-require-login/",
title: "Google Form のログインが必須になる設定について",
image: "images/logo/google_form_logo.svg",
date: "2024-09-17",
body: "Google Form のログインが必須になる設定について Google Form のログインが必須になる設定について調査した結果を備忘録として残しておく Google アカウントでのログインが必須となる設定 メールアドレスを収集する 回答の編集を許可する 回答を1回に制限する 質問にファイルアップロードが含まれている場合"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/09/06/aws-cost-reduction-tips-part-2/",
title: "AWS コスト削減 Tips その2",
image: "images/logo/aws_logo.svg",
date: "2024-09-06",
body: "AWS コスト削減 Tips その2 AWS コスト削減 Tipsを備忘録として残しておく [前回までの記事] AWS コスト削減 Tips CloudWatch 全体コストの確認 Cost Explorer にて確認 ※詳細は公式を参照 [レポートパラメータ] 日付範囲 任意 ※月単位で確認するのであれば「6ヶ月」等を指定 粒度 任意 ※月単位で確認するのであれば「月別」を指定 グループ化の条件 ディメンション 使用タイプ フィルター サービス CloudWatch リージョン 任意 Data-Processing-bytesコスト詳細確認 手順は公式を参照 サイズ降順で並んで出力される コスト削減方法 ログ送信量を削減 ※効果中 〜 効果大 console.log を削除 CloudWatch への出力を text =\u0026gt; json に変更してログレベルを制御 例. エラーのみ 不要なカスタムメトリクスの削除 ※効果中 〜 効果大 請求が高い場合には検討する価値あり 対象の請求 XXX-CW:MetricMonitorUsage XXX-CW:Requests カスタムメトリクス一覧の確認方法 CloudWatch \u0026gt; Metrics を選択 検索欄に「NOT AWS」を入力して検索"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/09/06/aws-cost-reduction-tips/",
title: "AWS コスト削減 Tips",
image: "images/logo/aws_logo.svg",
date: "2024-09-06",
body: "AWS コスト削減 Tips AWS コスト削減 Tipsを備忘録として残しておく EC2 インスタンスタイプの変更 ※効果小 〜 効果中 最適なインスタンスタイプの選定については、公式参照 使用していない期間(夜間/休日等)での停止 ※効果大 特に開発・検証環境については検討する余地あり 踏み台サーバとして運用している場合は、本番環境も検討する余地あり NAT Gateway 使用していない期間(夜間/休日等)での削除 ※効果大 特に開発・検証環境については検討する余地あり 但し、再作成とセットで自動化する必要あり RDS 使用していない期間(夜間/休日等)での停止 ※効果大 特に開発・検証環境については検討する余地あり EC2 と比較して停止状態からの起動に時間がかかるため注意が必要 DB のデータ容量によるが 15 〜 30 分程度みた方が良い Backup に関わるコスト確認 ※効果小 〜 効果中 バックアップ要件に関わるので顧客確認要 確認方法は以下記事を参照 Amazon Aurora のバックアップストレージ費用の確認方法"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/09/03/how-to-login-when-the-mfa-set-for-the-aws-root-user-is-unknown/",
title: "AWS ルートユーザに設定されている MFA が不明な場合のログイン方法",
image: "images/logo/aws_logo.svg",
date: "2024-09-03",
body: "AWS ルートユーザに設定されている MFA が不明な場合のログイン方法 AWS ルートユーザに設定されている MFA が不明な場合のログイン方法を備忘録として残しておく 状況 ルートユーザ メールアドレス: 把握 パスワード: 不明 MFA: 故障 or 紛失 実際の手順 公式の手順 を参考に行う 事前作業 公式の手順 を参考に行う IAM ユーザ認証情報を使用して、更新する AWS アカウントの AWS Billing and Cost Management コンソールにログインする [Contact Information] の横にある [Edit]を選択 アカウントに関連付けられている電話番号を更新 ※電話番号の国コードが正しく、余分なスペースが含まれていないことを確認 [Update]を選択 作業手順 AWS アカウントのルートユーザーの E メールアドレスを使用してサインインする [Root user sign in]ページで、ルートアカウントのパスワードを入力する [Amazon Web Services Sign In With Authentication Device]ページで、[Troubleshoot MFA? Click here] を選択 [Troubleshoot Your Authentication Device] ページで、[Sign In using alternative factors]を選択 [Step 1: Email address verification]で、メールアドレスが正しいことを検証し、[Send verification email]を選択 件名が「AWS Email Verification」である AWS からの E メールで、[Verify your email address]を選択 =\u0026gt; 検証プロセスの「ステップ 2」ページが表示 [Step 2: Phone number verification]で、表示されている電話番号が正しいことを確認し、[Call me now]を選択 AWS からの電話に応答し、電話のキーパッドを使用して、デバイスの画面に表示される 6 桁の検証コードを送信 [Step 3: Sign In]で、[Sign in to the console]を選択 =\u0026gt; [Security Credentials]に自動的にリダイレクトされる リセットする MFA デバイスの横にある [Deactivate]を選択 [Activate MFA] を選択して MFA デバイスを追加"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/08/28/how-to-check-amazon-aurora-backup-storage-costs/",
title: "Amazon Aurora のバックアップストレージ費用の確認方法",
image: "images/logo/aws_logo.svg",
date: "2024-08-28",
body: "Amazon Aurora のバックアップストレージ費用の確認方法 AWS のコスト削減の一環として Amazon Aurora のバックアップストレージ費用の確認方法について調査した結果を備忘録として残しておく 実際の手順 Cost Explorer にて確認 [レポートパラメータ] 日付範囲 任意 ※月単位で確認するのであれば「6ヶ月」等を指定 粒度 任意 ※月単位で確認するのであれば「月別」を指定 グループ化の条件 ディメンション 使用タイプ フィルター サービス Relational Database Service（RDS） リージョン 任意 使用タイプ Aurora:BackupUsage(GB-Month) Aurora:StorageIOUsage(IOs) Aurora:StorageUsage(GB-Month)"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/08/22/how-to-execute-commands-in-the-aws-cli-using-an-iam-user-with-mfa-authentication-already-set-up/",
title: "AWS CLI で MFA 認証を設定済の IAM ユーザを使用してコマンドを実行する方法",
image: "images/logo/aws_logo.svg",
date: "2024-08-22",
body: "AWS CLI で MFA 認証を設定済の IAM ユーザを使用してコマンドを実行する方法 AWS CLI で MFA 認証を設定済の IAM ユーザを使用してコマンドを実行する方法について調査した結果を備忘録として残しておく 環境 OS: MacOS AWS にて IAM ユーザを作成して MFA 認証を設定済 aws-mfa をインストール済 aws-mfa 設定 IAM ユーザのアクセスキーを作成してダウンロード \u0026laquo;profile 名\u0026raquo;-long-term で Profile を設定 デフォルト Region, Output を設定したい場合は \u0026laquo;profile 名\u0026raquo; の Profile を設定 以下のコマンドを実行 # ARN は IAM \u0026gt; ユーザー \u0026gt; \u0026lt;\u0026lt;IAM ユーザ\u0026gt;\u0026gt; の [セキュリティ認証情報]タブ \u0026gt; 多要素認証 (MFA) の識別子のため注意 aws-mfa --device arn:aws:iam::\u0026lt;\u0026lt;AWS アカウント\u0026gt;\u0026gt;:mfa/\u0026lt;\u0026lt;IAM ユーザ\u0026gt;\u0026gt; --profile \u0026lt;\u0026lt;profile 名\u0026gt;\u0026gt; 追加で ~/.aws/credentials に以下を設定 [\u0026lt;profile 名\u0026gt;-long-term] aws_mfa_device = \u0026lt;\u0026lt;arn:aws:iam::*:mfa/${aws:username}\u0026gt;\u0026gt; 使用の仕方 AWS CLI にてコマンドを実行する前に以下のコマンドを実行する aws-mfa --profile \u0026lt;\u0026lt;profile 名\u0026gt;\u0026gt;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/07/26/how-to-remove-subscriptions-not-tied-to-amazon-sns-topics-in-shell-script/",
title: "ShellScript で Amazon SNS トピックに紐づかないサブスクリプションを削除する方法",
image: "images/logo/aws_logo.svg",
date: "2024-07-26",
body: "ShellScript で Amazon SNS トピックに紐づかないサブスクリプションを削除する方法 ShellScript で Amazon SNS トピックに紐づかないサブスクリプションを削除する方法について調査した結果を備忘録として残しておく 環境 OS: MacOS 実際のコード \u0026lt;\u0026lt;AWS Configure Profile\u0026gt;\u0026gt; 部分は実際の環境に応じて書き換える #!/bin/bash AWS_PROFILE=\u0026lt;\u0026lt;AWS Configure Profile\u0026gt;\u0026gt; # SNSトピック一覧を取得 topics=$(aws sns list-topics --profile=${AWS_PROFILE} | jq -r \u0026#39;.Topics[].TopicArn\u0026#39;) # SNSサブスクリプション一覧を取得 subscriptions=$(aws sns list-subscriptions --profile=${AWS_PROFILE}) # トピックに紐づかないサブスクリプションを削除 echo $subscriptions | jq -c \u0026#39;.Subscriptions[]\u0026#39; | while read subscription; do subscriptionArn=$(echo $subscription | jq -r \u0026#39;.SubscriptionArn\u0026#39;) topicArn=$(echo $subscription | jq -r \u0026#39;.TopicArn\u0026#39;) # サブスクリプションのtopicArnがtopicsに含まれていなければ削除 if ! echo $topics | grep $topicArn \u0026gt; /dev/null then aws sns unsubscribe --subscription-arn $subscriptionArn --profile=${AWS_PROFILE} echo \u0026#34;削除したサブスクリプション: $subscriptionArn\u0026#34; fi done"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/07/22/how-to-upload-images-to-s3-using-iam-with-mfa-authentication-configured-in-shell-script/",
title: "ShellScript で MFA 認証設定済の IAM を使用して S3 に画像をアップロードする方法",
image: "images/logo/aws_logo.svg",
date: "2024-07-22",
body: "ShellScript で MFA 認証設定済の IAM を使用して S3 に画像をアップロードする方法 ShellScript で MFA 認証設定済の IAM を使用して S3 に画像をアップロードする方法について調査した結果を備忘録として残しておく 環境 OS: MacOS aws-mfa をインストールして登録済 aws-mfa 設定を参照 aws-mfa 設定 通常の aws profile を設定 1 で設定した \u0026laquo;profile 名\u0026raquo;-long-term で Profile を設定 追加で ~/.aws/credentials に以下を設定 [\u0026lt;\u0026lt;profile 名\u0026gt;\u0026gt;-long-term] aws_mfa_device = \u0026lt;\u0026lt;arn:aws:iam::*:mfa/${aws:username}\u0026gt;\u0026gt; フォルダ構成 ./ ├── img/ │ └── image_001.png └── upload_image.sh 実際のコード \u0026lt;\u0026lt;AWS Profile Prefix\u0026gt;\u0026gt; 部分は実際の環境に応じて書き換える #!/bin/sh # Shared AWS_PROFILE_PREFIX=\u0026lt;\u0026lt;AWS Profile Prefix\u0026gt;\u0026gt; IMAGE_UPLOAD_DIR=img read -p \u0026#34;Which environment connect to? (dev/stg/prd): \u0026#34; input_environment # Convert to uppercase environment=$(echo \u0026#34;${input_environment}\u0026#34; | tr \u0026#39;[:lower:]\u0026#39; \u0026#39;[:upper:]\u0026#39;) echo \u0026#34;【Start Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # Check the environment case \u0026#34;${input_environment}\u0026#34; in \u0026#34;dev\u0026#34; | \u0026#34;stg\u0026#34; | \u0026#34;prd\u0026#34;) echo \u0026#34;Connecting to ${environment} environment...\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # AWS MFA Authentication aws-mfa --profile=${AWS_PROFILE_PREFIX}-${input_environment} \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # Set environment variables AWS_PROFILE=$(eval \u0026#34;echo \\${AWS_PROFILE_PREFIX}-${input_environment}\u0026#34;) AWS_S3_IMAGE_UPLOAD_DIR=$(eval \u0026#34;echo s3-bucket-${input_environment}-to/path/\u0026#34;);; *) echo \u0026#34;Please enter the correct environment.\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 echo \u0026#34;【End Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 exit;; esac echo \u0026#34;【Start Upload Image】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # Remove .DS_Store find . -name \u0026#34;.DS_Store\u0026#34; | xargs rm -f # Upload images to S3 aws s3 cp ./${IMAGE_UPLOAD_DIR} s3://${AWS_S3_IMAGE_UPLOAD_DIR} --profile=${AWS_PROFILE} --recursive \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 echo \u0026#34;【End Upload Image】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 echo \u0026#34;【End Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/07/18/how-to-access-a-db-via-a-stepping-stone-server-and-execute-sql-in-shell-script/",
title: "ShellScript で踏み台サーバ(EC2)経由で DB にアクセスして SQL を実行する方法",
image: "images/logo/aws_logo.svg",
date: "2024-07-18",
body: "ShellScript で踏み台サーバ(EC2)経由で DB にアクセスして SQL を実行する方法 ShellScript で踏み台サーバ(EC2)経由で DB にアクセスして SQL を実行する方法について調査した結果を備忘録として残しておく 環境 OS: MacOS DB: PostgreSQL フォルダ構成 ./ ├── sql/ │ └── execute.sql └── execute_sql.sh 実際のコード 環境変数(xxx 部分)は実際の環境に応じて書き換える #!/bin/sh # DEV EC2_HOST_DEV=xxx EC2_PEM_KEY_DEV=xxx DB_HOST_DEV=xxx DB_PORT_DEV=5432 DB_NAME_DEV=xxx DB_USER_DEV=xxx DB_PASSWORD_DEV=xxx # STG EC2_HOST_STG=xxx EC2_PEM_KEY_STG=xxx DB_HOST_STG=xxx DB_PORT_STG=5432 DB_NAME_STG=xxx DB_USER_STG=xxx DB_PASSWORD_STG=xxx # PRD EC2_HOST_PRD=xxx EC2_PEM_KEY_PRD=xxx DB_HOST_PRD=xxx DB_PORT_PRD=5432 DB_NAME_PRD=xxx DB_USER_PRD=xxx DB_PASSWORD_PRD=xxx # Shared SQL_DIR=sql SQL_FILE=${SQL_DIR}/execute.sql LOG_FILE=log/batch.log read -p \u0026#34;Which environment connect to? (dev/stg/prd): \u0026#34; input_environment # Convert to uppercase environment=$(echo \u0026#34;${input_environment}\u0026#34; | tr \u0026#39;[:lower:]\u0026#39; \u0026#39;[:upper:]\u0026#39;) echo \u0026#34;【Start Processing】$(date \u0026#34;+%Y/%m/%d %H:%M:%S\u0026#34;)\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # Check the environment case \u0026#34;${input_environment}\u0026#34; in \u0026#34;dev\u0026#34; | \u0026#34;stg\u0026#34; | \u0026#34;prd\u0026#34;) echo \u0026#34;Connecting to ${environment}environment...\u0026#34; \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 EC2_HOST=$(eval \u0026#34;echo \\${EC2_HOST_${environment}}\u0026#34;) EC2_PEM_KEY=$(eval \u0026#34;echo \\${EC2_PEM_KEY_${environment}}\u0026#34;) DB_HOST=$(eval \u0026#34;echo \\${DB_HOST_${environment}}\u0026#34;) DB_PORT=$(eval \u0026#34;echo \\${DB_PORT_${environment}}\u0026#34;) DB_NAME=$(eval \u0026#34;echo \\${DB_NAME_${environment}}\u0026#34;) DB_USER=$(eval \u0026#34;echo \\${DB_USER_${environment}}\u0026#34;) DB_PASSWORD=$(eval \u0026#34;echo \\${DB_PASSWORD_${environment}}\u0026#34;);; *) echo \u0026#34;Please enter the correct environment.\u0026#34; exit;; esac scp -i ${EC2_PEM_KEY} -r ${SQL_DIR} ${EC2_HOST}:~/ ssh -i ${EC2_PEM_KEY} -T ${EC2_HOST} \u0026lt;\u0026lt;EOF \u0026gt;\u0026gt; ${LOG_FILE} 2\u0026gt;\u0026amp;1 # Set DB Password export PGPASSWORD=${DB_PASSWORD} # Execute SQL psql -p ${DB_PORT} -h ${DB_HOST} -d ${DB_NAME} -U ${DB_USER} -f ${SQL_FILE} # Remove SQL rm -rf sql EOF"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/06/26/how-to-make-apis-that-require-cognito-authentication-work-from-postman/",
title: "API Gateway のオーソライザに Cognito を使用している API を Postman から動作させる方法",
image: "images/logo/postman_logo.svg",
date: "2024-06-26",
body: "API Gateway のオーソライザに Cognito を使用している API を Postman から動作させる方法 API Gateway のオーソライザに Cognito を使用している API を Postman から動作させる方法について調査した結果を備忘録として残しておく 実際の設定 以下の通りに URL と Header, Body を設定する Postman 設定その１ Postman 設定その２ 他の API で使用するために変数に格納する Postman 設定その3 Cognito 認証が必要な API の Authorization に変数に格納した IDToken を設定する Postman 設定その４"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/06/13/how-to-get-the-total-number-of-objects-uploaded-in-s3/",
title: "S3 でアップロードされているオブジェクトの総数を取得する方法",
image: "images/logo/aws_logo.svg",
date: "2024-06-13",
body: "S3 でアップロードされているオブジェクトの総数を取得する方法 S3 でアップロードされているオブジェクトの総数を取得する方法について調査した結果を備忘録として残しておく 実際のコード aws s3 ls s3://\u0026lt;\u0026lt;bucket-name/path/to/\u0026gt;\u0026gt; --recursive --human-readable --summarize その他 最終更新日の降順でソートして出力 UI 上だとできないのでコマンドを使用する aws s3 ls s3://\u0026lt;\u0026lt;bucket-name/path/to/\u0026gt;\u0026gt; | sort -nr"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/06/04/how-to-run-circle-ci-locally/",
title: "Circle CI をローカルで実行する方法",
image: "images/logo/circleci_logo.svg",
date: "2024-06-04",
body: "Circle CI をローカルで実行する方法 Circle CI をローカルで実行する方法を備忘録として残しておく 前提 Mac OS OS Version: Sonoma 14.4.1 Chip: Apple M1 Container 管理ツール Rancher Desktop 使用ツール Circle CI CLI Circle CI 定義ファイル 既に作成済想定 Circle CI CLI のインストール Home Brew でインストールする brew install circleci 使用方法 CLI で定義ファイルの文法チェックを行う circleci config validate #=\u0026gt; Config file at .circleci/config.yml is valid. circleci コマンドを使用して実行する 例. build Job 確認 ※version 2.1 の場合は一度 config ファイルの変換を行ってから実行する circleci config process .circleci/config.yml \u0026gt; config-for-v2.yml circleci local execute -c config-for-v2.yml build 制約 ローカルでのジョブ実行時の制限事項を参照"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/06/01/how-to-configure-send-grid-and-checkits-operation/",
title: "SendGrid の設定および動作確認方法について",
image: "images/logo/send_grid_logo.svg",
date: "2024-06-01",
body: "SendGrid の設定および動作確認方法について SendGrid の設定および動作確認方法を備忘録として残しておく 前提 2024/4/1 以降の新しい方式 Domain Authentication DNS: Amazon Route 53 実際の手順 SendGrid 管理画面にて API Key を作成 参考 SendGrid 管理画面にて Domain Authentication の設定を行う Domain Authentication(SPF/DKIM設定) テストメールを送信して動作確認を行う 参考 メールテンプレートを作成 参考 メールテンプレートを使用した動作確認を行う 参考1 参考2 Curl での動作確認 テンプレートなし [構文] curl -X POST https://api.sendgrid.com/v3/mail/send \\ -d \u0026#34;JSONデータを指定\u0026#34; \\ -H \u0026#34;Authorization: Bearer \u0026lt;\u0026lt;API Key\u0026gt;\u0026gt;\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; [JSON データ] VS Code を使用している場合は JSON Parse \u0026amp; Stringify を使用すると JSON の Parse \u0026amp; Stringify が容易のため推奨 { \u0026#34;personalizations\u0026#34;: [ { \u0026#34;to\u0026#34;: [ { \u0026#34;email\u0026#34;: \u0026#34;\u0026lt;\u0026lt;送信先メールアドレス\u0026gt;\u0026gt;\u0026#34; } ], \u0026#34;subject\u0026#34;: \u0026#34;\u0026lt;\u0026lt;件名\u0026gt;\u0026gt;\u0026#34; } ], \u0026#34;from\u0026#34;: { \u0026#34;email\u0026#34;: \u0026#34;\u0026lt;\u0026lt;送信元メールアドレス\u0026gt;\u0026gt;\u0026#34; }, \u0026#34;content\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;text/plain\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;\u0026lt;\u0026lt;本文\u0026gt;\u0026gt;\u0026#34; } ] } テンプレートあり [構文] curl -X POST https://api.sendgrid.com/v3/mail/send \\ -d \u0026#34;JSONデータを指定\u0026#34; \\ -H \u0026#34;Authorization: Bearer \u0026lt;\u0026lt;API Key\u0026gt;\u0026gt;\u0026#34; \\ -H \u0026#34;Content-Type: application/json\u0026#34; [JSON データ] VS Code を使用している場合は JSON Parse \u0026amp; Stringify を使用すると JSON の Parse \u0026amp; Stringify が容易のため推奨 dynamic_template_data 配下にパラメータを渡す 手順4 のコードエディタ上では dynamic_template_data 配下のみを指定するため注意 { \u0026#34;personalizations\u0026#34;: [ { \u0026#34;to\u0026#34;: [ { \u0026#34;email\u0026#34;: \u0026#34;\u0026lt;\u0026lt;送信先メールアドレス\u0026gt;\u0026gt;\u0026#34; } ], \u0026#34;dynamic_template_data\u0026#34;: { \u0026#34;user_name\u0026#34;: \u0026#34;ユーザ名\u0026#34; } } ], \u0026#34;template_id\u0026#34;: \u0026#34;\u0026lt;\u0026lt;テンプレート ID\u0026gt;\u0026gt;\u0026#34;, \u0026#34;from\u0026#34;: { \u0026#34;email\u0026#34;: \u0026#34;\u0026lt;\u0026lt;送信元メールアドレス\u0026gt;\u0026gt;\u0026#34; } } 返信不可メールについて 今回は不要だったが返信不可メールについて対応が必要な場合は以下を参考にする 返信不可メールのベストプラクティス"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/30/m1-solution-for-failure-to-install-older-nodejs-with-nodenv-on-mac/",
title: "M1 Mac の nodenv で古い Node.js をインストールできない場合の解決方法",
image: "images/logo/nodejs_logo.svg",
date: "2024-05-30",
body: "M1 Mac の nodenv で古い Node.js をインストールできない場合の解決方法 M1 Mac の nodenv で古い Node.js をインストールできない場合の解決方法を備忘録として残しておく 前提 CPU: Apple M1 macOS: Sonoma 14.5 Node.js Version: 14.21.3 インストール時のエラー nodenv install 14.21.3 #=\u0026gt; BUILD FAILED (OS X 14.5 using node-build 4.9.138) 解決方法 以下のコマンドでインストールを行う arch -x86_64 nodenv install 14.21.3 原因 Apple M1 は ARM(darwin-arm64) だが公式では 16 以降が対応 そのため未満のバージョンをインストールした際にエラーになる場合がある Node.js 16 CHANGELOG"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/19/new-road-to-aws-certified-solutions-architect-associate-part2/",
title: "(新) AWS 認定ソリューションアーキテクト - アソシエイトへの道 その2",
image: "images/logo/aws_logo.svg",
date: "2024-05-19",
body: "(新) AWS 認定ソリューションアーキテクト - アソシエイトへの道 その2 AWS 認定ソリューションアーキテクト - アソシエイトを学習する中で間違えやすいポイントを備忘録として残しておく [前回までの記事] (新) AWS 認定ソリューションアーキテクト - アソシエイトへの道 受験結果 無事に合格した 実際に組んでみたり、ベストプラクティスを確認することが大事だと感じた 勉強に使用したもの udemy"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/16/new-road-to-aws-certified-solutions-architect-associate/",
title: "(新) AWS 認定ソリューションアーキテクト - アソシエイトへの道",
image: "images/logo/aws_logo.svg",
date: "2024-05-16",
body: "(新) AWS 認定ソリューションアーキテクト - アソシエイトへの道 AWS 認定ソリューションアーキテクト - アソシエイトを学習する中で間違えやすいポイントを備忘録として残しておく EC2 Auto Scaling 動的スケーリング 簡易スケーリングポリシー(ターゲッツ追跡スケーリングポリシー) 一定の CPU 利用に応じてスケーリングを実行する ステップスケーリングポリシー スケールさせるインスタンス数を段階的に増やすステップを設定する ターミネーションポリシー スケールイン時のインスタンスを終了させる方法を定義する 手動スケーリング 希望する容量を調整して、手動でスケーリングを実施する スケジュールさせたスケーリング スケーリングを実施する日時を指定して、スケーリングを実行する AWS Nitro Enclaves 高度な機密情報の保護や安全措置を向上する、分離されたコンピューティング環境を作成することができる EBS EBS のコピーについて EBS 自体は別リージョンに移動して利用することはできない 以下のような手順が必要 スナップショットを作成 S3 スナップショットが格納される 別リージョンの S3 にコピーする 別リージョンのEBS に復元する EBS の RAID 構成 RAID 0 目的 パフォーマンスを向上させる 複数のディスクを 1 台のディスクのように扱う 読み書きを高速化する構成 ストライピング RAID 1 目的 ボリュームの冗長性を高める 2 つのボリュームを同時にミラーリングする EFS VPC 内の Amazon EFS ファイルシステムにアクセスする VPC に 1 つ以上のマウントターゲットを作成する必要がある リージョンファイルシステム AWS リージョン内の各アベイラビリティーゾーンにマウントターゲットを作成 1 ゾーンファイルシステム ファイルシステムと同じアベイラビリティーゾーンにマウントターゲットを 1 つだけ作成 VPC Direct Connect Direct Connect は AWS とオンプレミス環境間の専用線接続サービス ゲートウェイ型エンドポイント VPC 内の EC2 インスタンスから、プライベートネットワークを経由する VPC 外の Amazon DynamoDB テーブルにアクセスする際に使用 VPC にゲートウェイエンドポイントを構成して、DynamoDB にルートを設定することが必要 DynamoDB と Amazon S3 にのみ適用可能 プライペートリンク型エンドポイント(インターフェース型) プライベート IP アドレスを使用してサービスにプライベートにアクセスする AWS PrivateLink は VPC とサービス間のすべてのネットワークトラフィックを Amazon ネットワークに制限 RDS, EC2 など多くの AWS サービスに適用可能 2022 年より Amazon S3 に対応 ※DynamoDB は未対応 SQS 可視性タイムアウト 他のカスタマーがそのメッセージの受信や処理できなくなる期間 デフォルトは 30 秒 ※最小は 0 秒で最大は 12 時間 デッドレターキュー エラーのためにソフトウェアシステムが処理できないメッセージを一時的に保存する特別なタイプのメッセージキュー デフォルトでは有効でない Kinesis Kinesis Agent Kinesis サービスにデータを簡単に収集して取り込む OSS のスタンドアロン Java アプリケーション Kinesis Producer Library (KPL) Kinesis Streams にデータを送信する OSS の補助ライブラリ Fluent plugin for Amazon Kinesis Kinesis Streams と Kinesis Firehose にイベントを送信する OSS の Fluentd 出力プラグイン Kinesis Data Generator (KDG) KDG を利用して Kinesis Streams or Kinesis Firehose にテストデータを簡単に送信できる Kinesis Client Library (KCL) KCL を利用して Kinesis アプリケーションを作成する OSS のクライアントライブラリで EC2 インスタンスなどにデプロイして利用する ワーカーがシャード数に応じて、レコードプロセッサのライフサイクル管理(生成/終了)を実施 Kinesis のサービス Kinesis Data Analytics SQL や Java(Apache Flink) を使ってストリーミングデータに対してリアルタイム分析を行うことが出来るマネージドサービス Kinesis Data Firehose 実行内容 データ形式の変換 データの配信 処理速度 60 秒感覚のバッチ データ保存 ストリーム配信自体にはデータ保存不可 Kinesis Data Streams 実行内容 高速なデータ処理 データ分析・集計 複雑なストリーム処理 処理速度 ミリ秒単位のリアルタイム データ保存 24 時間 〜 365 日 S3 アクセス制限について 特定の S3 バケットへのアクセス制限は対象によってやり方が異なる 特定 IP の EC2 インスタンス IAM ロールでのアクセス制御 特定ユーザ S3 のバケットポリシー AWS Storage Gateway オンプレミスから実質無制限のクラウドストレージへのアクセスを提供するハイブリッドクラウドストレージサービス Amazon S3 ファイルゲートウェイ 業界標準の NFS および SMB ファイルプロトコルを使用 Amazon S3 にオブジェクトとしてファイルを保存 Amazon FSx ファイルゲートウェイ 業界標準の SMB プロトコルを使用 フルマネージドで、信頼性の高い、スケーラブルなファイル共有を高速かつ低レイテンシーを提供 テープゲートウェイ 既存のバックアップワークフローを変更することなく、オンプレミスの物理テープの使用から AWS の仮想テープに切り替えることができる 仮想テープをオンプレミスでキャッシュすることで、低レイテンシーのデータアクセスを可能にする ゲートウェイと AWS の間のデータを暗号化する Amazon S3 と Amazon S3 Glacier Flexible Retrieval、または Amazon S3 Glacier Deep Archive の間のデータを圧縮する その後、仮想テープを送信して、ストレージコストの最小化を図る ボリュームゲートウェイ オンプレミスアプリケーションにクラウドバックアップの iSCSI ブロックストレージボリュームを提供 キャッシュ型モード プライマリデータは Amazon S3 に保存される 頻繁にアクセスするデータはキャッシュでローカルに保持され、低レイテンシーでのアクセスが実現できる 保管型モード プライマリデータはローカルに保存される オンプレミスでデータセット全体が低レイテンシーでアクセスできると同時に、Amazon S3 に非同期でバックアップさレル Amazon FSx for Lustre Lustre ファイルシステムのスケーラビリティとパフォーマンスを備えたフルマネージド共有ストレージ S3 との双方向同期が可能 ※EBS とは不可 IAM AWS Security Token Service (AWS STS) AWS リソースへのアクセスをコントロールできる一時的セキュリティ認証情報を持つ、信頼されたユーザーを作成および提供する SAML フェデレーション 組織のネットワークのユーザーを認証して、それらのユーザに AWS へのアクセスを提供できる ※再度のサインインが不要 新しい AWS ID を作成 異なるサインイン カスタムフェデレーションブローカー AWS組織の認証システムを使用して リソースへのアクセスを許可することができる SAML 2.0 を使用したフェデレーション AWS 組織の認証システムと SAML を使用して、リソースへのアクセスを許可することができる OpenID Connect (OIDC) フェデレーション モバイルまたはウェブアプリケーションに対してユーザに一般的なサードパーティ ID プロバイダを使用したサインインを求めることができる ECS タスクという単位で、トランザクションをサービス単位に分割して、マイクロサービスとすることができる 他 AWS リソースへのアクセス許可 対象の AWS リソースへのアクセス許可が設定された IAM ポリシーを付与した IAM ロールをタスク IAM ロールとして設定する ※taskRoleArn API オペレーションによって定義 RDS フェールオーバ対策 マルチ AZ 配置 プライマリーDBインスタンスを別のアベイラビリティゾーンに同期的にレプリケートする構成 マルチ AZ クラスター プライマリーDBインスタンスに加えて、それぞれ別のアベイラビリティゾーンに２つのリードレプリカを利用する構成 AWS Elastic Beanstalk PaaS サービスで、Web アプリの実行環境を自動的に作成する Web アプリのデプロイメントと管理が簡単になる CloudFormation の制限版(Web アプリ用)みたいなイメージ AWS Glue 抽出(Extract)・変換(Transform)・ロード(Load)の頭文字を取った ETL を行う完全マネージド型のサービス AWS Glue クローラを利用して S3 バケットを処理して、データをスキャンする データ分類、スキーマ情報を抽出する AWS Glue データカタログにメタデータを保存する"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/09/how-to-retrieve-the-list-of-certificates-managed-by-aws-certificate-manager-for-all-regions/",
title: "AWS Certificate Manager で管理している証明書一覧を全リージョンに対して取得する方法",
image: "images/logo/aws_logo.svg",
date: "2024-05-09",
body: "AWS Certificate Manager で管理している証明書一覧を全リージョンに対して取得する方法 AWS Certificate Manager で管理している証明書一覧を全リージョンに対して取得する方法について調査した結果を備忘録として残しておく 実際のコード # AWSのリージョンのリストを取得する REGIONS=(`aws ec2 describe-regions --query Regions[*].RegionName --output text`) # リージョン毎に証明書のリストを出力する # 証明書 Arn, ドメイン名, タイプ, ステータス, 使用中かどうか for region in ${REGIONS[@]} do echo \u0026#34;[${region}]\u0026#34; aws acm list-certificates --output text --region ${region} --query \u0026#34;CertificateSummaryList[].[CertificateArn, DomainName, Type, Status, InUse]\u0026#34; | sort -k 1 | column -t -s \u0026#34;`printf \u0026#39;\\t\u0026#39;`\u0026#34; echo \u0026#34;---------------------\u0026#34; done"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/08/how-to-run-github-actions-locally/",
title: "Circle CI で環境変数を切り替える方法",
image: "images/logo/circleci_logo.svg",
date: "2024-05-08",
body: "Circle CI で環境変数を切り替える方法 Circle CI で環境変数を切り替える方法を備忘録として残しておく 実際のコード run ステップを使用して BASH_ENV にエクスポートする ※参考を参照 steps: - run: name: Setup Environment Variables command: |echo \u0026#39;export PATH=\u0026#34;$GOPATH\u0026#34;/bin:\u0026#34;$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; \u0026#34;$BASH_ENV\u0026#34; echo \u0026#39;export GIT_SHA1=\u0026#34;$CIRCLE_SHA1\u0026#34;\u0026#39; \u0026gt;\u0026gt; \u0026#34;$BASH_ENV\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/05/07/how-to-run-github-actions-locally/",
title: "GitHub Actions をローカルで実行する方法",
image: "images/logo/github_logo.svg",
date: "2024-05-07",
body: "GitHub Actions をローカルで実行する方法 GitHub Actions をローカルで実行する方法を備忘録として残しておく 前提 Mac OS OS Version: Sonoma 14.4.1 Chip: Apple M1 Container 管理ツール Rancher Desktop 使用ツール act GitHub Actions 既に作成済想定 act のインストール Home Brew でインストールする brew install act 使用方法 act で実行可能な一覧を表示する act -l WARN ⚠ You are using Apple M-series chip and you have not specified container architecture, you might encounter issues while running act. If so, try running it with \u0026#39;--container-architecture linux/amd64\u0026#39;. ⚠ Stage Job ID Job name Workflow name Workflow file Events 0 ci ci ci ci.yml push,pull_request act コマンドを使用して実行する 例. push 時の Job 確認 ※M1 なので \u0026lsquo;\u0026ndash;container-architecture linux/amd64\u0026rsquo; を付与して実行 act push --container-architecture linux/amd64 Trouble Shooting docker host に関するエラー act push --container-architecture linux/amd64 INFO[0000] Using docker host \u0026#39;127.0.0.1\u0026#39;, and daemon socket \u0026#39;127.0.0.1\u0026#39; [ci/ci] 🚀 Start image=catthehacker/ubuntu:act-latest [ci/ci] 🐳 docker pull image=catthehacker/ubuntu:act-latest platform=linux/amd64 username= forcePull=true Error: failed to connect to docker daemon: unable to parse docker host `127.0.0.1` 参考 を実施する export DOCKER_HOST=$(docker context inspect --format \u0026#39;{{.Endpoints.docker.Host}}\u0026#39;) マウントできないに関するエラー act push --container-architecture linux/amd64 INFO[0000] Using docker host \u0026#39;unix:///Users/\u0026lt;\u0026lt;User Name\u0026gt;\u0026gt;/.rd/docker.sock\u0026#39;, and daemon socket \u0026#39;unix:///Users/\u0026lt;\u0026lt;User Name\u0026gt;\u0026gt;/.rd/docker.sock\u0026#39; [ci/ci] 🚀 Start image=catthehacker/ubuntu:act-latest [ci/ci] 🐳 docker pull image=catthehacker/ubuntu:act-latest platform=linux/amd64 username= forcePull=true Error: failed to list containers: error during connect: Get \u0026#34;http://%2FUsers%2F\u0026lt;\u0026lt;User Name\u0026gt;\u0026gt;%2F.rd%2Fdocker.sock/v1.45/containers/json?all=1\u0026#34;: EOF 参考 を実施する --container-daemon-socket -"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/25/about-terraform-commands/",
title: "Terraform のコマンドについて",
image: "images/logo/terraform_logo.svg",
date: "2024-04-25",
body: "Terraform のコマンドについて Terraform のコマンドについて備忘録として残しておく 実際のコード 基本の流れ 初期化 terraform init 検証 terraform validate #=\u0026gt; Success! The configuration is valid. 実行計画確認 terraform plan インフラ構築 terraform apply その他 コード自動整形 terraform fmt リソース確認 terraform show リソース削除 terraform destroy リソース削除の実行計画確認 terraform plan -destroy"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/25/links-to-documentation-used-when-learning-terraform/",
title: "Terraform の学習時に使用したドキュメントのリンク集",
image: "images/logo/terraform_logo.svg",
date: "2024-04-25",
body: "Terraform の学習時に使用したドキュメントのリンク集 Terraform の学習時に使用したドキュメントのリンク集を備忘録として残しておく ドキュメントのリンク集 基本 公式ドキュメント HCL2 CLI AWS Provider コードの記載方法に関するベストプラクティス Terraform Best Practices Terraform Registry AWS VPC terraform-aws-atlantis Trouble Shooting Quick start tutorial でエラーが発生する 以下のコマンド実行時にエラーが発生 terraform apply Error: Error pinging Docker server: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? │ │ with provider[\u0026#34;registry.terraform.io/kreuzwerker/docker\u0026#34;], │ on main.tf line 10, in provider \u0026#34;docker\u0026#34;: │ 10: provider \u0026#34;docker\u0026#34; { 以下のコマンドで docker の sock のパスを確認する docker context ls NAME DESCRIPTION DOCKER ENDPOINT ERROR default Current DOCKER_HOST based configuration unix:///var/run/docker.sock rancher-desktop * Rancher Desktop moby context unix:///Users/\u0026lt;\u0026lt;user name\u0026gt;\u0026gt;/.rd/docker.sock Rancher Desktop を使用していたためパスが異なっていたのが原因 main.tf ファイルを以下のように修正して再実行する provider \u0026#34;docker\u0026#34; { host = \u0026#34;unix:///Users/\u0026lt;\u0026lt;user name\u0026gt;\u0026gt;/.rd/docker.sock\u0026#34;// 追加 }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/24/determining-whether-a-function-starting-with-amplify-login-in-aws-lambda-is-required-or-not/",
title: "AWS Lambda の amplify-login で始まる関数の要否判断について",
image: "images/logo/aws_logo.svg",
date: "2024-04-24",
body: "AWS Lambda の amplify-login で始まる関数の要否判断について AWS Lambda の amplify-login で始まる関数の要否判断について調査した結果を備忘録として残しておく 調査に至った事象 AWS より以下のメールが配信されていた 対象の Lambda 関数を確認すると掲題のものが指摘を受けていたが、作成した記憶はなく要否の判断がつかなかったため、調査を行なった [アクションが必要です] AWS Lambda での Node.js 16 のサポート終了について | [Action Required] AWS Lambda end of support for Node.js 16 English follows Japanese | 英語のメッセージは日本語の後にございます いつもお世話になっております。 [Amazon Health Dashboard はこのコミュニケーションに関するリマインダー通知を定期的にトリガーする場合があります] お客様の AWS アカウントに現在、Node.js 16 ランタイムを使用する AWS Lambda 関数が 1 つ以上あることが判明したため、ご連絡いたしております。 Lambda での Node.js 16 のサポートは 2024 年 6 月 12 日に終了します。これは、2023 年 9 月 11 日に Node.js 16 がサポート終了 (EOL) したことに続くものです [1]。 Lambda ランタイムサポートポリシー [2] で説明されているように、Lambda の言語ランタイムのサポートはいくつかの段階で終了します。2024 年 6 月 12 日以降、Lambda は Lambda 関数で使用される Node.js 16 ランタイムにセキュリティパッチやその他の更新を適用しなくなり、Node.js 16 を使用する関数はテクニカルサポートの対象ではなくなります。また、Node.js 16 は AWS コンソールで使用できなくなりますが、AWS CloudFormation、AWS CLI、AWS SAM、またはその他のツールを使用して、Node.js 16 を使用する関数を作成および更新することはできます。2025 年 2 月 28 日以降、Node.js 16 ランタイムを使用する新しい Lambda 関数を作成することはできなくなります。2025 年 3 月 31 日以降、Node.js 16 ランタイムを使用する既存の関数を更新することはできなくなります。 2024 年 6 月 12 日までに、既存の Node.js 16 の関数を利用可能な最新の Node.js ランタイムにアップグレードすることをお勧めします。Node.js 16 の関数のリストは、AWS ヘルスダッシュボードの [影響を受けるリソース](Affected resources) タブにあります。 サポートの終了は関数の実行には影響しません。関数は引き続き実行されます。ただし、これらはサポートされていないランタイムで実行されるため、AWS Lambda チームによるメンテナンスやパッチの適用は行われません。 この通知は、$LATEST 関数バージョンに Node.js 16 ランタイムを使用する関数に対して生成されました。次のコマンドは、AWS CLI [3] を使用して、Node.js 16 を使用して特定のリージョンのすべての関数 (公開されている関数バージョンを含む) を一覧表示する方法を示しています。アカウントでこのような関数をすべて見つけるには、各リージョンで次のコマンドを繰り返します。 aws lambda list-functions --region us-west-2 --output text --query \u0026#34;Functions[?Runtime==\u0026#39;nodejs16.x\u0026#39;].FunctionArn\u0026#34; 廃止予定の 180 日前から、Trusted Advisor を使用して、公開されている関数バージョン [4] を含め、Node.js 16 ランタイムを使用するすべての関数を識別することもできます。 ご不明な点やサポートが必要な場合は、AWS サポート [5] までお問い合わせ下さい。 ・・・ amplify-login で始まる Lambda 関数とは？ Amplify Studioを有効化した際に自動的に作成される関数 要否の判断 Amplify Studio を使用していない場合は削除して問題ない また、参考のように Amplify アプリと Lambda 関数の関連性を特定することができる Lamdba 関数名の AppID と Cognito ユーザプール名の AppID が一致しているかどうか Cognito ユーザプール \u0026gt; [ユーザプールのプロパティ] Lambda トリガー で追加されているかどうか ID プール \u0026gt; [ユーザアクセス] \u0026gt; [ID プロバイダ] に追加されているかどうか 全リージョンに存在する Lambda 関数の中で Node 16 を使用しているものを出力する方法 前提条件 Sh が実行可能 AWS CLI がインストール済 以下の権限を実行可能な IAM ユーザ or IAM ロールが設定済 ec2:DescribeRegions lambda:ListFunctions #!/bin/sh CMDNAME=`basename $0` if [ $# -gt 1 ]; then echo \u0026#34;Usage: ${CMDNAME}[profile]\u0026#34; 1\u0026gt;\u0026amp;2 exit 1 fi # 第1引数でプロファイル名が指定されていたら上書きする PROFILE=\u0026#34;default\u0026#34; if [ $# -eq 1 ]; then PROFILE=$1 fi # AWSのリージョンのリストを取得する REGIONS=(`aws --profile ${PROFILE} ec2 describe-regions --query Regions[*].RegionName --output text`) # リージョン毎に Lambda 関数のリストを出力する ※Lambda 関数名 昇順 for region in ${REGIONS[@]} do echo \u0026#34;[${region}]\u0026#34; aws --profile ${PROFILE} lambda list-functions --output text --region ${region} --query \u0026#34;Functions[?Runtime==\u0026#39;nodejs16.x\u0026#39;].[FunctionName, LastModified, Description]\u0026#34; | sort -k 1 | column -t -s \u0026#34;`printf \u0026#39;\\t\u0026#39;`\u0026#34; echo \u0026#34;---------------------\u0026#34; done"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/24/tips-for-creating-aws-configuration-diagrams-with-draw-io/",
title: "draw.io で AWS の構成図を作成する際の Tips",
image: "images/logo/drawio_logo.svg",
date: "2024-04-24",
body: "draw.io で AWS の構成図を作成する際の Tips draw.io で AWS の構成図を作成する際の Tips を備忘録として残しておく レイヤー機能を使用して重なり順を気にせずに作業する 図を追加した際に背面に隠れてしまい、重なりを修正する手間を解消する 手順 メニューバーから[表示]＞[レイヤー]を選択する ※初期状態では「背景」というレイヤーが配置されている 例えば以下のようにレイヤーを作成する ※上に表示されているレイヤーが前面に表示される AWS 構成図 レイヤー定義例 エクスポートについて さまざまな形式でエクスポートが行えるが XML 形式でエクスポートするとレイヤー情報もエクスポート可能"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/19/aws-related-link-summary/",
title: "AWS 関連のリンクまとめ",
image: "images/logo/aws_logo.svg",
date: "2024-04-19",
body: "AWS 関連のリンクまとめ AWS 関連のリンクについて毎回探してしまうためまとめておく ※一度でも調査に使用したものをまとめていく ベストプラクティスおよびサービスの導入理由 Well-Architected セキュリティの柱 検知 インフラストラクチャ保護 データ保護 AWS ホワイトペーバーとガイド DDos 耐性のベストプラクティス サービスの状態 各サービスごとのリンク Cognito ユーザプールの大文字・小文字の区別 RDS Amazon Aurora DB Aurora DB クラスターのバックアップと復元 Amazon Aurora Serverless V1 Amazon S3 への DB スナップショットデータのエクスポート Amazon Pinpoint プッシュ通知の送信 API Reference SES DMARC 対応 送信制限 本番稼働する際の制限解除について E メール受信時のフィードバックについて SNS 米国製品番号について ACM ACM 証明書について サポートされるリージョンについて 自動更新について EC2 インスタンスでパブリックキーを追加または削除する VPC AWS サービスが利用する IP アドレス範囲について WAF Managed Rules CloudFront フィールドレベル暗号化を使用した機密データの保護 API Gateway Amazon API Gateway のクォータと重要な注意点 Cloud Shell Amazon VPC AWS CloudShell での使用 classmethod の記事"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/15/how-to-perform-a-diff-comparison-in-a-directory-on-a-mac/",
title: "Mac でディレクトリ内の差分比較を行う方法",
image: "images/logo/icons8-mac-os-logo.svg",
date: "2024-04-15",
body: "Mac でディレクトリ内の差分比較を行う方法 普段 Diff ツールに CompareMerge2 を使用しているが無料版だと 200 アイテムまでの制限があるため他の方法を調査した方法を備忘録として残しておく 手順 diff コマンドを使用する 差分ファイル名のみ表示する -r オプション: 再起的に比較する -q オプション: 差分のあるファイルのみ表示 差分の内容は非表示 diff -r -q dir001/ dir002/ 差分ファイル数をカウントする ディレクトリの差分はない前提 diff -r -q dir001/ dir002/ | wc #=\u0026gt; 0 0 0"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/04/how-to-build-a-jmeter-environment/",
title: "JMeter の環境構築方法",
image: "images/logo/jmeter_logo.svg",
date: "2024-04-04",
body: "JMeter の環境構築方法 JMeter の環境構築方法を備忘録として残しておく 前提 Mac OS OS Version: Sonoma 14.4.1 Chip: Apple M1 Java Version: OpenJDK 21 手順 Java をインストールする ※Eclipse Temurin™ brew tap homebrew/cask-versions brew install --cask temurin21 JMeter をダウンロードする JMeter でダウンロードしても良い brew install jmeter 以下のコマンドを実行して JMeter を起動する jmeter"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/04/03/how-to-build-a-debugging-environment-for-the-go-language-on-vs-code/",
title: "Go 言語用のデバッグ環境を VS Code 上に構築する方法",
image: "images/logo/golang_logo.svg",
date: "2024-04-03",
body: "Go 言語用のデバッグ環境を VS Code 上に構築する方法 Go 言語用のデバッグ環境を VS Code 上に構築する方法を備忘録として残しておく ※環境変数読み込み時にロードエラーになっていた 前提 Mac OS OS Version: Sonoma 14.4.1 Chip: Apple M1 Go をインストール済 $GOPATH を設定済 $GOPATH/bin を環境変数 $PATH へ追加済 サーバ情報 host: 127.0.0.1 port: 3000 ディレクトリ構成 以下のような構成になっている想定 ※デバッグ対象のプログラムと環境変数ファイルが異なるディレクトリに存在する cmd ├── main.go .env 手順 VSCode に Go 言語の拡張機能をインストール コマンドパレットから Go: Install/Update Tools を選択 以下のツールを選択して実行 gopls@latest dlv@latest launch.json を編集 { // IntelliSense を使用して利用可能な属性を学べます。 // 既存の属性の説明をホバーして表示します。 // 詳細情報は次を確認してください: https://go.microsoft.com/fwlink/?linkid=830387 \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;Launch Program\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;go\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;mode\u0026#34;: \u0026#34;debug\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;${workspaceFolder}/cmd/\u0026#34;, \u0026#34;host\u0026#34;: \u0026#34;127.0.0.1\u0026#34;, \u0026#34;port\u0026#34;: 3000, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, // ※1 } ] } ※1 設定することで cwd が移動して .env ファイルがロード可能になる"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/03/30/how-to-connect-with-aws-ec2-instance-connect/",
title: "AWS EC2 Instance Connect で接続する方法",
image: "images/logo/aws_logo.svg",
date: "2024-03-30",
body: "AWS EC2 Instance Connect で接続する方法 AWS EC2 Instance Connect で接続する際にエラーが発生したため、接続できるように調査した内容を備忘録として残しておく 前提 AWS EC2 Instance Connect をインストールしておく 手順 Amazon EC2 コンソール を開く ナビゲーションペインで、[インスタンス] を選択する インスタンスを選択し、[接続] を選択する [EC2 Instance Connect] を選択する ユーザー名を検証し、[Connect (接続)] を選択してターミナルウィンドウを開く 以下のエラーが発生 インスタンス接続の設定中に問題が発生し、ログインに失敗しました。このインスタンスが開始したばかりの場合は、1～2 分後にもう一度試してください 公式のトラブルシューティングを確認 =\u0026gt; セキュリティグループに、EC2 Instance Connect サービス IP がホワイトリストにされていないのが原因だった 以下のコマンドを実行して EC2 Instance Connect サービス IP を確認する curl -s https://ip-ranges.amazonaws.com/ip-ranges.json| jq -r \u0026#39;.prefixes[] | select(.region==\u0026#34;\u0026lt;\u0026lt;対象リージョン\u0026gt;\u0026gt;\u0026#34;) | select(.service==\u0026#34;EC2_INSTANCE_CONNECT\u0026#34;) | .ip_prefix\u0026#39; セキュリティグループのインバウンドルールを更新して、手順 6 で確認した IP 範囲から TCP ポート 22 にアクセスできるようにルールを更新する 再度、EC2 Instance Connect に接続する"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/03/29/how-to-install-postgresql-13-on-amazon-linux-2/",
title: "Amazon Linux 2 に PostgreSQL 13 をインストールする方法",
image: "images/logo/aws_logo.svg",
date: "2024-03-29",
body: "Amazon Linux 2 に PostgreSQL 13 をインストールする方法 Amazon Linux 2 に PostgreSQL 13 をインストールする際にエラーが発生したため、インストールできるように調査した内容を備忘録として残しておく 手順 postgresql13 を以下のコマンドでインストールする sudo amazon-linux-extras install postgresql13 以下のエラーが発生 failure: repodata/repomd.xml from pgdg-common: [Errno 256] No more mirrors to try. https://download.postgresql.org/pub/repos/yum/common/redhat/rhel-2-x86_64/repodata/repomd.xml: [Errno 14] HTTPS Error 404 - Not Found Installation failed. Check that you have permissions to install. 以下のコマンドで対象ファイルの内容を更新する ※事前にバックアップすること sudo sed -i \u0026quot;s/\\$releasever/7/g\u0026quot; \u0026quot;/etc/yum.repos.d/pgdg-redhat-all.repo\u0026quot; 再度、 postgresql13 をインストールする 以下のエラーが発生 failure: repodata/repomd.xml from pgdg-common: [Errno 256] No more mirrors to try. https://download.postgresql.org/pub/repos/yum/common/redhat/rhel-7-x86_64/repodata/repomd.xml: [Errno -1] repomd.xml signature could not be verified for pgdg-common Installation failed. Check that you have permissions to install. 以下の対象ファイルの内容を更新 ※事前にバックアップすること 更新対象ファイル /etc/pki/rpm-gpg/PGDG-RPM-GPG-KEY-RHEL 更新内容の参照ファイル: PGDG-RPM-GPG-KEY-RHEL7 ダウンロード先 再度、 postgresql13 をインストールする"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/03/08/how-to-control-access-to-some-tables-in-amazon-aurora-postgresql/",
title: "Amazon Aurora PostgreSQL で一部のテーブルに対するアクセス制御を行う方法",
image: "images/logo/aws_logo.svg",
date: "2024-03-08",
body: "Amazon Aurora PostgreSQL で一部のテーブルに対するアクセス制御を行う方法 Amazon RDS で一部のテーブルに対するアクセス制御を行う方法について調査した内容を備忘録として残しておく 前提 構成および RDS Proxy に接続可能な DB ユーザを追加する方法については前回記事を参照 前回の記事: Amazon RDS で RDS Proxy に接続可能な DB ユーザを追加する方法 手順 Role に対して適宜必要な権限を付与 例. public Schema の全テーブルへの全権限を付与 grant all on all tables in schema public to \u0026lt;\u0026lt;DB ユーザ\u0026gt;\u0026gt;; アクセス制御を行うテーブルからアクセス権限を取り消す 例. public T_USER_HISTORY テーブルのアクセス権限を取り消す revoke select on \u0026#34;public\u0026#34;.\u0026#34;T_USER_HISTORY\u0026#34; from \u0026lt;\u0026lt;DB ユーザ\u0026gt;\u0026gt;; 権限の確認 該当テーブルの Access privileges 欄を確認して r(read) がないことを確認する \\dp #=\u0026gt; \u0026lt;\u0026lt;DB ユーザ\u0026gt;\u0026gt;=awdDxt/postgres"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/03/08/how-to-add-a-db-user-that-can-connect-to-rds-proxy-in-amazon-rds/",
title: "Amazon RDS で RDS Proxy に接続可能な DB ユーザを追加する方法",
image: "images/logo/aws_logo.svg",
date: "2024-03-08",
body: "Amazon RDS で RDS Proxy に接続可能な DB ユーザを追加する方法 Amazon RDS で RDS Proxy に接続可能な DB ユーザを追加する方法について調査した内容を備忘録として残しておく 前提 以下の構成を想定 ※RDS は Aurora PostgreSQL Version 13.8 構成図 手順 参考 DB ユーザ追加 以下のコマンドを使用してユーザを追加する ※実運用時は、適宜必要な権限を付与する postgres=\u0026gt; CREATE ROLE \u0026lt;\u0026lt;ロール名\u0026gt;\u0026gt; LOGIN PASSWORD \u0026#39;\u0026lt;\u0026lt;パスワード\u0026gt;\u0026gt;\u0026#39;; # 例. ログイン属性, 接続数制限なし, パスワード指定 postgres=\u0026gt; CREATE ROLE \u0026lt;\u0026lt;ロール名\u0026gt;\u0026gt; WITH LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE NOINHERIT NOREPLICATION NOBYPASSRLS CONNECTION LIMIT -1 PASSWORD \u0026#39;\u0026lt;\u0026lt;パスワード\u0026gt;\u0026gt;\u0026#39;; Secrets Manager にデータベース認証情報設定 AWS Secrets Manager のマネジメントコンソールから、先ほど登録した DB ユーザに対応するシークレットを作成する 設定 シークレットのタイプ: Amazon RDSデータベースの認証情報 ユーザー名: 該当のもの パスワード: 該当のもの DBインスタンス: 該当のもの RDS Proxy とシークレットの関連付け 3-1. Amazon RDS のマネジメントコンソールから Amazon RDS Proxy に作成したシークレットを関連付ける 3-2. 対象のAmazon RDS Proxy を選択し、アクション \u0026gt; 変更 の順に選択する 3-3. 作成したシークレットを追加し、「プロキシを変更」ボタンを押下する IAM Role の変更 Amazon RDS Proxy で利用している IAM Role に対して、secrets への権限許可を追加する ※Resource に追加 接続確認 psql -h \u0026lt;\u0026lt;RDS Proxy のエンドポイント\u0026gt;\u0026gt; -p 5432 -U \u0026lt;\u0026lt;作成した DB ユーザ\u0026gt;\u0026gt;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/03/06/how-to-deploy-a-whole-directory-of-static-files-to-aws-s3-with-github-actions/",
title: "GitHub Actions で AWS S3 に静的ファイルのディレクトリごとデプロイする方法",
image: "images/logo/github_logo.svg",
date: "2024-03-06",
body: "GitHub Actions で AWS S3 に静的ファイルのディレクトリごとデプロイする方法 GitHub Actions で AWS S3 に静的ファイルのディレクトリごとデプロイする方法を備忘録として残しておく 事前準備 GitHub Actions 用の IAM ユーザを作成 GitHub の Environments に上記 IAM ユーザのシークレットを登録 Environments \u0026gt; Environment Secrets S3 のバケットを作成（ホスティングする場合は公開設定にする） S3 のバケット名はグローバルでユニークにする必要がある 公式ドキュメント 前提 S3 のバケットは作成済 Package Manager は npm を使用(yarn でも可) npm build で dist フォルダ配下にデプロイ資産が作成される 実際のコード name: cd-dev on: push: branches: - \u0026#34;develop\u0026#34; workflow_dispatch: jobs: build-deploy: runs-on: ubuntu-latest environment: develop steps: - name: Checkout uses: actions/checkout@v4 # ① - uses: actions/setup-node@v4 with: node-version: 20 cache: \u0026#39;npm\u0026#39; cache-dependency-path: ${{ github.workspace }}/package-lock.json - name: Install Dependencies run: npm install - name: Build run: npm run build - name: Configure AWS Credentials uses: aws-actions/configure-aws-credentials@v1 with: aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} aws-region: ${{ secrets.AWS_REGION }} - name: Deploy to S3 run: aws s3 sync ./dist s3://\u0026lt;\u0026lt;S3 Buckets Name\u0026gt;\u0026gt; --delete # ② # ③ - name: Clear cache run: aws cloudfront create-invalidation --distribution-id \u0026lt;\u0026lt;CloudFront Distribution ID\u0026gt;\u0026gt; --paths \u0026#34;/*\u0026#34; ポイントの説明 ① 依存パッケージをキャッシュする cache: npm or yarn cache-dependency-path: package-lock.json のパスを指定 ② \u0026ndash;delete を付与するとバケットには存在するが、ディレクトリにはないファイルがあった場合に、バケットのファイルを削除する ③ CloudFront のキャッシュが有効になっている場合は以下も行う"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/02/20/how-to-get-a-list-of-registered-users-in-amazon-iam/",
title: "Amazon IAM で登録されているユーザ一覧を取得する方法",
image: "images/logo/aws_logo.svg",
date: "2024-02-20",
body: "Amazon IAM で登録されているユーザ一覧を取得する方法 Amazon IAM で登録されているユーザ一覧を取得する方法について調査した内容を備忘録として残しておく 方法 該当の AWS Console にログインして AWS Cloud Shell 上で以下のコマンドを実行する 実際のコード aws iam list-users \\ | jq -r \u0026#39;.Users[] | [.UserName, .CreateDate, .PasswordLastUsed] | @csv\u0026#39; \\ | tr -d \u0026#39;\u0026#34;\u0026#39; \\ \u0026gt; iam_users_list.csv"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/02/08/configuring-rancher-desktop/",
title: "Rancher Desktop の設定について",
image: "images/logo/docker_logo.png",
date: "2024-02-08",
body: "Rancher Desktop の設定について 普段個人で開発している時は Docker Desktop を使用しているが仕事で使用する場合には従業員数等で有償となる そのため、代替ツールとして Rancher Desktop を調査した結果を備忘録として残しておく 設定について 以下の設定を変更することで動作が速くなる可能性がある Preference - Virtual Machine - Emulation Virtual Machine Type に、VZを指定する 右側に出る、VZ Option の Enable Rosetta support にチェックを入れる Rosetta で動作しているか確認 下記コマンドで ubuntu に入り、 ps -ef を実行して、/mnt/lima-rosetta/rosetta と表示されていることを確認 $ docker run -it --platform linux/amd64 ubuntu # ps -ef Unable to find image \u0026#39;ubuntu:latest\u0026#39; locally latest: Pulling from library/ubuntu 445a6a12be2b: Pull complete Digest: sha256:aabed3296a3d45cede1dc866a24476c4d7e093aa806263c27ddaadbdce3c1054 Status: Downloaded newer image for ubuntu:latest root@0f03298c4ad5:/# ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 3 03:46 pts/0 00:00:00 /mnt/lima-rosetta/rosetta /bin/bash root 9 1 0 03:46 pts/0 00:00:00 /usr/bin/ps -ef Preference - Virtual Machine - Volumes 「Preferences」ボタンを押下 Virtual Machine \u0026gt; Volumes \u0026gt; Mount Type を以下に変更する Mount Type: virtiofs Preference - Application - Administrative Access 「Preferences」ボタンを押下 Application \u0026gt; General \u0026gt; Administrative Access を以下に変更する Allow to acquire administrative credentials(sudo access) これにチェックをしないとユーザ権限で実行された際に docker.sock が unix:///Users/\u0026laquo;User Name\u0026raquo;/.rd/docker.sock に作成される そのため Docker Default の /var/run 配下に作成されなくてエラーになるパターンがある 確認のチェックは Without のためチェックを入れずに「OK」ボタンを押下する！"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/02/08/building-a-development-environment-with-visual-studio-code-dev-containers/",
title: "Visual Studio Code Dev Containers での開発環境構築について",
image: "images/logo/vscode_logo.png",
date: "2024-02-08",
body: "Visual Studio Code Dev Containers での開発環境構築について Visual Studio Code Dev Containers での開発環境構築について調査した結果を備忘録として残しておく Dev Containers について 以下のような構成になる Architecture Containers 引用元: https://code.visualstudio.com/docs/devcontainers/containers 以下のようなメリットがある プロジェクトごとのミドルウェアなどをコンテナに閉じ込めることができる ホスト環境を汚さない VS Code の Extention もコンテナに閉じ込められる 環境構築を自動化できる 新規に作成したり、別のPCでの作り直しが簡単 環境構築について 前提条件 VS Code で以下の Extention をインストールする Remote Development Dev Containers ※テンプレートを使用する場合 Docker Docker Desktop or Rancher Desktop 実際の例 新規で作成する場合 VS Code の左下の「\u0026gt;\u0026lt;」ボタンを押下 「新しい開発コンテナー\u0026hellip;」 を選択 ベースとなる設定を選択する 基本的には Dockerfile or Docker Compose の話になるのでそちらに慣れていれば問題なくできると思われる テンプレートの使用 コマンドパレットで「Add Dev Container Configuration Files\u0026hellip;」を選択 「ワークスペースに構成を追加する」を選択 「すべての定義を表示\u0026hellip;」を選択 以降は新規で作成する場合と同様 4-1. ℹ️を押下することでテンプレートの使い方やカスタマイズ方法が表示される Tips ホスト側の DB クライアントから接続したい場合 以下の２つのファイルの設定を修正する必要がある 参考 ソースコードでの設定 設定変更した際はリビルドを行うこと version: \u0026#39;3\u0026#39; services: # 省略・・・ db: # 省略・・・ ports: - \u0026#34;5432:5432\u0026#34; # 省略・・・ { // 省略・・・ \u0026#34;forwardPorts\u0026#34;: [5432], // 省略・・・ } DB クライアントでの設定 ポイントとなる設定は以下 ホスト名/アドレス: 127.0.0.1 ポート番号: 5432 ※ソースコード側でマッピングした値 pgAdmin4 設定 VS Code の設定および拡張機能の追加 以下を設定することで開発者間で同じ設定と拡張機能をインストールした状態で開発が行える { \u0026#34;customizations\u0026#34;: { \u0026#34;vscode\u0026#34;: { // 設定値は、拡張機能 \u0026gt; ⚙️ \u0026gt; 拡張機能 ID のコピーで取得 \u0026#34;extensions\u0026#34;: [ \u0026#34;misogi.ruby-rubocop\u0026#34; ], // 設定値は、 settings.json で取得 \u0026#34;settings\u0026#34;: { \u0026#34;editor.tabSize\u0026#34;: 2, \u0026#34;editor.renderWhitespace\u0026#34;: \u0026#34;all\u0026#34;, \u0026#34;files.trimTrailingWhitespace\u0026#34;: true, \u0026#34;files.insertFinalNewline\u0026#34;: true, \u0026#34;diffEditor.ignoreTrimWhitespace\u0026#34;: false } } } }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/02/06/how-to-dmarc-support-for-custom-domains-in-amazon-ses/",
title: "Amazon SES でカスタムドメインに対して DMARC 対応を行う方法",
image: "images/logo/aws_logo.svg",
date: "2024-02-06",
body: "Amazon SES でカスタムドメインに対して DMARC 対応を行う方法 Amazon SES でカスタムドメインに対して DMARC 対応を行う方法について調査した内容を備忘録として残しておく 前提 対象のドメインを「検証済み ID」として作成済 DKIM が設定済 DNS サービスの提供元が Route 53 方法 Amazon SES \u0026gt; 設定: 検証済み ID を選択 対象の ID を選択 カスタム MAIL FROM ドメイン \u0026gt; 「編集」ボタンを押下 以下のように設定して「保存」ボタンを押下 カスタム MAIL FROM ドメインの使用: チェック MAIL FROM ドメイン: 任意の値 MX 障害時の動作: 以下のどちらか デフォルトの MAIL FROM ドメインの使用 メッセージの拒否 DNS レコードの発行を行う Route 53 \u0026gt; ホストゾーン \u0026gt; {対象のドメイン} を選択 「レコードを作成」を押下 以下を設定する レコード名: _dmarc レコードタイプ: TXT 値: v=DMARC1; p=none テストEメール確認して OK なら値を「v=DMARC1; p=reject」, 「v=DMARC1; p=reject」の順に変更 詳細はDMARC を実装するためのベストプラクティス参照 確認方法 例えば、以下のような方法で確認する テスト E メールを送信して SPF, DKIM, DMARC が pass になっていることを確認 DMARC Inspector"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/02/01/how-to-backup-and-restore-an-amazon-cognito-user-pool/",
title: "Amazon Cognito のユーザプールのバックアップおよびリストアを行う方法",
image: "images/logo/aws_logo.svg",
date: "2024-02-01",
body: "Amazon Cognito のユーザプールのバックアップおよびリストアを行う方法 Amazon Cognito のユーザプールのバックアップおよびリストアを行う方法について調査した内容を備忘録として残しておく 方法 以下の２つの方法が考えられる Cognito User Profiles Export リファレンスアーキテクチャ Lambda でユーザプールの一覧を取得して csv で出力して S3 に保存する ※リストアはユーザ CSV インポート機能で行う 実際のコード const { stringify } = require(\u0026#34;csv-stringify/sync\u0026#34;); module.exports = async (params) =\u0026gt; { const csvString = stringify(params, { header: true, quoted_string: false }) return csvString; }; const { CognitoIdentityProvider } = require(\u0026#34;@aws-sdk/client-cognito-identity-provider\u0026#34;); const cognito = new CognitoIdentityProvider(); module.exports = async (param) =\u0026gt; { let cognitoUsers = new Array(); let cognitoData; try { let params = { UserPoolId: process.env.USER_POOL_ID, }; let paginationToken = \u0026#34;\u0026#34;; while (paginationToken !== undefined) { cognitoData = await cognito.listUsers(params); paginationToken = cognitoData.PaginationToken; params.PaginationToken = paginationToken; if (cognitoData.Users.length \u0026gt; 0) { cognitoData.Users.forEach((user) =\u0026gt; { // ① を参照 let userAttributes = {}; userAttributes[\u0026#34;email\u0026#34;] = (user[\u0026#34;Attributes\u0026#34;].find(attr =\u0026gt; attr[\u0026#34;Name\u0026#34;] === \u0026#34;email\u0026#34;) || {})[\u0026#34;Value\u0026#34;] || \u0026#34;\u0026#34;; userAttributes[\u0026#34;email_verified\u0026#34;] = (user[\u0026#34;Attributes\u0026#34;].find(attr =\u0026gt; attr[\u0026#34;Name\u0026#34;] === \u0026#34;email_verified\u0026#34;) || {})[\u0026#34;Value\u0026#34;]; userAttributes[\u0026#34;cognito:mfa_enabled\u0026#34;] = \u0026#34;FALSE\u0026#34;; userAttributes[\u0026#34;cognito:username\u0026#34;] = userAttributes[\u0026#34;email\u0026#34;]; cognitoUsers.push(userAttributes); }); } else { console.error(\u0026#34;登録ユーザーが存在しません。\u0026#34;); return cognitoUsers; } } } catch (error) { console.error(error); return cognitoUsers; } return cognitoUsers; }; ※① CSV ファイルヘッダーのダウンロード (AWS CLI)で必要な項目を取得して設定する const { S3Client, PutObjectCommand } = require(\u0026#34;@aws-sdk/client-s3\u0026#34;); const convertCsvString = require(\u0026#34;./convertCsvString\u0026#34;); const getCognitoUsers = require(\u0026#34;./getCognitoUsers\u0026#34;); exports.handler = async (event) =\u0026gt; { let statusCode = 200; const headers = { \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, }; let cognitoUsers = await getCognitoUsers() if (cognitoUsers.length === 0) { return { isBase64Encoded: false, statusCode: 404, headers: headers, multiValueHeaders: {}, body: `{\u0026#34;message\u0026#34; : \u0026#34;登録ユーザーが存在しません。\u0026#34;}`, }; } const csvString = await convertCsvString(cognitoUsers); const client = new S3Client({ region: process.env.AWS_REGION }); const input = { Bucket: process.env.BUCKET, Key: \u0026#34;{任意の S3 バケットパス}/backup_user_pool.csv\u0026#34;, // 任意の S3 バケットパスを指定 Body: csvString }; const command = new PutObjectCommand(input) statusCode = await client.send(command) return { isBase64Encoded: false, statusCode: statusCode, headers: headers, multiValueHeaders: {}, body: `{\u0026#34;message\u0026#34; : \u0026#34;Cognito User Pool のバックアップが完了しました。\u0026#34;}`, }; };"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/01/31/how-to-combine-with-cognito-authentication-when-deploying-aws-synthetics-canary-for-external-monitoring/",
title: "外形監視に AWS Synthetics Canary を導入する場合に Cognito 認証と組み合わせる方法",
image: "images/logo/aws_logo.svg",
date: "2024-01-31",
body: "外形監視に AWS Synthetics Canary を導入する場合に Cognito 認証と組み合わせる方法 外形監視に AWS Synthetics Canary を導入する場合に Cognito 認証と組み合わせる方法について調査した内容を備忘録として残しておく 方法 CloudWatch \u0026gt; Synthetics Canary を選択 「Canary を作成」ボタンを押下 以下を設定 設計図を使用する 設計図: API Canary Canary ビルダー: 任意の Canary 名 Amazon API Gateway API を使用中: チェックを入れる API を選択: API Gateway から API とステージを選択 使用している API, ステージを選択 Host Name: 使用している Host Name を指定 HTTP リクエスト HTTP リクエストを追加ボタンを押下 監視したい API の情報を設定 スクリプトエディタ: スクリプトを参照 スケジュール: 任意のスケジュールを選択 アクセス許可 IAM ロール: 既存のロールを選択 ポリシーを参照 「保存」ボタンを押下 実際のコード スクリプト 基本的にはデフォルトのままで良いが Request Header に Cognito の ID トークンを付与する必要がある const synthetics = require(\u0026#39;Synthetics\u0026#39;); const log = require(\u0026#39;SyntheticsLogger\u0026#39;); const syntheticsConfiguration = synthetics.getConfiguration(); const AWS = require(\u0026#39;aws-sdk\u0026#39;); // 追加 const apiCanaryBlueprint = async function () { const response = getIdToken(); // 追加 const bearerToken = (await response).AuthenticationResult.IdToken; // 追加 syntheticsConfiguration.setConfig({ restrictedHeaders: [], // Value of these headers will be redacted from logs and reports restrictedUrlParameters: [] // Values of these url parameters will be redacted from logs and reports }); // Handle validation for positive scenario const validateSuccessful = async function(res) { return new Promise((resolve, reject) =\u0026gt; { if (res.statusCode \u0026lt; 200 || res.statusCode \u0026gt; 299) { throw new Error(res.statusCode + \u0026#39; \u0026#39; + res.statusMessage); } let responseBody = \u0026#39;\u0026#39;; res.on(\u0026#39;data\u0026#39;, (d) =\u0026gt; { responseBody += d; }); res.on(\u0026#39;end\u0026#39;, () =\u0026gt; { // Add validation on \u0026#39;responseBody\u0026#39; here if required. resolve(); }); }); }; // Set request option for 検証 https://api.xxx-xxx.com let requestOptionsStep1 = { hostname: \u0026#39;api.xxx-xxx.com\u0026#39;, method: \u0026#39;GET\u0026#39;, path: \u0026#39;/users/xxx\u0026#39;, port: \u0026#39;443\u0026#39;, protocol: \u0026#39;https:\u0026#39;, body: \u0026#34;\u0026#34;, headers: { \u0026#39;Authorization\u0026#39;: \u0026#39;Bearer \u0026#39; + bearerToken, // 追加 } }; requestOptionsStep1[\u0026#39;headers\u0026#39;][\u0026#39;User-Agent\u0026#39;] = [synthetics.getCanaryUserAgentString(), requestOptionsStep1[\u0026#39;headers\u0026#39;][\u0026#39;User-Agent\u0026#39;]].join(\u0026#39; \u0026#39;); // Set step config option for 検証 https://api.xxx-xxx.com let stepConfig1 = { includeRequestHeaders: true, includeResponseHeaders: true, restrictedHeaders: [\u0026#39;X-Amz-Security-Token\u0026#39;, \u0026#39;Authorization\u0026#39;], // Restricted header values do not appear in report generated. includeRequestBody: true, includeResponseBody: true, continueOnHttpStepFailure: true }; // 修正 Value contains non-ASCII characters. になるので 検証 =\u0026gt; 削除 await synthetics.executeHttpStep(\u0026#39;https://api.xxx-xxx.com\u0026#39;, requestOptionsStep1, validateSuccessful, stepConfig1); }; exports.handler = async () =\u0026gt; { return await apiCanaryBlueprint(); }; // 以下の関数追加 // ID トークン取得 async function getIdToken() { const secretsManager = new AWS.SecretsManager({ region: {RegionName}, }); const sec_response = await secretsManager .getSecretValue({ SecretId: {SecretId}, }) .promise(); const secretObject = JSON.parse(sec_response.SecretString); try { const cognito = new AWS.CognitoIdentityServiceProvider(); return await cognito.initiateAuth({ AuthFlow: \u0026#39;USER_PASSWORD_AUTH\u0026#39;, ClientId: secretObject.client_id, AuthParameters: { USERNAME: secretObject.email, PASSWORD: secretObject.password, }, }).promise(); } catch (err) { throw err; } } ポリシー 追加部分のみ抜粋 cognito-idp:InitiateAuth へのアクセス許可が必要 ※Secret Manager は必要に応じて追加 { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ ・・・ { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;secretsmanager:GetResourcePolicy\u0026#34;, \u0026#34;secretsmanager:GetSecretValue\u0026#34;, \u0026#34;secretsmanager:DescribeSecret\u0026#34;, \u0026#34;secretsmanager:ListSecretVersionIds\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:secretsmanager:ap-northeast-1:xxxxxxxxxxxx:secret:*\u0026#34; ] }, { \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Action\u0026#34;: [ \u0026#34;cognito-idp:InitiateAuth\u0026#34; ], \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:cognito-idp:ap-northeast-1:xxxxxxxxxxxx:userpool/ap-northeast-1_xxxxxxxxx\u0026#34; ] } ] }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/01/29/how-to-register-users-and-set-passwords-with-amazon-cognito-from-command/",
title: "Amazon Cognito でコマンドからユーザ登録およびパスワード設定を行う方法",
image: "images/logo/aws_logo.svg",
date: "2024-01-29",
body: "Amazon Cognito でコマンドからユーザ登録およびパスワード設定を行う方法 Amazon Cognito でコマンドからユーザ登録およびパスワード設定を行う方法について調査した内容を備忘録として残しておく 方法 該当の AWS Console にログインして AWS Cloud Shell 上で以下のコマンドを実行する 実際のコード ユーザ登録 \u0026ndash;user-attributes は必要に応じて増やす ※「\u0026ndash;message-action SUPPRESS」のオプションを付与することで対象ユーザへの通知を止めることが可能 aws cognito-idp admin-create-user \\ --user-pool-id \u0026lt;\u0026lt;ユーザプール ID\u0026gt;\u0026gt; \\ --username \u0026lt;\u0026lt;E メールアドレス ※E メールアドレスをユーザ名に設定した場合\u0026gt;\u0026gt; \\ --user-attributes Name=email,Value=\u0026lt;\u0026lt;E メールアドレス\u0026gt;\u0026gt; \\ Name=email_verified,Value=TRUE \\ --message-action SUPPRESS パスワード設定 \u0026ndash;no-permanent は仮パスワード扱い ※「\u0026ndash;permanent」オプションを付与で恒久パスワード扱いになる aws cognito-idp admin-set-user-password \\ --user-pool-id \u0026lt;\u0026lt;ユーザプール ID\u0026gt;\u0026gt; \\ --username \u0026lt;\u0026lt;ユーザ名 or sub\u0026gt;\u0026gt; \\ --password \u0026lt;\u0026lt;password\u0026gt;\u0026gt; \\ --no-permanent"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/01/17/tips-about-aws/",
title: "AWS についての Tips",
image: "images/logo/aws_logo.svg",
date: "2024-01-17",
body: "AWS についての Tips AWS についての Tips について備忘録として残しておく ※適宜、更新予定 DB の接続情報の確認 EC2 踏み台の Public IP を確認 ※通常は Elastic IP を付与しているので固定のはず EC2 \u0026gt; リソース \u0026gt; 該当のリソースを選択 パブリック IPv4 アドレス を確認 RDS RDS \u0026gt; データベース \u0026gt; 該当の DB 識別子を選択 接続とセキュリティ \u0026gt; エンドポイントを確認 RDS プロキシを設定している場合は以下 RDS \u0026gt; データベース \u0026gt; 該当の DB 識別子を選択 プロキシ \u0026gt; 該当のプロキシ識別子を選択 プロキシエンドポイント \u0026gt; エンドポイントを確認 Secret Manager DB のパスワードの設定確認方法 AWS Secrets Manager \u0026gt; DB のユーザパスワードを選択 シークレットの値 \u0026gt; [シークレットの値を取得する]ボタンを押下 パスワードを確認する バッチ処理について AWS 内で定期実行バッチの有無を確認する場合は以下を確認する Amazon EventBridge Scheduler Amazon EventBridge \u0026gt; スケジューラ \u0026gt; スケジュール \u0026gt; 該当のスケジュールを選択 スケジュール \u0026gt; cron 式 を確認 Amazon EventBridge Rule Cloud Formation で設定した場合はこっちを確認する ※Cloud Formation の定義を見た方が良いと思われる Amazon EventBridge \u0026gt; バス \u0026gt; ルール \u0026gt; 該当の関数を選択 イベントスケジュール \u0026gt; cron 式を確認 ECS 割愛 ※使用パターンが出た時に改めて記載 AWS Batch 割愛 ※使用パターンが出た時に改めて記載 ソース ソース内で cron あるいは schedule で検索 環境変数について CloudFormation CloudFormation を使用している場合には以下を確認することで設定値を確認可能 CloudFormation \u0026gt; スタック \u0026gt; 該当のスタック [パラメータ]タブの該当の値を確認 Cognito のメールについて 送信元メールアドレスの変更 Amazon Cognito \u0026gt; ユーザープール \u0026gt; {対象のユーザプール} を選択 メッセージング \u0026gt; E メール \u0026gt; 「編集」ボタンを押下 以下のように設定 E メールプロバイダー: Amazon SES で E メールを送信 - 推奨 送信元の E メールアドレス: 任意の E メールアドレス SES で検証済である必要あり 送信者の名前 - オプション 任意のメールアドレス メッセージ本文の変更 Amazon Cognito \u0026gt; ユーザープール \u0026gt; {対象のユーザプール} を選択 メッセージング \u0026gt; メッセージテンプレート \u0026gt; メッセージタイプを選択 検証メッセージ: 確認コード 招待メッセージ: 仮パスワード MFA メッセージ: 2 段階認証 「編集」ボタンを押下 件名, メッセージを修正して「変更を保存」ボタンを押下 HTML コードでカスタマイズ可能なため、改行は\u0026lt;br\u0026gt;タグで行う Cognito の検索について 検索に使用できる属性 検索に使用できる属性は以下の通り ※カスタム属性は使用できない username ※大文字/小文字区別 email phone_number name given_name family_name preferred_username cognito:user_status コンソールでは status 大文字/小文字区別しない status コンソールでは有効 大文字/小文字区別 sub 検索条件について 以下の条件が指定可能 ※部分一致は不可 完全一致 = 前方一致 ^= S3 について 空オブジェクトの扱いについて aws s3 cp や aws s3 sync では空オブジェクト(空フォルダ等)は同期されないため注意が必要 ※ダミーファイルを置く等しないといけない API Gateway の注意事項について 使用できないパスについて 以下のパスはサービスのヘルスチェック専用のためカスタムドメインのルートレベルのパスには使用しないよう注意が必要 ※それ以外の注意事項は公式を参照 /ping /sping"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/01/16/how-to-get-a-list-of-users-registered-in-user-pool-in-amazon-cognito/",
title: "Amazon Cognito でユーザプールに登録されているユーザ一覧を取得する方法",
image: "images/logo/aws_logo.svg",
date: "2024-01-16",
body: "Amazon Cognito でユーザプールに登録されているユーザ一覧を取得する方法 Amazon Cognito でユーザプールに登録されているユーザ一覧を取得する方法について調査した内容を備忘録として残しておく 方法 該当の AWS Console にログインして AWS Cloud Shell 上で以下のコマンドを実行する 実際のコード aws cognito-idp list-users \\ --user-pool-id {該当のユーザプール ID} \\ --filter \u0026#34;{検索に使用する属性} = \\\u0026#34;{検索文字列}\\\u0026#34;\u0026#34; \\ --attributes-to-get \u0026#34;{取得する属性(スペース区切りで複数指定可)}\u0026#34; \\ | jq -r \u0026#39;.Users[] | [.Username, .Attributes[].Value] | @csv\u0026#39; \\ | tr -d \u0026#39;\u0026#34;\u0026#39; \\ \u0026gt; user_pool_list.csv"
},
{
url: "https://kkawazoe.github.io/amp/blog/2024/01/16/how-to-get-a-list-of-registered-functions-in-amazon-lambda/",
title: "Amazon Lambda で登録されている関数一覧を取得する方法",
image: "images/logo/aws_logo.svg",
date: "2024-01-16",
body: "Amazon Lambda で登録されている関数一覧を取得する方法 Amazon Lambda で登録されている関数一覧を取得する方法について調査した内容を備忘録として残しておく 方法 該当の AWS Console にログインして AWS Cloud Shell 上で以下のコマンドを実行する 実際のコード aws lambda list-functions --region {リージョン名} \\ | jq \u0026#39;.Functions[] | [.FunctionName]\u0026#39; \\ | jq -rs \u0026#39;map([.[]])[] | @csv\u0026#39; \\ | tr -d \u0026#39;\u0026#34;\u0026#39; \\ \u0026gt; lambda-functions-list.csv"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/12/28/how-to-send-push-notifications-with-amazon-pinpoint-api/",
title: "Amazon Pinpoint API で push 通知を送信する方法",
image: "images/logo/aws_logo.svg",
date: "2023-12-28",
body: "Amazon Pinpoint API で push 通知を送信する方法 Amazon Pinpoint API で push 通知を送信する方法について調査した内容を備忘録として残しておく 前提構成: 前回記事を参照 方法 デベロッパーガイドを参照 ※上記の以下の部分はパラメータがほとんど同じため共通化した方が良さそう リファクタリング前 ・・・ if (service == \u0026#39;GCM\u0026#39;) { var messageRequest = { \u0026#39;Addresses\u0026#39;: { [token]: { \u0026#39;ChannelType\u0026#39;: \u0026#39;GCM\u0026#39; } }, \u0026#39;MessageConfiguration\u0026#39;: { \u0026#39;GCMMessage\u0026#39;: { \u0026#39;Action\u0026#39;: action, \u0026#39;Body\u0026#39;: message, \u0026#39;Priority\u0026#39;: priority, \u0026#39;SilentPush\u0026#39;: silent, \u0026#39;Title\u0026#39;: title, \u0026#39;TimeToLive\u0026#39;: ttl, \u0026#39;Url\u0026#39;: url } } }; } else if (service == \u0026#39;APNS\u0026#39;) { var messageRequest = { \u0026#39;Addresses\u0026#39;: { [token]: { \u0026#39;ChannelType\u0026#39; : \u0026#39;APNS\u0026#39; } }, \u0026#39;MessageConfiguration\u0026#39;: { \u0026#39;APNSMessage\u0026#39;: { \u0026#39;Action\u0026#39;: action, \u0026#39;Body\u0026#39;: message, \u0026#39;Priority\u0026#39;: priority, \u0026#39;SilentPush\u0026#39;: silent, \u0026#39;Title\u0026#39;: title, \u0026#39;TimeToLive\u0026#39;: ttl, \u0026#39;Url\u0026#39;: url } } }; } ・・・ リファクタリング後 ・・・ var messageRequest = { \u0026#39;Addresses\u0026#39;: { [token]: { \u0026#39;ChannelType\u0026#39;: service } }, \u0026#39;MessageConfiguration\u0026#39;: { /** * リファクタリングポイント: * []とテンプレートリテラルを使用して連装配列の key を動的に生成する */ [`${service}Message`]: { \u0026#39;Action\u0026#39;: action, \u0026#39;Body\u0026#39;: message, \u0026#39;Priority\u0026#39;: priority, \u0026#39;SilentPush\u0026#39;: silent, \u0026#39;Title\u0026#39;: title, \u0026#39;TimeToLive\u0026#39;: ttl, \u0026#39;Url\u0026#39;: url } } }; ・・・"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/12/20/how-to-set-up-push-notification-with-aws-and-firebase/",
title: "AWS と Firebase を連携して Push 通知を行う場合の設定について",
image: "images/logo/aws_logo.svg",
date: "2023-12-20",
body: "AWS と Firebase を連携して Push 通知を行う場合の設定について AWS と Firebase を連携して Push 通知を行う場合の設定について調査した内容を備忘録として残しておく 方法 Amazon Pinpoint を使用 Amazon Pinpoint \u0026gt; 使用を開始する \u0026gt; Pinpoint campaign orchestration を選択 [プロジェクトを管理]ボタンを押下 該当のプロジェクト名を選択 設定 \u0026gt; プッシュ通知 を選択 [編集]ボタンを押下 Apple Push Notification service (APNs) デフォルトの認証タイプ キー認証情報(推奨) 有効にする APN チャネルを選択 任意のチャネルを選択 キー ID Apple Developer Programで確認 バンドル識別子 Apple Developer Programで確認 チーム識別子 Apple Developer Programで確認 認証キー(.p8 ファイル) Apple Developer Programで取得 Firebase Cloud Messaging (FCM) デフォルトの認証タイプ トークン認証情報(推奨) サービス json (.json ファイル) Firebase で発行可能な秘密鍵を選択 ※google-services.json ではないので注意"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/12/20/how-to-access-postgresql-built-in-aws-ec2-with-pgadmin4/",
title: "pgAdmin4 で AWS の EC2 内に構築された PostgreSQL にアクセスする方法",
image: "images/logo/postgre_sql_logo.svg",
date: "2023-12-20",
body: "pgAdmin4 で AWS の EC2 内に構築された PostgreSQL にアクセスする方法 pgAdmin4 で AWS の EC2 内に構築された PostgreSQL にアクセスする方法を毎回手順を確認するため備忘録として残しておく 方法 事前作業 AWS Console にて接続に必要な情報を控えておく EC2 踏み台の Public IP を確認 EC2 \u0026gt; リソース \u0026gt; 該当のリソースを選択 パブリック IPv4 アドレス を確認 Elastic IP が紐付けられている場合は以下を確認する EC2 \u0026gt; Elastic IP を選択 関連付けられたインスタンス ID が一致するものを検索する 割り当てられた IPv4 アドレス を確認 RDS プロキシの設定がされている場合は以下を確認する RDS \u0026gt; プロキシ \u0026gt; {該当の DB 識別子} を選択 プロキシエンドポイントを確認 その他 DB のパスワード (Secrets Manager)の設定確認方法 AWS Secrets Manager \u0026gt; DB のユーザパスワードを選択 シークレットの値 \u0026gt; [シークレットの値を取得する]ボタンを押下 パスワードを確認する pgAdmin4 での作業 プロパティにそれぞれ以下の値を設定する 接続 ホスト名/アドレス: {事前作業で確認した RDS の DB 識別子} ポート番号: 5432 ※別のを指定している場合はそちらに従う 管理用データベース: postgres ※別のを指定している場合はそちらに従う ユーザ名: postgres ※別のを指定している場合はそちらに従う パスワード: {事前作業で確認した DB のパスワード} SSH トンネル SSH トンネリングを使用: オン トンネルホスト: {事前作業で確認した EC2 の Public IP} トンネルポート番号: 22 ユーザ名: ec2-user 認証: 識別情報ファイルを選択 識別情報ファイル: 該当 EC2 接続用の pem キーを選択"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/12/02/how-to-measure-and-display-event-parameters-set-by-gtm-in-ga/",
title: "Google Analytics で Google Tag Manager で設定したイベントパラメータを計測および表示を行う方法",
image: "images/logo/google_analytics_logo.png",
date: "2023-12-02",
body: "Google Analytics で Google Tag Manager で設定したイベントパラメータを計測および表示を行う方法 Google Analytics(GA) で Google Tag Manager(以下 GTM) で設定したイベントパラメータを計測および表示を行う方法を備忘録として残しておく 前提 ソースコードに GTM との連携用のスクリプトが導入済であること ソースコード上に以下のようなカスタムイベント発火のコードが設定されていること pushDataLayer({ event: \u0026#34;watch_video\u0026#34;, userID: userId, datetime: `${date}${time}`, }); 方法 [管理] \u0026gt; [データの収集と修正] \u0026gt; [データ ストリーム]を選択 対象のサイトを選択 測定 ID をコピーして退避しておく [Google マーケティング プラットフォーム] \u0026gt; [タグマネージャー]を選択 GTM での作業 変数の登録 [変数] \u0026gt; [ユーザ定義変数] \u0026gt; [新規]ボタンを押下 変数名に「user_id」と入力 変数のタイプに[データレイヤーの変数]を選択 データレイヤーの変数名に「userId」を入力 [保存]ボタンを押下 「datetime」も同じように登録する トリガーの登録 [トリガー] \u0026gt; [新規]ボタンを押下 名称に「動画再生」と入力 [トリガーの設定]の中央アイコンを押下 [その他] \u0026gt; [カスタムイベント]を選択 イベント名に「watch_video」を入力 [保存]ボタンを押下 タグの登録 [タグ] \u0026gt; [新規]ボタンを押下 名称に「動画再生」と入力 [トリガー]の中央アイコンを押下 トリガーの登録で登録した「動画再生」を選択 [タグの設定]の中央アイコンを押下 [Google アナリティクス] \u0026gt; [Google アナリティクス: GA4 イベント]を選択 測定 ID に事前に退避しておいた測定 ID を入力 イベント名に「watch_video」を入力 イベント パラメータに 「user_id」を入力 値に「{{user_id}}」を入力 イベント パラメータに 「datetime」を入力 値に「{{datetime}}」を入力 [保存]ボタンを押下 [プレビュー]ボタンを押下してカスタムイベントが測定されることを確認 [公開]ボタンを押下 GA での作業 カスタムディメンションの設定 Google Analytics にログイン [管理]\u0026gt;[データの表示]\u0026gt;[カスタム定義]を選択 [カスタム ディメンションを作成]を押下 ディメンション名に「ユーザID」と入力 範囲に「イベント」を選択 説明に任意の値を入力 イベント パラメータに「user_id」を入力 「保存」ボタンを押下 datetime も同じように登録 ※ディメンション名は「イベント実行時間」 動画再生時間収集用の探索の設定 ※探索は前日までのデータしか対象にできないため設定の確認は後日に行うことになる [探索]を選択 [空白]を選択 ディメンションの右横にある[+]ボタンを押下 [カスタム]\u0026gt;[ユーザID]のチェックを入れる [カスタム]\u0026gt;[イベント実行時間]のチェックを入れる [インポート]ボタンを押下 期間を対象期間に変更する [フィルタ]\u0026gt;[イベント名]を選択 [条件]\u0026gt;[マッチ タイプを選択してください]に「次と完全一致」を選択 [条件]\u0026gt;「式を入力」に「watch_video」を入力 後は、表示したい項目を行、列、値に組み込んでいく"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/12/01/debug-to-local-environment-with-gtm/",
title: "Google Tag Manager でローカル環境のデバッグを行う方法",
image: "images/logo/google_tag_manager_logo.svg",
date: "2023-12-01",
body: "Google Tag Manager でローカル環境のデバッグを行う方法 Google Tag Manager でローカル環境のデバッグを行う方法を備忘録として残しておく 前提 Google Tag Manager(以下 GTM) に検証用のコンテナを準備して コンテナ ID をローカル環境に設定してあること ローカル環境を起動してブラウザでアクセスできる状態であること 方法 GTM にログイン [プレビュー]リンクから Tag Assistant を起動 Tag Assistantの「Your website’s URL」にローカル環境のURLを入力 [Connect] ボタンを押下"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/11/26/refactoring-to-multi-search-conditional-with-rails/",
title: "rails で複数検索条件のリファクタリング",
image: "images/logo/rails_logo.svg",
date: "2023-11-26",
body: "rails で複数検索条件のリファクタリング 検索条件の入力が複数あるような画面で入力があった条件のみを AND 条件としたい場合、メソッド内に if 文が乱立してしまい、可読性が下がってしまう そのため、将来的に条件が追加された場合でも、可読性が下がらないようにリファクタリングした内容を備忘録として残しておく 環境 ruby: 3.0.5 rails: 6.1.7 方法 検索条件をそれぞれ scope に切り出す scope 内で skip 条件を next if で記載する メソッドでそれぞれの scope を呼び出す 前提 検索条件はメソッドの引数として Hash 形式で渡される 実際の例 タイトルと内容で入力があった場合に AND 条件で検索を行い、条件にあった本を取得する ※全ての条件が未入力の場合は全件表示 class Book \u0026lt; ApplicationRecord scope :with_title, -\u0026gt; (title) do next if title.blank? where(\u0026#39;title LIKE ?\u0026#39;, \u0026#34;%#{title}%\u0026#34;) end scope :with_summary, -\u0026gt; (summary) do next if summary.blank? where(\u0026#39;summary LIKE ?\u0026#39;, \u0026#34;%#{summary}%\u0026#34;) end def self.search(options: {}) with_title(options[:title]) .with_summary(options[:summary]) end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/11/13/how-to-install-warp-with-mac/",
title: "Mac に Warp をインストールする方法",
image: "images/logo/icons8-mac-os-logo.svg",
date: "2023-11-13",
body: "Mac に Warp をインストールする方法 Mac に Warp をインストールする方法を備忘録として残しておく 手順 home brew を使用してインストール $ brew install --cask warp 設定 公式サイト を参照 注意点 日本語を入力中は Terminal 上に表示がされない Vim や Github のコミットメッセージ等に厳しい ※2023/11/13 時点 issue で長い間リクエストはされているが Feature Request"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/06/05/how-to-run-go-tour-locally/",
title: "Go Tour のローカルでの実行方法",
image: "images/logo/golang_logo.svg",
date: "2023-06-05",
body: "Go Tour のローカルでの実行方法 Go Tour をローカルで実行しようとした際に手順通りに行った際にエラーが発生したため調査を行った際の調査結果を備忘録として残しておく 環境 OS : MacOS Ventura(13.4) golang: go1.20.4 エラー内容 go get github.com/atotto/go-tour-jp/gotour gotour #=\u0026gt; zsh: command not found: gotour 対応方法 以下のコマンドで実行する tour"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/04/29/how-to-manage-split-routes-with-rails/",
title: "rails で routes.rb を分割管理する方法",
image: "images/logo/rails_logo.svg",
date: "2023-04-29",
body: "rails で routes.rb を分割管理する方法 プロジェクト自体が大きくなってきた際に routes.rb にまとめて記載すると見づらくて追加しようとした際にわかりずらい課題が発生した そのため、rails で routes.rb を分割管理する方法を備忘録として残しておく 参考 環境 ruby: 3.0.5 rails: 6.1.7 方法 concern を使用して共通の routes を定義する draw を使用して別ファイルに分割する 前提 config |-routes | |-concerns.rb # プロジェクト共通の routes | |-foo_service_provider.rb # Foo サービス用の routes | |-hoge_service_provider.rb # Hoge サービス用の routes | |-service_provider_common.rb # サービス共通の routes |-routes.rb 実際の例 concern :loggable do get \u0026#34;login\u0026#34;, to: \u0026#34;sessions#new\u0026#34; post \u0026#34;login\u0026#34;, to: \u0026#34;sessions#create\u0026#34; delete \u0026#34;logout\u0026#34;, to: \u0026#34;sessions#destroy\u0026#34; end concern :data do namespace :data do get \u0026#34;download\u0026#34; end end namespace :service_provider, path: \u0026#34;services\u0026#34; do concerns :loggable scope :home, as: :home do get \u0026#34;/\u0026#34;, to: \u0026#34;home#index\u0026#34; end end draw(:service_provider_common) namespace :service_provider, path: \u0026#34;services\u0026#34; do concerns :data end draw(:service_provider_common) namespace :service_provider, path: \u0026#34;services\u0026#34; do resources :users, only: [:index, :show] end # == Route Map # # Prefix Verb URI Pattern Controller#Action # admin_login GET /admin/login(.:format) admin/sessions#new # POST /admin/login(.:format) admin/sessions#create # admin_logout DELETE /admin/logout(.:format) admin/sessions#destroy # foo_service_provider_login GET /foo/services/login(.:format) foo/service_provider/sessions#new # POST /foo/services/login(.:format) foo/service_provider/sessions#create # foo_service_provider_logout DELETE /foo/services/logout(.:format) foo/service_provider/sessions#destroy # foo_service_provider_home GET /foo/services/home(.:format) foo/service_provider/home#index # foo_service_provider_users GET /foo/services/users(.:format) foo/service_provider/users#index # foo_service_provider_user GET /foo/services/users/:id(.:format) foo/service_provider/users#show # hoge_service_provider_data_download GET /hoge/services/data/download(.:format) hoge/service_provider/data#download # hoge_service_provider_users GET /hoge/services/users(.:format) hoge/service_provider/users#index # hoge_service_provider_user GET /hoge/services/users/:id(.:format) hoge/service_provider/users#show Rails.application.routes.draw do draw(:concerns) namespace :admin do concerns :loggable end namespace :foo do draw(:foo_service_provider) end namespace :hoge do draw(:hoge_service_provider) end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/04/12/not-displayed-image-jpeg-for-production-with-rails/",
title: "rails で本番環境で画像が表示されない場合に確認すること(jpeg)",
image: "images/logo/rails_logo.svg",
date: "2023-04-12",
body: "rails で本番環境で画像が表示されない場合に確認すること(jpeg) rails で本番環境で画像が表示されない場合に確認することを備忘録として残しておく ※表示されない画像が jpeg の場合 環境 ruby: 3.0.5 rails: 6.1.7 事象について 開発環境では表示されていた画像が本番環境にデプロイしてみると画像が表示されない事象が発生した。 ※scss の background-image の image-url かと思ったが view ファイルの image_tag で発生していた sass-rails 原因について assets-precompile 時に xxx.jpeg =\u0026gt; xxx.jpg に統一されるため、 Not Found 扱いになるらしい 上記のため、 image_tag で指定している拡張子を jpg に指定してあげる必要がある ※可能であれば、画像自体の拡張子を jpg に統一してあげると手戻りがないと思われる"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/02/11/migration-active-model-serializers-to-panko-serializer-with-rails/",
title: "rails で ActiveModelSerializers から PankoSerializer に移行する",
image: "images/logo/rails_logo.svg",
date: "2023-02-11",
body: "rails で ActiveModelSerializers から PankoSerializer に移行する rails で ActiveModelSerializers から PankoSerializer に移行する手順を備忘録として残しておく ※今回のは、単純な serializer のみのため、panko_serializer について検証が必要 環境 ruby: 3.0.5 rails: 6.1.7 active_model_serializers: 0.10.13 panko_serializer: 0.7.9 実際のソース [Gemfile] - gem \u0026#39;active_model_serializers\u0026#39; + gem \u0026#39;panko_serializer\u0026#39; [serializer] 継承するクラスを変更 - class Book::ListSerializer \u0026lt; ActiveModel::Serializer + class Book::ListSerializer \u0026lt; Panko::Serializer attributes( :id, :title, :summary, :restrict, :to_favorite_registered_count ) def restrict Book.restricts[object.restrict] end end [controller] each_serializer を使用する場合 def index @books = Book.all - render json: @books, each_serializer: Book::ListSerializer + render json: Panko::ArraySerializer.new(@books, each_serializer: Book::ListSerializer).to_json end 単一の serializer を使用する場合 def show @book = Book.find(params[:id]) - render json: @book, serializer: BookSerializer + render json: BookSerializer.new.serialize_to_json(@book) end 性能比較について 参考 を参照"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/02/08/how-to-redirect-to-get-transition-url-with-rails/",
title: "rails で遷移元の URL を取得してリダイレクトする方法",
image: "images/logo/rails_logo.svg",
date: "2023-02-08",
body: "rails で遷移元の URL を取得してリダイレクトする方法 rails で遷移元の URL を取得してリダイレクトする方法を備忘録として残しておく 環境 ruby: 2.7.6 rails: 5.2.8.1 仕様 お気に入り登録のようにDB更新を行いたいが、画面遷移はさせたくない (遷移元が複数ある かつ ユーザビリティ的に良くない)ため 画面遷移させないようにしたい 実際のソース controller の該当アクションを以下のようにする class FavoritesController \u0026lt; ApplicationController def create redirect_back fallback_location: root_path end end # 以下も上手くいくが referer が取得できなかった場合を考えると上が良さそう class FavoritesController \u0026lt; ApplicationController def create redirect_to request.referer end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/02/03/how-to-validate-unique-for-multi-columns-with-rails/",
title: "rails で複合項目で一意性チェックを行う方法",
image: "images/logo/rails_logo.svg",
date: "2023-02-03",
body: "rails で複合項目で一意性チェックを行う方法 rails で複合項目で一意性チェックを行う方法を備忘録として残しておく 環境 ruby: 3.0.5 rails: 6.1.7 実際のコード [ER 図] ER 図 [model] uniqueness + scope で validate を行う class Book has_many :book_categories, dependent: :destroy has_many :categories, through: :book_categories end class BookCategory belongs_to :book belongs_to :category # book_id + category_id で一意かどうかをチェック validates :book_id, uniqueness: { scope: :category_id } end class Category has_many :book_categories has_many :books, through: :book_categories end [migrate] unique index を追加する class CreateBookCategoriess \u0026lt; ActiveRecord::Migration[6.1] def change create_table :book_categories do |t| t.references :book, foreign_key: true t.references :category, foreign_key: true t.timestamps end add_index :book_categories, [:book_id, :category_id], unique: true change_table_comment :book_categories, \u0026#39;本のカテゴリー\u0026#39; end end [rspec] FactoryBot + shoulda-matchers 導入している場合 require \u0026#39;rails_helper\u0026#39; describe BookCategory, type: :model do describe \u0026#39;validations\u0026#39; do subject { FactoryBot.build(:book_category) } context \u0026#39;book_id\u0026#39; do it { is_expected.to validate_uniqueness_of(:book_id).scoped_to(:category_id) } end end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/01/27/how-to-accordion-content-with-pr-for-github/",
title: "GitHub の PR で折りたたみコンテンツを使用する方法",
image: "images/logo/github_logo.svg",
date: "2023-01-27",
body: "GitHub の PR で折りたたみコンテンツを使用する方法 GitHub の PR を作成する際に縦に長くなりすぎるため、折りたたみコンテンツを使用している その方法を備忘録として残しておく 実際のコード html タグの details, summary タグを使用する ※画像を入れる場合は、1行空行を入れないと展開されないため要注意 \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;その１\u0026lt;/summary\u0026gt; ![画像1](/images/logo/github_logo.svg) \u0026lt;/details\u0026gt;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/01/25/how-to-through-a-path-with-m1-for-mac/",
title: "Mac(M1) で Path を通す方法",
image: "images/logo/icons8-mac-os-logo.svg",
date: "2023-01-25",
body: "Mac(M1) で Path を通す方法 Mac(M1) でパスを通す際に Intel の場合と同じ手順では上手くいかなかったので備忘録として残しておく 手順 例. mysql の path を通す場合 ※Homebrew でインストールしたもの インストール先の path を確認 $ brew --prefix mysql@5.7 #=\u0026gt; /opt/homebrew/opt/mysql@5.7 ~/.zshrc に追記する $ echo \u0026#39;export PATH=\u0026#34;$PATH:/opt/homebrew/opt/mysql@5.7/bin\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc $ source ~/.zshrc 動作確認 $ mysql--version #=\u0026gt; mysql Ver 14.14 Distrib 5.7.40, for osx10.17 (x86_64) using EditLine wrapper"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/01/12/how-to-omit-0s-in-decimals-when-displaying-on-screen-in-rails/",
title: "rails で画面表示時に小数部分の0を省略して表示する方法",
image: "images/logo/rails_logo.svg",
date: "2023-01-12",
body: "rails で画面表示時に小数部分の0を省略して表示する方法 rails で画面表示時に小数部分の0を省略して表示する方法を備忘録として残しておく 環境 ruby: 3.0.4 rails: 6.1.0 実際のコード number_to_human メソッドを使用する ※参考 ※strip_insignidicant_zeros オプションのデフォルトが true のため その他のヘルパーについてはNumberHelperを参照 # erb ファイルに記載する場合は ActiveSupport::NumberHelper. は省略可 ActiveSupport::NumberHelper.number_to_human(1.0) #=\u0026gt; \u0026#34;1\u0026#34; ActiveSupport::NumberHelper.number_to_human(1.5) #=\u0026gt; \u0026#34;1.5\u0026#34; ActiveSupport::NumberHelper.number_to_human(1.530) #=\u0026gt; \u0026#34;1.53\u0026#34; ActiveSupport::NumberHelper.number_to_human(1.5301) #=\u0026gt; \u0026#34;1.53\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;1.0\u0026#39;) #=\u0026gt; \u0026#34;1\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;1.5\u0026#39;) #=\u0026gt; \u0026#34;1.5\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;1.530\u0026#39;) #=\u0026gt; \u0026#34;1.53\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;1.5301\u0026#39;) #=\u0026gt; \u0026#34;1.53\u0026#34; ActiveSupport::NumberHelper.number_to_human(Date.parse(\u0026#39;2023-01-12\u0026#39;)) #=\u0026gt; Thu, 12 Jan 2023 ActiveSupport::NumberHelper.number_to_human(\u0026#39;2023-01-12\u0026#39;) #=\u0026gt; \u0026#34;2023-01-12\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;2023.01.12\u0026#39;) #=\u0026gt; \u0026#34;2023-01-12\u0026#34; ActiveSupport::NumberHelper.number_to_human(\u0026#39;2023.01.12\u0026#39;) #=\u0026gt; \u0026#34;2023.01.12\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2023/01/11/how-to-change-behavior-with-initializer-often-seen-in-gem/",
title: "Gem でよく見る initializer で動作を変更する方法",
image: "images/logo/rails_logo.svg",
date: "2023-01-11",
body: "Gem でよく見る initializer で動作を変更する方法 Gem でよく見る initializer で動作を変更する方法を備忘録として残しておく 環境 ruby: 3.0.4 前提 以下のような構成になっている想定 lib ├── sample_gem │ └── configuration.rb └── sample_gem.rb spec ├── configration_spec.rb └── spec_helper.rb 実際のコード 以下のようなクラスを定義する module SampleGem # gem のクラス名 class Configuration attr_accessor :sample_confime_name # config で使用する config 名 def initialize @sample_confime_name = false end end def self.configuration @configuration ||= Configuration.new end def self.configuration=(config) @configuration = config end # ``` # SampleGem.configure do |config| # config.sample_confime_name = false # end # ``` def self.configure yield configuration end end 以下のように、require する require \u0026#39;sample_gem/configuration\u0026#39; とすると initializer 側で以下のように設定を変更できる SampleGem.configure do |config| config.sample_confime_name = true end RSpec spec_helper で以下を設定しておかないと、設定が引き継がれた状態でテストが実行される RSpec.configure do |config| config.before { restore_default_config } end def restore_default_config SampleGem.configuration = nil end 設定のテストは以下のようにする require File.expand_path(\u0026#39;../lib/sample_gem/configuration\u0026#39;, File.dirname(__FILE__)) require File.expand_path(\u0026#39;spec_helper\u0026#39;, File.dirname(__FILE__)) describe SampleGem::Configuration do let(:config) { SampleGem.configuration } context \u0026#34;when sample_confime_name is set to true\u0026#34; do it \u0026#34;returns true\u0026#34; do SampleGem.configure { |config| config.sample_confime_name = true } expect(SampleGem.configuration.sample_confime_name).to eq true end end context \u0026#34;when sample_confime_name is not specified\u0026#34; do it \u0026#34;defaults to false\u0026#34; do expect(SampleGem.configuration.sample_confime_name).to eq false end end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/27/how-to-assignment-multiple-sort-key-with-ransack/",
title: "Ransack でソートキーを複数指定する方法",
image: "images/logo/rails_logo.svg",
date: "2022-12-27",
body: "Ransack でソートキーを複数指定する方法 Ransack でソートキーを複数指定する方法を備忘録として残しておく 環境 ruby: 3.0.4 rails: 6.1.0 実際のコード sort_link ヘルパーメソッドの第三引数に指定する ※その他の機能については参考を参照 # ソート順序 第1ソートキー: last_name, 第2ソートキー: first_name # 画面上のソートリンクをクリックする度に両方のキーの昇順、降順が入れ替わる \u0026lt;%= sort_link(@q, :last_name, %i(last_name first_name), \u0026#39;Last Name\u0026#39;) %\u0026gt; 第2ソートキーを常に昇順 or 降順固定にする場合は以下のようにする \u0026lt;%= sort_link(@q, :last_name, [:last_name, \u0026#39;first_name asc\u0026#39;], \u0026#39;Last Name\u0026#39;) %\u0026gt;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/18/how-to-convert-mov-to-gif-with-mac-os/",
title: "Mac OS で mov を gif に変換する方法",
image: "images/logo/icons8-mac-os-logo.svg",
date: "2022-12-18",
body: "Mac OS で mov を gif に変換する方法 Mac OS で mov を gif に変換する方法を備忘録として残しておく 手順 ffmpeg を使用する ※ファイルのリサイズのために Image Magick も使用 ffmpeg, Image Magick のインストール brew install ffmpeg brew install imagemagick gif に変換 ファイルサイズを少なくするために圧縮も行う cd 動画のあるディレクトリ ffmpeg -i {変換対象}.mov -an -r 20 %06d.png # 20 frames/secでpng作成 ※6 桁連番の png ファイルを生成 convert *.png -resize 50% output_%06d.png # 作成した png を 50% にリサイズ convert output_*.png result.gif # gif に変換 # 生成された gif の確認は以下で行える ※Google Chrome インストールしている場合 open -a /Applications/Google\\ Chrome.app result.gif 画像が多少荒くても良いのであれば以下 ffmpeg -i {変換対象}.mov -r 24 result.gif Mac Os Logo icon by Icons8"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/17/how-to-auto-deploy-configure-hugo-and-github-pages/",
title: "Hugo と GitHub Pages の構成で自動デプロイを行う方法",
image: "images/logo/github_logo.svg",
date: "2022-12-17",
body: "Hugo と GitHub Pages の構成で自動デプロイを行う方法 元々バッチを使用して手動でデプロイを行っていたが、自動デプロイする方法がないか調査を行った その結果を備忘録として残しておく 前提 [構成] Hugo + GitHub Pages(master ブランチが対象) ※source ブランチを Hugo で変換して master ブランチに静的サイト用の資産を配置する Hugo テーマは submodule として取り込み 実際のコード GitHub Actions を使用する リポジトリ直下に .github/workflows フォルダを作成して配下に yml ファイルを配置することで GitHub Actions が登録される ※ source ブランチの push をトリガーに自動デプロイを行う source ブランチをチェックアウト Hugo(Docker) を使用して、静的サイト用の資産を作成 master ブランチに push して GitHub Pages にデプロイする name: Deploy on: push: branches: - source # Target Branch Name jobs: deploy: runs-on: ubuntu-22.04 steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Deleting old publication run: rm -rf public - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.91.2\u0026#39; extended: true - name: Build run: hugo - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_branch: master publish_dir: ./public 定期実行する場合は、以下のようにする name: Scheduled Post on: schedule: - cron: \u0026#39;0 4 * * *\u0026#39; # Run every day at 13:00pm(JST). jobs: deploy: runs-on: ubuntu-22.04 steps: - uses: actions/checkout@v3 with: ref: \u0026#39;source\u0026#39; # Checkout Branch Name submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Deleting old publication run: rm -rf public - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.91.2\u0026#39; extended: true - name: Build run: hugo - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_branch: master publish_dir: ./public"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/16/how-to-convert-active-record-to-hash-with-rails/",
title: "Rails で Active Record のデータを hash 形式に変換する方法",
image: "images/logo/rails_logo.svg",
date: "2022-12-16",
body: "Rails で Active Record のデータを hash 形式に変換する方法 Rails で Active Record のデータを キーが id, 値が Active Record であるような Hash を作る方法を備忘録として残しておく 環境 ruby: 3.0.4 rails: 6.1.0 実際のコード index_by, inject, pluck + to_h メソッドのいずれかを使用する 前提 データの登録状態 id book_id name 1 1 少年誌 2 1 青年誌 3 1 ビジネス 4 1 自己啓発 [Rails Console] categories = Category.all.index_by(\u0026amp;:id) #=\u0026gt; { #=\u0026gt; 1=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b92c5fcb0 #=\u0026gt; id: 1, #=\u0026gt; book_id: 1, #=\u0026gt; name: \u0026#34;少年誌\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 02:54:05.711796000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 02:54:05.711796000 UTC +00:00\u0026gt;, #=\u0026gt; 2=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b92c97160 #=\u0026gt; id: 2, #=\u0026gt; book_id: 1, #=\u0026gt; name: \u0026#34;青年誌\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 02:54:45.283884000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 02:54:45.283884000 UTC +00:00\u0026gt;, #=\u0026gt; 3=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b92c97098 #=\u0026gt; id: 3, #=\u0026gt; book_id: 2, #=\u0026gt; name: \u0026#34;ビジネス\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 03:13:14.155937000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 03:13:14.155937000 UTC +00:00\u0026gt;, #=\u0026gt; 4=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b92c96f80 #=\u0026gt; id: 4, #=\u0026gt; book_id: 2, #=\u0026gt; name: \u0026#34;自己啓発\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 03:13:21.284702000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 03:13:21.284702000 UTC +00:00\u0026gt; #=\u0026gt; } index_by メソッドの引数はブロックなのでキーの加工も可能 categories = Category.all.index_by { |c| \u0026#34;category_#{c.id}\u0026#34; } #=\u0026gt; { #=\u0026gt; \u0026#34;category_1\u0026#34;=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b9325f598 #=\u0026gt; id: 1, #=\u0026gt; book_id: 1, #=\u0026gt; name: \u0026#34;少年誌\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 02:54:05.711796000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 02:54:05.711796000 UTC +00:00\u0026gt;, #=\u0026gt; \u0026#34;category_2\u0026#34;=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b9325f4d0 #=\u0026gt; id: 2, #=\u0026gt; book_id: 1, #=\u0026gt; name: \u0026#34;青年誌\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 02:54:45.283884000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 02:54:45.283884000 UTC +00:00\u0026gt;, #=\u0026gt; \u0026#34;category_3\u0026#34;=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b9325f3e0 #=\u0026gt; id: 3, #=\u0026gt; book_id: 2, #=\u0026gt; name: \u0026#34;ビジネス\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 03:13:14.155937000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 03:13:14.155937000 UTC +00:00\u0026gt;, #=\u0026gt; \u0026#34;category_4\u0026#34;=\u0026gt; #=\u0026gt; #\u0026lt;Category:0x0000562b9325f318 #=\u0026gt; id: 4, #=\u0026gt; book_id: 2, #=\u0026gt; name: \u0026#34;自己啓発\u0026#34;, #=\u0026gt; created_at: Wed, 24 Aug 2022 03:13:21.284702000 UTC +00:00, #=\u0026gt; updated_at: Wed, 24 Aug 2022 03:13:21.284702000 UTC +00:00\u0026gt; #=\u0026gt; } value の方も加工したい場合には inject メソッドを使用する categories = Category.all.inject({}) do |hash, c| hash[c.id] = c.name hash end #=\u0026gt; {1=\u0026gt;\u0026#34;少年誌\u0026#34;, 2=\u0026gt;\u0026#34;青年誌\u0026#34;, 3=\u0026gt;\u0026#34;ビジネス\u0026#34;, 4=\u0026gt;\u0026#34;自己啓発\u0026#34;} ちなみに上記のような出し方がしたいのであれば下記でも良い categories = Category.all.pluck(:id, :name).to_h #=\u0026gt; {1=\u0026gt;\u0026#34;少年誌\u0026#34;, 2=\u0026gt;\u0026#34;青年誌\u0026#34;, 3=\u0026gt;\u0026#34;ビジネス\u0026#34;, 4=\u0026gt;\u0026#34;自己啓発\u0026#34;}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/05/road-to-ruby-gold-ver-3-part5/",
title: "Ruby Gold 認定試験 Ver 3 への道 その5",
image: "images/logo/ruby_logo.svg",
date: "2022-12-05",
body: "Ruby Gold 認定試験 Ver 3 への道 その5 Ruby Gold 認定試験の Ver 3 の勉強時に学んだことを備忘録として残しておく [前回までの記事] Ruby Gold 認定試験 Ver 3 への道 Ruby Gold 認定試験 Ver 3 への道 その2 Ruby Gold 認定試験 Ver 3 への道 その3 Ruby Gold 認定試験 Ver 3 への道 その4 受験結果 無事に合格した 前回、 ver 2 受験時と難易度的には同じくらいだったように思う なので、基本的にはオブジェクト指向周りを再確認する 3 系から追加された 「hash 明示(**hash)」などはリリースノートで確認して置いた方が良いが 2.2 〜 2.7 系での変更点についても押さえておくとより良いと思う NEWS for Ruby 3.0.0 Ruby 3.0.0 リリースノート 勉強に使用したもの 公式の模擬問題 基本的には、上記をやって該当のコードを自分でコーディングしながら、色々変更して動作確認するのが一番良さそう"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/02/about-enum-in-rails/",
title: "Rails における Enum について",
image: "images/logo/rails_logo.svg",
date: "2022-12-02",
body: "Rails における Enum について Rails における Enum の挙動について調査した内容を備忘録として残しておく 環境 ruby: 2.7.6 rails: 5.2.8.1 実際のコード DB のカラムに対応する enum を定義した場合、自動的に scope が定義される ※Rails 6 では not_* の scope も自動的に定義される 参考 ※Rails 7 では新しい構文が追加されたため、今後オプションの指定が従来のやり方だと非推奨になる可能性がある 参考 [モデル定義] class Article \u0026lt; ApplicationRecord enum status: { draft: 0, # 下書き published: 1, # 公開中 closed: 2, # 掲載終了 }, _prefix: true end [Rails Console] # enum 確認 Article.statuses #=\u0026gt; {\u0026#34;draft\u0026#34;=\u0026gt;0, \u0026#34;published\u0026#34;=\u0026gt;1, \u0026#34;closed\u0026#34;=\u0026gt;2} # scope Article.status_published #=\u0026gt; Article Load (7.8ms) SELECT `articles`.* FROM `articles` WHERE `articles`.`status` = 1 # 以下と同義 Article.where(status: :published).to_sql #=\u0026gt; \u0026#34;SELECT `articles`.* FROM `articles` WHERE `articles`.`status` = 1\u0026#34; 他にも以下のヘルパーが使用できる article = Article.status_published.first # status が published かどうか article.status_published? #=\u0026gt; true # status を closed に更新 article.status_closed! #=\u0026gt; TRANSACTION (0.5ms) BEGIN #=\u0026gt; Article Update (0.9ms) UPDATE \u0026#34;articles\u0026#34; SET \u0026#34;status\u0026#34; = $1, \u0026#34;updated_at\u0026#34; = $2 #=\u0026gt; WHERE \u0026#34;articles\u0026#34;.\u0026#34;id\u0026#34; #=\u0026gt;= $3 [[\u0026#34;status\u0026#34;, 2], [\u0026#34;updated_at\u0026#34;, \u0026#34;2022-12-04 10:17:57.666814\u0026#34;], [\u0026#34;id\u0026#34;, 1]] #=\u0026gt; TRANSACTION (8.0ms) COMMIT #=\u0026gt; true article #=\u0026gt; \u0026lt;Article:0x000055a42ece8f38 #=\u0026gt; id: 1, #=\u0026gt; name: \u0026#34;サンプル記事\u0026#34;, #=\u0026gt; status: \u0026#34;closed\u0026#34;, #=\u0026gt; created_at: Sun, 04 Dec 2022 10:10:22.903934000 UTC +00:00, #=\u0026gt; updated_at: Sun, 04 Dec 2022 10:17:57.666814000 UTC +00:00\u0026gt;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/12/01/road-to-ruby-gold-ver-3-part4/",
title: "Ruby Gold 認定試験 Ver 3 への道 その4",
image: "images/logo/ruby_logo.svg",
date: "2022-12-01",
body: "Ruby Gold 認定試験 Ver 3 への道 その4 Ruby Gold 認定試験の Ver 3 の勉強時に学んだことを備忘録として残しておく [前回までの記事] Ruby Gold 認定試験 Ver 3 への道 Ruby Gold 認定試験 Ver 3 への道 その2 Ruby Gold 認定試験 Ver 3 への道 その3 環境 ruby: 3.1.2 キーワード引数 キーワード引数で a: のようなデフォルト値を指定しない場合、構文エラーにはならないが、呼び出し時に指定しなかった場合に ArgumentError になる class KeywordArgument def foo(a:, b: \u0026#39;bbb\u0026#39;) puts \u0026#34;a: #{a}, b: #{b}\u0026#34; end end keyword_argument = KeywordArgument.new keyword_argument.foo(a: \u0026#39;aaa\u0026#39;, b: \u0026#39;BBB\u0026#39;) #=\u0026gt; a: aaa, b: BBB keyword_argument.foo(a: \u0026#39;aaa\u0026#39;) #=\u0026gt; a: aaa, b: bbb keyword_argument.foo #=\u0026gt; ./keyword_argument.rb:2:in `foo\u0026#39;: missing keyword: :a (ArgumentError) #=\u0026gt;\tfrom ./keyword_argument.rb:8:in `\u0026lt;main\u0026gt;\u0026#39; グローバル変数, クラス変数, インスタンス変数 グローバル変数 グローバル変数のため全体で同じ変数を参照 class GlobalArgument $count = 0 def increment $count = $count + 1 puts $count end def self.increment $count = $count + 1 puts $count end end class ExtendGlobalArgument \u0026lt; GlobalArgument def increment $count = $count + 2 puts $count end end global_argument = GlobalArgument.new global_argument2 = ExtendGlobalArgument.new global_argument.increment #=\u0026gt; 1 global_argument2.increment #=\u0026gt; 3 global_argument.increment #=\u0026gt; 4 global_argument2.increment #=\u0026gt; 6 クラス変数 クラスごとに変数が管理される class ClassVariable @@count = 0 def increment @@count = @@count + 1 puts @@count end def self.increment @@count = @@count + 1 puts @@count end end class ExtendClassVariable \u0026lt; ClassVariable def increment @@count = @@count + 2 puts @@count end end class_argument = ClassVariable.new class_argument2 = ExtendClassVariable.new class_argument.increment #=\u0026gt; 1 class_argument2.increment #=\u0026gt; 3 class_argument.increment #=\u0026gt; 4 class_argument2.increment #=\u0026gt; 6 インスタンス変数 グローバル変数、クラス変数と同じ要領で書くとエラー class InstanceVariable @count = 0 def increment @count = @count + 1 puts @count end def self.increment @count = @count + 1 puts @count end end class ExtendInstanceVariable \u0026lt; InstanceVariable def increment @count = @count + 2 puts @count end end instance_variable = InstanceVariable.new instance_variable2 = ExtendInstanceVariable.new instance_variable.increment #=\u0026gt; ./instance_variable.rb:5:in `increment\u0026#39;: undefined method `+\u0026#39; for nil:NilClass (NoMethodError) #=\u0026gt; @count = @count + 1 accessor もしくは initialize メソッドでの初期化が必要 ※インスタンスごとに変数が管理される class InstanceVariable def initialize @count = 0 end def increment @count = @count + 1 puts @count end def self.increment @count = @count + 1 puts @count end end class ExtendInstanceVariable \u0026lt; InstanceVariable def increment @count = @count + 2 puts @count end end instance_variable = InstanceVariable.new instance_variable2 = ExtendInstanceVariable.new instance_variable.increment #=\u0026gt; 1 instance_variable2.increment #=\u0026gt; 2 instance_variable.increment #=\u0026gt; 2 instance_variable2.increment #=\u0026gt; 4 singleton を include した場合は同一インスタンスを返却するようになる require \u0026#39;singleton\u0026#39; class SingletonInstanceVariable include Singleton def initialize @count = 0 end def increment @count = @count + 1 puts @count end def self.increment @count = @count + 1 puts @count end end class ExtendSingletonInstanceVariable \u0026lt; SingletonInstanceVariable def increment @count = @count + 2 puts @count end end # SingletonInstanceVariable.new は使えない =\u0026gt; NoMethodError instance_variable = SingletonInstanceVariable.instance instance_variable2 = ExtendSingletonInstanceVariable.instance instance_variable3 = SingletonInstanceVariable.instance instance_variable.increment #=\u0026gt; 1 instance_variable2.increment #=\u0026gt; 2 instance_variable3.increment #=\u0026gt; 2 instance_variable.increment #=\u0026gt; 3 instance_variable2.increment #=\u0026gt; 4 instance_variable3.increment #=\u0026gt; 4 引数の異なるメソッドを継承先のクラスで定義した際の super の挙動 super 指定時に () を省略した場合は super と同じ指定がされたものと見なされるため Arguments Error となる class Foo def foo(a, b) puts \u0026#34;Foo#foo a=#{a}, b=#{b}\u0026#34; end end class Bar \u0026lt; Foo def foo(a) super puts \u0026#34;Bar#foo a=#{a}\u0026#34; end end foo = Foo.new foo.foo(\u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;) #=\u0026gt; Foo#foo a=A, b=B bar = Bar.new bar.foo(\u0026#39;aaa\u0026#39;) #=\u0026gt; ./inheritance_method.rb:2:in `foo\u0026#39;: wrong number of arguments (given 1, expected 2) (ArgumentError) #=\u0026gt; from ./inheritance_method.rb:9:in `foo\u0026#39; #=\u0026gt; from ./inheritance_method.rb:19:in `\u0026lt;main\u0026gt;\u0026#39; デフォルト値を指定してある場合は呼び出せる class Foo def foo(a, b = \u0026#39;BBB\u0026#39;) puts \u0026#34;Foo#foo a=#{a}, b=#{b}\u0026#34; end end class Bar \u0026lt; Foo def foo(a) super puts \u0026#34;Bar#foo a=#{a}\u0026#34; end end foo = Foo.new foo.foo(\u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;) #=\u0026gt; Foo#foo a=A, b=B bar = Bar.new bar.foo(\u0026#39;aaa\u0026#39;) #=\u0026gt; Foo#foo a=aaa, b=BBB #=\u0026gt; Bar#foo a=aaa もしくは、super に渡す引数を指定する class Foo def foo(a, b) puts \u0026#34;Foo#foo a=#{a}, b=#{b}\u0026#34; end end class Bar \u0026lt; Foo def foo(a) super(a, \u0026#39;BB\u0026#39;) puts \u0026#34;Bar#foo a=#{a}\u0026#34; end end foo = Foo.new foo.foo(\u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;) #=\u0026gt; Foo#foo a=A, b=B bar = Bar.new bar.foo(\u0026#39;aaa\u0026#39;) #=\u0026gt; Foo#foo a=aaa, b=BB #=\u0026gt; Bar#foo a=aaa method_missing 該当のメソッドが存在しなかった場合に呼び出されるメソッド module M def method_missing(id, *args) puts \u0026#34;C#method_missing\u0026#34; end end class A include M def method_missing(id, *args) puts \u0026#34;A#method_missing\u0026#34; end end class B \u0026lt; A def method_missing(id, *args) puts \u0026#34;B#method_missing\u0026#34; end end obj = B.new obj.test_method #=\u0026gt; \u0026#34;B#method_missing\u0026#34; Object クラスに定義したメソッドについて クラス定義に使用する Class クラスは、 Object クラスの子孫にあたるため Object クラスに定義したメソッドは呼び出し可能 [Class クラスの継承リスト] Class \u0026lt; Module \u0026lt; Object \u0026lt; Kernel \u0026lt; BasicObject class Object def foo puts \u0026#39;Object#foo\u0026#39; end end class Foo def foo super puts \u0026#39;Foo#foo\u0026#39; end end class Bar \u0026lt; Foo def foo super puts \u0026#39;Bar#foo\u0026#39; end end bar = Bar.new bar.foo #=\u0026gt; Object#foo #=\u0026gt; Foo#foo #=\u0026gt; Bar#foo 定数の探索範囲 module M CONSTANT_A = \u0026#39;A\u0026#39;.freeze end class A include M CONSTANT_A = \u0026#39;AAA\u0026#39;.freeze def foo puts M::CONSTANT_A puts CONSTANT_A end end class B \u0026lt; A CONSTANT_A = \u0026#39;BBB\u0026#39;.freeze def foo super puts CONSTANT_A end end class C \u0026lt; B CONSTANT_C = \u0026#39;CCC\u0026#39;.freeze def foo super puts CONSTANT_A end class D CONSTANT_D = \u0026#39;DDD\u0026#39;.freeze def foo puts CONSTANT_C # puts CONSTANT_A #=\u0026gt; uninitialized constant C::D::CONSTANT_A (NameError) #=\u0026gt; Did you mean? C::D::CONSTANT_D #=\u0026gt; C::CONSTANT_C # puts ::CONSTANT_A #=\u0026gt; uninitialized constant CONSTANT_A (NameError) super #=\u0026gt; super: no superclass method `foo\u0026#39; for #\u0026lt;C::D:0x000000010502f840\u0026gt; (NoMethodError) #=\u0026gt; Did you mean? for puts ::A::CONSTANT_A puts ::B::CONSTANT_A end end end a = A.new b = B.new c = C.new d = C::D.new a.foo #=\u0026gt; A #=\u0026gt; AAA b.foo #=\u0026gt; A #=\u0026gt; AAA #=\u0026gt; BBB c.foo #=\u0026gt; A #=\u0026gt; AAA #=\u0026gt; BBB #=\u0026gt; BBB d.foo #=\u0026gt; CCC #=\u0026gt; AAA #=\u0026gt; BBB"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/25/road-to-ruby-gold-ver-3-part3/",
title: "Ruby Gold 認定試験 Ver 3 への道 その3",
image: "images/logo/ruby_logo.svg",
date: "2022-11-25",
body: "Ruby Gold 認定試験 Ver 3 への道 その3 Ruby Gold 認定試験の Ver 3 の勉強時に学んだことを備忘録として残しておく [前回までの記事] Ruby Gold 認定試験 Ver 3 への道 Ruby Gold 認定試験 Ver 3 への道 その2 環境 ruby: 3.1.2 public_send メソッド Object#public_send メソッドは private メソッドを呼び出せない private_send メソッドは存在しない ※private メソッドを 呼び出す場合は Object#send or BasicObject#__send__ メソッドを使用する class PublicTest def public_method puts \u0026#39;call public methods\u0026#39; end private def private_method puts \u0026#39;call private methods\u0026#39; end end test = PublicTest.new test.public_method test.private_method #=\u0026gt; call public methods #=\u0026gt; public_send.rb:17:in `\u0026lt;main\u0026gt;\u0026#39;: private method `private_method\u0026#39; called for #\u0026lt;PublicTest:0x00000001046769e8\u0026gt; (NoMethodError) #=\u0026gt; test.private_method #=\u0026gt; Did you mean? private_methods begin \u0026amp; rescue でエラークラスを省略した際の動作 class ExceptionTest def foo begin exit rescue =\u0026gt; e puts \u0026#39;Default Rescue\u0026#39; rescue SystemExit =\u0026gt; e puts \u0026#39;System Exit\u0026#39; ensure puts \u0026#39;Ensure\u0026#39; end puts \u0026#39;End\u0026#39; end end t = ExceptionTest.new t.foo #=\u0026gt; System Exit #=\u0026gt; Ensure #=\u0026gt; End 定数の書き換え メソッド内での書き換えは不可 class Foo AAA = \u0026#39;AAA\u0026#39; BBB = \u0026#39;BBB\u0026#39; def foo puts AAA end end class Bar \u0026lt; Foo def foo AAA = \u0026#39;aaa\u0026#39; puts AAA end end b = Bar.new b.foo #=\u0026gt; modified_constants.rb:12: dynamic constant assignment #=\u0026gt; AAA = \u0026#39;aaa\u0026#39; メソッド外であれば書き換え可能 class Foo AAA = \u0026#39;AAA\u0026#39; BBB = \u0026#39;BBB\u0026#39; def foo puts AAA end end class Buzz \u0026lt; Foo AAA = \u0026#39;aaa\u0026#39; def foo puts AAA end end b = Buzz.new b.foo #=\u0026gt; aaa 同クラス内で定義している場合は warning が発生する ※freeze している/していない 関係なく class Hoge AAA = \u0026#39;AAA\u0026#39;.freeze def foo puts AAA end end class Fuga \u0026lt; Hoge AAA = \u0026#39;aaa\u0026#39;.freeze AAA = \u0026#39;bbb\u0026#39; def foo puts AAA end end f = Fuga.new f.foo #=\u0026gt; modified_constants.rb:11: warning: already initialized constant Fuga::AAA #=\u0026gt; modified_constants.rb:10: warning: previous definition of AAA was here #=\u0026gt; bbb filter_map メソッド p [1.34, -1.49, 2.7].filter_map {|n| n.round if 0 \u0026lt; n } # これがリファレンスにも乗っているパターン #=\u0026gt; [1, 3] p [1.34, -1.49, 2.7].filter_map {|n| 0 \u0026lt; n \u0026amp;\u0026amp; n.round } # 上と同じ結果 #=\u0026gt; [1, 3] p [1.34, -1.49, 2.7].filter_map {|n| 0 \u0026lt; n } #=\u0026gt; [true, true] p [1.34, -1.49, 2.7].filter_map {|n| 0 \u0026lt; n || n.round } #=\u0026gt; [true, -1, true]"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/24/road-to-ruby-gold-ver-3-part2/",
title: "Ruby Gold 認定試験 Ver 3 への道 その2",
image: "images/logo/ruby_logo.svg",
date: "2022-11-24",
body: "Ruby Gold 認定試験 Ver 3 への道 その2 Ruby Gold 認定試験の Ver 3 の勉強時に学んだことを備忘録として残しておく [前回までの記事] Ruby Gold 認定試験 Ver 3 への道 環境 ruby: 3.1.2 __FILE__ __FILE__ が書いてあるファイルのファイル名を表す 似たようなので $0 があるがこちらは直接実行したファイルのファイル名を表す puts __FILE__ puts $0 require_relative \u0026#39;./file_name\u0026#39; $ ruby file_name.rb __FILE__: file_name.rb $0: file_name.rb $ ruby require_file_name.rb __FILE__: file_name.rb $0: require_file_name.rb 累乗の計算 def exponentiation(n) n ** n end puts exponentiation(-1) #=\u0026gt; -1 puts exponentiation(1i) #=\u0026gt; 0.20787957635076193+0.0i 複素数 正規表現 =~ の $1 等 \u0026#39;www.ruby.co.jp\u0026#39;.match(%r(www(\\.ruby\\.co)(\\.jp))) do |e| puts \u0026#34;match e= #{e}\u0026#34; puts \u0026#34;match e[0]= #{e[0]}\u0026#34; puts \u0026#34;match e[1]= #{e[1]}\u0026#34; puts \u0026#34;match e[2]= #{e[2]}\u0026#34; puts \u0026#34;match $0 #{$0}\u0026#34; puts \u0026#34;match $\u0026amp; #{$\u0026amp;}\u0026#34; puts \u0026#34;match $1 #{$1}\u0026#34; puts \u0026#34;match $2 #{$2}\u0026#34; end #=\u0026gt; match e= www.ruby.co.jp #=\u0026gt; match e[0]= www.ruby.co.jp #=\u0026gt; match e[1]= .ruby.co #=\u0026gt; match e[2]= .jp #=\u0026gt; match $0 regex.rb # 実行ファイル名 #=\u0026gt; match $\u0026amp; www.ruby.co.jp #=\u0026gt; match $1 .ruby.co #=\u0026gt; match $2 .jp"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/23/road-to-ruby-gold-ver-3/",
title: "Ruby Gold 認定試験 Ver 3 への道",
image: "images/logo/ruby_logo.svg",
date: "2022-11-23",
body: "Ruby Gold 認定試験 Ver 3 への道 Ruby Gold 認定試験の Ver 3 の勉強時に学んだことを備忘録として残しておく 環境 ruby: 3.1.2 Numbered parameters _1 から始まる _1, _2 で 第一引数, 第二引数の意味となる 以下は同じ意味 h = { a: 1, b: 2, c: 3 } h.transform_values{|v| v * 2} #=\u0026gt; {:a=\u0026gt;2, :b=\u0026gt;4, :c=\u0026gt;6} h.transform_values{_1 * 2} #=\u0026gt; {:a=\u0026gt;2, :b=\u0026gt;4, :c=\u0026gt;6} h = { a: 1, b: 2, c: 3 } h.map{|key, value| [key, value * 2]}.to_h #=\u0026gt; {:a=\u0026gt;2, :b=\u0026gt;4, :c=\u0026gt;6} h = { a: 1, b: 2, c: 3 } h.map{[_1, _2 * 2]}.to_h #=\u0026gt; {:a=\u0026gt;2, :b=\u0026gt;4, :c=\u0026gt;6} #=\u0026gt; hash に対して map! はエラーとなる \u0026lt;\u0026lt;EOF, \u0026lt;\u0026lt;-EOF, \u0026lt;\u0026lt;~EOF の動作の違い 詳細は ヒアドキュメント 参照 ・\u0026lt;\u0026lt;EOF print \u0026lt;\u0026lt;EOF # 識別子 EOF までがリテラルになる the string next line EOF 以下と同じ意味 print \u0026#34; the string\\nnext line\\n\u0026#34; ・\u0026lt;\u0026lt;-EOF if need_define_foo eval \u0026lt;\u0026lt;-EOF # \u0026#39;\u0026lt;\u0026lt;-\u0026#39; を使うと…… def foo print \u0026#34;foo\\n\u0026#34; end EOF #↑終端行をインデントできる end ・\u0026lt;\u0026lt;~EOF 最もインデントが少ない行を基準にして、全ての行の先頭から空白を取り除く インデントの深さを決定するため、タブやスペースで構成された行は無視されるので注意が必要 ただし、エスケープされたタブやスペースは通常の文字と同じように扱われる expected_result = \u0026lt;\u0026lt;~SQUIGGLY_HEREDOC This would contain specially formatted text. That might span many lines SQUIGGLY_HEREDOC # =\u0026gt; \u0026#34;This would contain specially formatted text.\\n\u0026#34; + \u0026#34;\\n\u0026#34; + \u0026#34;That might span many lines\\n\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/22/how-to-modified-config-value-for-extensions-with-visual-studio-code/",
title: "Visual Studio Code で拡張子毎に設定値を変更する方法",
image: "images/logo/vscode_logo.png",
date: "2022-11-22",
body: "Visual Studio Code で拡張子毎に設定値を変更する方法 経緯 Visual Studio Code にて保存時の空白のトリミングの挙動を markdown の場合のみ変えたくなったため調査を行なった その結果を備忘録として残しておく 手順 コマンドパレットを開く Configure language specific settings を入力して選択する 拡張子を質問されるので markdown を選択する settings.json ファイルに以下のように編集する 実際の設定ファイル { \u0026#34;[markdown]\u0026#34;: { \u0026#34;files.trimTrailingWhitespace\u0026#34;: false } }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/22/how-to-disable-auto-complete-with-rails-console/",
title: "rails console で オートコンプリートを無効にする方法",
image: "images/logo/rails_logo.svg",
date: "2022-11-22",
body: "rails console で オートコンプリートを無効にする方法 ruby 3.1 以降から irb でオートコンプリートが効くようになったがそれを無効にする方法を調査した その結果を備忘録として残しておく 環境 ruby: 3.1.2 rails: 6.1.7 方法 カレントディレクトに .irbrc ファイルを作成して以下のように編集する ※他の設定値については 参考 を参照 IRB.conf[:USE_AUTOCOMPLETE] = false IRB.conf[:SAVE_HISTORY] = nil"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/03/how-to-select-check-box-for-create-through-table-with-rails/",
title: "rails で中間テーブルをチェックボックス複数選択させて生成する方法",
image: "images/logo/rails_logo.svg",
date: "2022-11-03",
body: "rails で中間テーブルをチェックボックス複数選択させて生成する方法 環境 ruby: 2.7.6 rails: 5.2.8.1 前提 rails で has_many の ids を使用して中間テーブルの関連付けを行う方法 の構成を参照 実際のコード erb で行うパターンと javascript で行うパターンはそれぞれ以下 ※基本的には erb で行うと思うが、 erb の構成に対して値を受け渡す場合にjavascript のパターンを使用する erb のパターン association を使用して as: :check_boxes オプションを指定する \u0026lt;%= simple_form_for @book do |f| %\u0026gt; \u0026lt;%= f.association :categories, as: :check_boxes %\u0026gt; \u0026lt;%= f.button :submit %\u0026gt; \u0026lt;% end %\u0026gt; javascript のパターン 最終的に生成される params が以下のようになるように組み立てる [\u0026quot;\u0026quot;, 1, 3] $(\u0026#39;form\u0026#39;).append( `\u0026lt;input type=\u0026#34;hidden\u0026#34; value=\u0026#34;\u0026#34; name=\u0026#34;book[category_ids][]\u0026#34; /\u0026gt;`, ); book.category_ids.forEach((category_id) =\u0026gt; { $(\u0026#39;form\u0026#39;).append( `\u0026lt;input type=\u0026#34;hidden\u0026#34; value=\u0026#34;${category_id}\u0026#34; name=\u0026#34;book[category_ids][]\u0026#34; id=\u0026#34;book_category_ids_${category_id}\u0026#34; /\u0026gt;`, ); }); erb + javascript javascript のパターンの \u0026lt;input type=\u0026quot;hidden\u0026quot; value=\u0026quot;\u0026quot; name=\u0026quot;book[category_ids][]\u0026quot; /\u0026gt; 部分を erb で行うパターン [erb] \u0026lt;%= simple_form_for @book do |f| %\u0026gt; \u0026lt;%= f.hidden_field :category_ids, multiple: true, value: nil %\u0026gt; \u0026lt;%= f.button :submit %\u0026gt; \u0026lt;% end %\u0026gt; [javascript] $(\u0026#39;form\u0026#39;).append( `\u0026lt;input type=\u0026#34;hidden\u0026#34; value=\u0026#34;\u0026#34; name=\u0026#34;book[category_ids][]\u0026#34; /\u0026gt;`, ); book.category_ids.forEach((category_id) =\u0026gt; { $(\u0026#39;form\u0026#39;).append( `\u0026lt;input type=\u0026#34;hidden\u0026#34; value=\u0026#34;${category_id}\u0026#34; name=\u0026#34;book[category_ids][]\u0026#34; id=\u0026#34;book_category_ids_${category_id}\u0026#34; /\u0026gt;`, ); });"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/01/how-to-use-has-many-ids-for-create-relation-through-table-with-rails/",
title: "rails で has_many の ids を使用して中間テーブルの関連付けを行う方法",
image: "images/logo/rails_logo.svg",
date: "2022-11-01",
body: "rails で has_many の ids を使用して中間テーブルの関連付けを行う方法 環境 ruby: 2.7.6 rails: 5.2.8.1 実際のコード [ER 図] ER 図 [model] class Book has_many :book_categories, dependent: :destroy has_many :categories, through: :book_categories end class BookCategory belongs_to :book belongs_to :category end class Category has_many :book_categories has_many :books, through: :book_categories end [controller] category_ids を配列形式で許可する def create @book = Book.save!(book_params) end private def book_params params.require(:book).permit( :title, category_ids: [] ) end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/11/01/how-to-user-scope-for-link-to-with-ransack/",
title: "ransack で scope を使用して link_to で表示する方法",
image: "images/logo/rails_logo.svg",
date: "2022-11-01",
body: "ransack で scope を使用して link_to で表示する方法 方法 ransackable_scopes メソッドを使用して実現する 環境 ruby: 2.7.6 rails: 5.2.8.1 実際のコード 例. User モデルの created_at カラムを基準として N 以内に作成されたユーザを取得する [model] # 引数なし scope :within_one_month, -\u0026gt; { where(\u0026#39;created_at \u0026gt;=\u0026#39;, Time.zone.now - 1.months) } # 引数あり scope :within_days, -\u0026gt; (day) { where(\u0026#39;created_at \u0026gt;=\u0026#39;, Time.zone.now - (day).days) } def self.ransackable_scopes(_auth_object = nil) %i(within_days within_one_month) end [erb] \u0026lt;%= link_to( \u0026#34;1ヶ月以内に作成されたユーザ一覧\u0026#34;, users_path(@q, q: { within_one_month: true }), class: \u0026#34;btn btn-primary mr-5\u0026#34; ) link_to( \u0026#34;7日以内に作成されたユーザ一覧\u0026#34;, users_path(@q, q: { within_days: 7 }), class: \u0026#34;btn btn-primary mr-5\u0026#34; ) %\u0026gt; [controller] 通常通りで動作する User.ransack(@q).result"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/10/30/how-to-dynamic-create-test-data-for-factory-bot-with-rspec/",
title: "rspec で factory bot を使用して複数テストを作成すると同時に関連するクラスを紐づけて動的に生成する方法",
image: "images/logo/rails_logo.svg",
date: "2022-10-30",
body: "rspec で factory bot を使用して複数テストを作成すると同時に関連するクラスを紐づけて動的に生成する方法 方法 create_list と send メソッドを使用して実現する 環境 ruby: 2.7.6 rails: 5.2.8.1 rspec 3.7.0 実際のコード user のテストデータを3つ作成 かつ 関連する user_status のテストデータを紐付けおよびカラム status を動的に生成する let(:user_status1) { UserStatus::Active } let(:user_status2) { UserStatus::Locked } let(:user_status3) { UserStatus::InActive } before do create_list(:user, 3).each.with_index(1) do |user, i| create( :user_status, user: user, status: send(\u0026#34;user_status#{i}\u0026#34;), ) end end rspec 5.2 以降であれば以下も可能 参考 let(:user_status1) { UserStatus::Active } let(:user_status2) { UserStatus::Locked } let(:user_status3) { UserStatus::InActive } before do create_list(:user, 3) do |user, i| create( :user_status, user: user, status: send(\u0026#34;user_status#{i + 1}\u0026#34;), ) end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/09/14/text-align-left-center-with-css/",
title: "CSS テキストを左揃えのまま中央寄せにする方法",
image: "images/logo/html_logo.svg",
date: "2022-09-14",
body: "CSS テキストを左揃えのまま中央寄せにする方法 css でテキストを左揃えのまま中央寄せにする方法を備忘録として残しておく 実際のソースおよび実行結果 中央寄せかつテキストの行頭を揃える"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/09/03/how-to-excute-stream-too-big-file-size-csv-with-rails/",
title: "rails で 巨大な csv ファイルをストリーム処理する方法",
image: "images/logo/rails_logo.svg",
date: "2022-09-03",
body: "rails で 巨大な csv ファイルをストリーム処理する方法 1 GB を超えるような csv ファイルを一度に読み込むとメモリエラーが発生する場合がある さらに処理時間もすごくかかるため、ストリーム処理に変更などして処理の高速化した際の方法を備忘録として残しておく 方法 File#open メソッドと CSV#new メソッドを組み合わせて実現する 環境 ruby: 3.0.4 rails: 6.1.6.1 実際のコード csv ファイルの特定の文字列を置換する処理 前提 header 付の csv ファイル リファクタリング前 class Converter def self.convert # 読み取り専用でファイルを開く read_only_file = File.open(\u0026#34;{ファイルパス}\u0026#34; , \u0026#34;r\u0026#34;) # 保存用バッファ buffer = read_only_file.read() # バッファの中身を変換 buffer.gsub!({置換対象文字列}, {置換文字列}) # ファイルを書き込みモードで開き直す file = File.open(\u0026#34;{ファイルパス}\u0026#34; , \u0026#34;w\u0026#34;) # 変更内容を出力する file.write(buffer) # close read_only_file.close() file.close() end end リファクタリング後 require \u0026#39;csv\u0026#39; require \u0026#39;fileutils\u0026#39; class Converter def self.convert file_basename = \u0026#34;{拡張子を除いたファイル名}\u0026#34; # 読み取り専用でファイルを開く File.open(\u0026#34;#{file_basename}.csv\u0026#34;, \u0026#34;r\u0026#34;) do |file| break if File.zero?(\u0026#34;#{file_basename}.csv\u0026#34;) # 一時ファイルを書き込みモードで開く write_file = File.open(\u0026#34;#{file_basename}_tmp.csv\u0026#34;, \u0026#34;w\u0026#34;) # csv の header を書き込む write_file.write(file.readline) file.rewind CSV.new(file, headers: true).each do |row| # 読み込んだ行内の文字列を置換する write_file.write(row.to_s.gsub({置換対象文字列}, {置換文字列})) end write_file.close end FileUtils.move(\u0026#34;#{file_basename}_tmp.csv\u0026#34;, \u0026#34;#{file_basename}.csv\u0026#34;) if File.exist?(\u0026#34;#{file_basename}_tmp.csv\u0026#34;) end end ヘッダは force quote なし ボディは force quote ありのようにしたい場合 id,名前 \u0026#34;1\u0026#34;,\u0026#34;太郎\u0026#34; CSV#open メソッドを使用する require \u0026#39;csv\u0026#39; require \u0026#39;fileutils\u0026#39; class Converter def self.convert file_basename = \u0026#34;{拡張子を除いたファイル名}\u0026#34; # 読み取り専用でファイルを開く File.open(\u0026#34;#{file_basename}.csv\u0026#34;, \u0026#34;r\u0026#34;) do |file| break if File.zero?(\u0026#34;#{file_basename}.csv\u0026#34;) # 一時ファイルを書き込みモードで開く CSV.open(\u0026#34;#{file_basename}_tmp.csv\u0026#34;, \u0026#34;w\u0026#34;) do |csv| # csv の header を書き込む csv \u0026lt;\u0026lt; file.readline.parse_csv end file.rewind # 一時ファイルを追記モードで開く CSV.open(\u0026#34;#{file_basename}_tmp.csv\u0026#34;, \u0026#34;a\u0026#34;, force_quotes: true) do |csv| CSV.new(file, headers: true).each do |row| # 読み込んだ行内の文字列を置換する csv \u0026lt;\u0026lt; row.to_s.gsub({置換対象文字列}, {置換文字列}).parse_csv end end end FileUtils.move(\u0026#34;#{file_basename}_tmp.csv\u0026#34;, \u0026#34;#{file_basename}.csv\u0026#34;) if File.exist?(\u0026#34;#{file_basename}_tmp.csv\u0026#34;) end end 1.4 GB 程の csv ファイルを処理した際にリファクタリング前は、1 時間 40 分程度だったものが 5 分程度の処理時間に改善した"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/09/03/how-to-substring-map-with-rails/",
title: "rails で文字列置換を行う際に対応表で置換する方法",
image: "images/logo/rails_logo.svg",
date: "2022-09-03",
body: "rails で文字列置換を行う際に対応表で置換する方法 rails で文字列置換を行う際に対応表で置換する方法を備忘録として残しておく 方法 gsub メソッドに対して、第1引数に正規表現、第2引数に Hash を渡すことで実現する 環境 ruby: 3.0.4 rails: 6.1.6.1 実際のコード # 変換用の対応表 convert_map = { \u0026#39;a\u0026#39; =\u0026gt; \u0026#39;A\u0026#39;, \u0026#39;b\u0026#39; =\u0026gt; \u0026#39;B\u0026#39;, \u0026#39;d\u0026#39; =\u0026gt; \u0026#39;D\u0026#39; } #=\u0026gt; {\u0026#34;a\u0026#34;=\u0026gt;\u0026#34;A\u0026#34;, \u0026#34;b\u0026#34;=\u0026gt;\u0026#34;B\u0026#34;, \u0026#34;d\u0026#34;=\u0026gt;\u0026#34;D\u0026#34;} # 以下と同義 # \u0026#34;adcacbd\u0026#34;.gsub(/a|b|d/, { \u0026#39;a\u0026#39; =\u0026gt; \u0026#39;A\u0026#39;, \u0026#39;b\u0026#39; =\u0026gt; \u0026#39;B\u0026#39;, \u0026#39;d\u0026#39; =\u0026gt; \u0026#39;D\u0026#39; }) \u0026#34;adcacbd\u0026#34;.gsub(Regexp.new(\u0026#34;#{convert_map.keys.join(\u0026#39;|\u0026#39;)}\u0026#34;), convert_map) #=\u0026gt; \u0026#34;ADcAcBD\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/08/28/how-to-get-number-of-lines-with-cent-os/",
title: "CentOS でファイル内の行数を取得する方法",
image: "images/logo/cent_os_logo.png",
date: "2022-08-28",
body: "CentOS でファイル内の行数を取得する方法 CentOS でファイル内の行数を取得する方法を備忘録として残しておく 方法 wc コマンドの -l オプションを使用する 環境 CentOS: CentOS Linux release 8.4.2105 実際のコード # 該当のファイルが存在するディレクトリに移動して実行 wc -l # 拡張子で対象を絞りたい場合は以下 # 例. 拡張子が「.csv」のファイルの行数を取得 wc -l `find ./ -name \u0026#39;*.csv\u0026#39;`"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/08/23/how-to-get-alias-column-pluck-method-with-rails/",
title: "rails で別名がつけられているカラムを pluck で取得する方法",
image: "images/logo/rails_logo.svg",
date: "2022-08-23",
body: "rails で別名がつけられているカラムを pluck で取得する方法 rails で別名がつけられているカラムを pluck で取得する方法を備忘録として残しておく 方法 シンボルでの指定ではなく、文字列で as 句含めて指定する 環境 rails: 6.1.6.1 実際のコード 例. Book と Category クラスの関係が 1 対 多 である場合 # Book クラス class Book \u0026lt; ApplicationRecord has_many :categories end # Category クラス class Category \u0026lt; ApplicationRecord belongs_to :book end # データ準備 book = Book.create!(name: \u0026#39;サンプル書籍\u0026#39;) book.categories \u0026lt;\u0026lt; Category.create(name: \u0026#39;ビジネス\u0026#39;) book.categories \u0026lt;\u0026lt; Category.create(name: \u0026#39;自己啓発\u0026#39;) # 別名を付与したカラムを取得 category_names = Book.joins(:categories) .select(:name, \u0026#39;categories.name as category_name\u0026#39;) .where(id: 1) .pluck(\u0026#39;categories.name as category_name\u0026#39;) # (1.2ms) SELECT categories.name as category_name FROM \u0026#34;books\u0026#34; INNER JOIN \u0026#34;categories\u0026#34; ON \u0026#34;categories\u0026#34;.\u0026#34;book_id\u0026#34; = \u0026#34;books\u0026#34;.\u0026#34;id\u0026#34; WHERE \u0026#34;books\u0026#34;.\u0026#34;id\u0026#34; = $1 [[\u0026#34;id\u0026#34;, 1]] #=\u0026gt; [\u0026#34;ビジネス\u0026#34;, \u0026#34;自己啓発\u0026#34;] # 別テーブルの同名カラムも可能 category_names = Book.joins(:categories) .select(:name, \u0026#39;categories.name as category_name\u0026#39;) .where(id: 1) .pluck(:name, \u0026#39;categories.name as category_name\u0026#39;) # (1.0ms) SELECT \u0026#34;books\u0026#34;.\u0026#34;name\u0026#34;, categories.name as category_name FROM \u0026#34;books\u0026#34; INNER JOIN \u0026#34;categories\u0026#34; ON \u0026#34;categories\u0026#34;.\u0026#34;book_id\u0026#34; = \u0026#34;books\u0026#34;.\u0026#34;id\u0026#34; WHERE \u0026#34;books\u0026#34;.\u0026#34;id\u0026#34; = $1 [[\u0026#34;id\u0026#34;, 1]] #=\u0026gt; [[\u0026#34;サンプル書籍\u0026#34;, \u0026#34;ビジネス\u0026#34;], [\u0026#34;サンプル書籍\u0026#34;, \u0026#34;自己啓発\u0026#34;]]"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/08/22/how-to-get-count-specific-string-with-postgre-sql/",
title: "PostgreSQL で テーブルのカラム内の特定の文字数を取得する方法",
image: "images/logo/postgre_sql_logo.svg",
date: "2022-08-22",
body: "PostgreSQL で テーブルのカラム内の特定の文字数を取得する方法 PostgreSQL で テーブルのカラム内の特定の文字数を取得する方法を備忘録として残しておく 方法 sum, length, regexp_replace を使用する 環境 PostgreSQL: 13.3 実際のコード regexp_replace 関数で name カラム内の 「仼」、「鶴」を空文字に置換 length 関数で 1 の置換前の文字数および置換後の文字数を取得 sum 関数で 2 で取得したものを計算(置換前文字数 - 置換後文字数) ※coalsesce 関数は null が返却された場合のデフォルト値を設定 select \u0026#39;ユーザテーブル--名前カラム中の「仼」または「鶴」の件数\u0026#39;, coalesce(sum(length(name)-length(regexp_replace(name, \u0026#39;[仼鶴]\u0026#39;,\u0026#39;\u0026#39;,\u0026#39;g\u0026#39;))), 0) from users;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/05/24/how-to-import-csv-with-postgre-sql/",
title: "PostgreSQL で CSVをインポートする方法",
image: "images/logo/postgre_sql_logo.svg",
date: "2022-05-24",
body: "PostgreSQL で CSVをインポートする方法 PostgreSQL で CSV をインポートする方法を備忘録として残しておく 方法 \\COPY を使用する 環境 PostgreSQL: 13.3 実際のコード su - postgres psql \\c {DB 名}; \\COPY {テーブル名} FROM \u0026#39;{csvファイルパス}\u0026#39; DELIMITER \u0026#39;,\u0026#39; CSV; # 例 HEADER なしの場合 \\COPY users FROM \u0026#39;./users.csv\u0026#39; DELIMITER \u0026#39;,\u0026#39; CSV; # 例 HEADER ありの場合 \\COPY users FROM \u0026#39;./users.csv\u0026#39; DELIMITER \u0026#39;,\u0026#39; CSV HEADER; # エクスポートする場合は以下 su - postgres psql \\c {DB 名}; \\COPY {テーブル名} TO \u0026#39;{csvファイルパス}\u0026#39; WITH CSV DELIMITER \u0026#39;,\u0026#39;; # 例 HEADER なしの場合 \\COPY users TO \u0026#39;./users.csv\u0026#39; WITH CSV DELIMITER \u0026#39;,\u0026#39;; # 例 HEADER ありの場合 \\COPY users TO \u0026#39;./users.csv\u0026#39; WITH CSV HEADER DELIMITER \u0026#39;,\u0026#39;; # 例 10 件取得(id 昇順) \\COPY (select * from users order by id limit 10) TO \u0026#39;./users.csv\u0026#39; WITH CSV HEADER DELIMITER \u0026#39;,\u0026#39;; Shell Script として行う場合は以下のようにする #!/bin/sh # ユーザを postgres に切り替えたままでコマンドの実行を行う ※CSV インポート su - postgres \u0026lt;\u0026lt;EOF psql \\c {DB 名}; \\COPY {テーブル名} FROM \u0026#39;{csvファイルパス}\u0026#39; DELIMITER \u0026#39;,\u0026#39; CSV; EOF"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/05/24/how-to-auto-seq-for-postgre-sql-with-rails/",
title: "rails で id 等の自動採番項目の不整合を修正する方法(PostgreSQL)",
image: "images/logo/rails_logo.svg",
date: "2022-05-24",
body: "rails で id 等の自動採番項目の不整合を修正する方法(PostgreSQL) rails で 自動採番項目の不整合を修正する方法を備忘録として残しておく 方法 reset_pk_sequence! を使用する 環境 rails: 6.1.4 実際のコード ActiveRecord::Base.connection.tables.each do |table_name| ActiveRecord::Base.connection.reset_pk_sequence!(table_name) end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2022/02/26/how-to-source-location-rails/",
title: "rails でメソッドの定義場所を表示する方法",
image: "images/logo/rails_logo.svg",
date: "2022-02-26",
body: "rails でメソッドの定義場所を表示する方法 rails で エラーが出てどのクラスのメソッドが呼ばれているかを確認する方法を備忘録として残しておく 方法 XXX.method(:{method}).source_location を使用する 例. ActiveRecord::Base.method(:transaction).source_location 環境 ruby: 2.6.10 rails: 5.2.3 実際のコード ActiveRecord::Base.method(:transaction).source_location =\u0026gt; [\u0026#34;/usr/local/bundle/ruby/2.6.0/gems/activerecord-5.2.3/lib/active_record/transactions.rb\u0026#34;, 211]"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/12/11/how-to-convert-excel-to-pdf-with-libreoffice/",
title: "libreoffice を使用して Excel を PDF に変換する方法",
image: "images/logo/libreoffice_logo.svg",
date: "2021-12-11",
body: "libreoffice を使用して Excel を PDF に変換する方法 アップロードされた Excel を PDF に変換して保存する必要があり 調査を行った LibreOffice で変換する方法を備忘録として残しておく ※図形など綺麗に変換されないパターンもあるため注意が必要 前提 LibreOffice を事前にインストールしておく /Applications/LibreOffice.app/Contents/MacOS/soffice にインストールしている場合 方法 以下のコマンドで変換を行う ※Calc を使用して PDF に変換 参考 指定できるフィルタ /Applications/LibreOffice.app/Contents/MacOS/soffice --headless --convert-to pdf:\u0026#34;calc_pdf_Export\u0026#34; {Excel File Path} その他 以下のようにすることで soffice コマンドを登録可能 /usr/local/bin/soffice を作成して中に以下を記載する #!/bin/bash # Need to do this because symlink won\u0026#39;t work # It complains about some .plist files /Applications/LibreOffice.app/Contents/MacOS/soffice \u0026#34;$@\u0026#34; 以下のコマンドで実行権限を付与する sudo chmod +x /usr/loca/bin/soffice 上記を sh として gist に置いているので以下でも可 sudo curl https://gist.githubusercontent.com/kkawazoe/6e8096e3b800905b43e555c32689ca4f/raw/17311ce29e3ed1b7419bd4314015ed0a36c3c7e7/soffice.sh \u0026gt; /usr/local/bin/soffice \u0026amp;\u0026amp; sudo chmod +x /usr/local/bin/soffice"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/06/02/how-to-show-reviewer-pullrequest-assign-self/",
title: "GitHub で自分にレビュー依頼が来ているプルリクエストを一覧で表示する方法",
image: "images/logo/github_logo.svg",
date: "2021-06-02",
body: "GitHub で自分にレビュー依頼が来ているプルリクエストを一覧で表示する方法 経緯 表題の件を行う必要があり調査を行ったため備忘録として残しておく 手順 1. GitHub にログインする 2. 以下を GitHub 内で検索する is:open is:pr review-requested:{自分のユーザー名} もしくは rewiew-requested で確認可能 ※PR 内でコメントをつけたりすると対象から外れてしまうため注意が必要 追記 以下で検索すればコメント等つけた場合も含めて検索されそう ※こちらは逆に未レビューのものが対象から外れてしまうため注意が必要 is:open is:pr reviewed-by:{自分のユーザー名} その他 他のコマンドについては 参考 を参照"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/05/14/how-to-execute-specified-rspec/",
title: "特定の RSpec のみ実行されるようにする方法",
image: "images/logo/rails_logo.svg",
date: "2021-05-14",
body: "特定の RSpec のみ実行されるようにする方法 個別カスタマイズ等で追加した RSpec のみ実行させる必要があり、調査した結果を備忘録として残しておく 方法 tag オプション を使用して実現する 環境 rspec: rspec 3.8 実際のコード # # :key =\u0026gt; \u0026#39;value\u0026#39; 形式でタグを付与可能 # Group(describe, context, it) に対して付与可能 # RSpec.describe \u0026#34;group with tagged specs\u0026#34; do it \u0026#34;example I\u0026#39;m working now\u0026#34;, focus: true do; end it \u0026#34;special example with string\u0026#34;, type: \u0026#39;special\u0026#39; do; end it \u0026#34;special example with symbol\u0026#34;, type: :special do; end it \u0026#34;slow example\u0026#34;, skip: true do; end it \u0026#34;ordinary example\u0026#34;, speed: \u0026#39;slow\u0026#39; do; end end 実行方法 例. タグとして type: :special が付与された RSpec を実行 bundle exec rspec spec --tag type:special 以下のテストが実行される it \u0026#34;special example with string\u0026#34;, type: \u0026#39;special\u0026#39; do; end it \u0026#34;special example with symbol\u0026#34;, type: :special do; end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/05/12/how-to-either-obtained-value-symbol-or-string-key-of-hash/",
title: "Hash の Key が Symbol または String どちらでも取得可能にする方法",
image: "images/logo/rails_logo.svg",
date: "2021-05-12",
body: "Hash の Key が Symbol または String どちらでも取得可能にする方法 HashWithIndifferentAccess に変換して実現する 環境 rails: rails 6.0.3.6 実際のコード rgb = { black: \u0026#39;#0000\u0026#39;, white: \u0026#39;#FFFFFF\u0026#39; }.with_indifferent_access rgb[:black] # =\u0026gt; \u0026#34;#0000\u0026#34; rgb[\u0026#39;black\u0026#39;] # =\u0026gt; \u0026#34;#0000\u0026#34; rgb[:\u0026#39;black\u0026#39;] # =\u0026gt; \u0026#34;#0000\u0026#34; rgb[:white] # =\u0026gt; \u0026#34;#FFFFFF\u0026#34; rgb[\u0026#39;white\u0026#39;] # =\u0026gt; \u0026#34;#FFFFFF\u0026#34; rgb[:\u0026#39;white\u0026#39;] # =\u0026gt; \u0026#34;#FFFFFF\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/04/11/convert-string-code-utf8-to-cp932-with-nkf/",
title: "nkf を使用して UTF-8 を CP932 に文字コード変換する方法",
image: "images/logo/rails_logo.svg",
date: "2021-04-11",
body: "nkf を使用して UTF-8 を CP932 に文字コード変換する方法 CSV 出力処理実装時に文字コード変換を行う必要があり対応を行った その対処方法を備忘録として残しておく 環境 rails: rails 6.0.3.6 仕様 UTF-8 の文字列を CP932 に変換する ※変換不可能な文字は'〓'に変換する 実際のコード str = \u0026#39;〜変換不可能文字を含む文字列〜\u0026#39; NKF.nkf(\u0026#39;--ic=UTF-8 --oc=CP932 --fb-subchar=0x3013\u0026#39;, str).encode(\u0026#39;UTF-8\u0026#39;, \u0026#39;CP932\u0026#39;) #=\u0026gt; \u0026#34;〓変換不可能文字を含む文字列〓\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/03/14/modify-starting-directory-for-windows-terminal/",
title: "windows terminal でターミナル毎に起動時のディレクトリを変更する方法",
image: "images/logo/windows_terminal_logo.png",
date: "2021-03-14",
body: "windows terminal でターミナル毎に起動時のディレクトリを変更する方法 windows terminal でターミナル毎に起動時のディレクトリを変更する方法を備忘録として残しておく 環境 windows: Windows 10 Pro wsl: version 2 ディストリビューション: Ubuntu 18.04 方法 Windows Terminal を起動する 「Ctrl」+「,」を押下して setting.json を開く setting.json の設定に以下を追加する { \u0026#34;$schema\u0026#34;: \u0026#34;https://aka.ms/terminal-profiles-schema\u0026#34;, \u0026#34;defaultProfile\u0026#34;: \u0026#34;{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}\u0026#34;, \u0026#34;profiles\u0026#34;: { \u0026#34;defaults\u0026#34;: { \u0026#34;startingDirectory\u0026#34;: \u0026#34;c:\\\\work\u0026#34; // 追加 ターミナル共通の起動時のディレクトリを指定 }, \u0026#34;list\u0026#34;: [ { \u0026#34;guid\u0026#34;: \u0026#34;{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Windows PowerShell\u0026#34;, \u0026#34;commandline\u0026#34;: \u0026#34;powershell.exe\u0026#34;, \u0026#34;hidden\u0026#34;: false }, { \u0026#34;guid\u0026#34;: \u0026#34;{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Command Prompt\u0026#34;, \u0026#34;commandline\u0026#34;: \u0026#34;cmd.exe\u0026#34;, \u0026#34;hidden\u0026#34;: false }, { \u0026#34;guid\u0026#34;: \u0026#34;{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}\u0026#34;, \u0026#34;hidden\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;Azure Cloud Shell\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;Windows.Terminal.Azure\u0026#34; }, { \u0026#34;guid\u0026#34;: \u0026#34;{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}\u0026#34;, \u0026#34;hidden\u0026#34;: false, \u0026#34;name\u0026#34;: \u0026#34;Ubuntu-18.04\u0026#34;, \u0026#34;source\u0026#34;: \u0026#34;Windows.Terminal.Wsl\u0026#34;, \u0026#34;startingDirectory\u0026#34;: \u0026#34;/home/{ユーザ名}/project\u0026#34; // 追加 wsl 専用の起動時のディレクトリを指定 } ] } }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/03/14/modify-root-user-distribution-for-wsl-on-ubuntu/",
title: "wsl ディストリビューションに ubuntu を選択した際に起動時のユーザを root に変更する方法",
image: "images/logo/wsl_logo.png",
date: "2021-03-14",
body: "wsl ディストリビューションに ubuntu を選択した際に起動時のユーザを root に変更する方法 wsl の起動時のユーザを root にする方法を備忘録として残しておく 環境 windows: Windows 10 Pro wsl: version 2 ディストリビューション: Ubuntu 18.04 前提 wsl の有効化およびディストリビューションのインストールは完了している前提 ※ wsl のインストールについては 参考 を参照 方法 PowerShell で以下のコマンドを実行する $ wsl $ sudo passwd root $ exit $ wsl -s Ubuntu-18.04 $ ubuntu1804 config --default-user root $ wsl #=\u0026gt; root でログインしていることを確認"
},
{
url: "https://kkawazoe.github.io/amp/blog/2021/03/14/copy-file-into-container-with-docker-compose/",
title: "docker-compose で管理しているコンテナ内にファイルをコピーする方法",
image: "images/logo/docker_logo.png",
date: "2021-03-14",
body: "docker-compose で管理しているコンテナ内にファイルをコピーする方法 docker-compose で管理しているコンテナにホストに存在するファイルをコピーする方法を備忘録として残しておく 環境 dokcer: 20.10.5 docker-compose: 1.28.5 前提 ファイルをコピーする対象のコンテナに紐づいているサービス名 app 方法 docker cp {コピーする対象ファイル} `docker-compose ps -q {サービス名}`:/ # 例 サービス名 app に紐付いているコンテナに test.txt をコピーする docker cp test.txt `docker-compose ps -q app`:/"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/10/06/about-error-with-rubyxl/",
title: "Gem rubyXL を使用した際に起こったエラーおよび対応について",
image: "images/logo/rails_logo.svg",
date: "2020-10-06",
body: "Gem rubyXL を使用した際に起こったエラーおよび対応について Gem rubyXL を使用している際に起こったエラーとその対処方法を備忘録として残しておく 環境 rails: rails 5.2.2 rubyXL: Ver.3.4.0 rubyXL について 拡張子「xlsx」を読み書き可能なライブラリ 使用感としてはテンプレートとなる Excel に対して読み書きする場合には 問題なく使用可能 但し、テンプレートに数式やグラフが含まれている場合に行などを 追加した場合に出力された Excel ファイルが破損して起動不可になる場合が あるため注意が必要 rubyXL 発生した障害とその対応 テキストの折り返しがsheet.add_cellではできない sheet.add_cell(col, row, 'text').change_text_wrap によって実装可能 テキストを折り返して表示してくれるようになる change_contents が使えない version 3.4.0 以降は convenience_methods を呼び出さないと利用不可 # require が必要なメソッド require \u0026#39;rubyXL/convenience_methods/cell\u0026#39; require \u0026#39;rubyXL/convenience_methods/color\u0026#39; require \u0026#39;rubyXL/convenience_methods/font\u0026#39; require \u0026#39;rubyXL/convenience_methods/workbook\u0026#39; require \u0026#39;rubyXL/convenience_methods/worksheet\u0026#39; もしくは以下で全て使用可 require \u0026#39;rubyXL/convenience_methods\u0026#39; シートのコピーができない Marshal.load なども試してみたが、上手くいかなかったので以下を参考にして対応 参考サイト シートコピー後、コピーしたシートを編集したら他のシートの内容も一緒に変わってしまう change_contents の仕様と上記のシートコピーによって生じた現象 ① シートの書式等をコピー ② change_contents で書式設定を保持したまま内容を変更 ③ 該当するコピーシートすべての内容が書き換わる という動作をしている =\u0026gt; add_cell による値の挿入で対応 ※上記の場合は書式設定等は rubyXL 側で行う必要がある 動的な配置で Excel の数式を設定する insert_row 等で行の挿入を動的に行った場合に Excel の数式によって値の算出を行いたい ※insert_row は公式でも書かれているが扱いに慎重になるべきメソッドで、結合したセルや数式が挿入した行の下にあった場合に Excel が破損することがある add_cellの書式を確認したところ数式は第4引数に該当するためそこに Excel の数式を代入する(SUM 関数等) グラフの作成ができない rubyXL 側にグラフに関するメソッドは存在しないため対応不可 テンプレートにグラフを挿入することで対応 印刷方向を縦向きから横向きにしたい 基本的にテンプレートの印刷設定を修正するだけで対応可 「テンプレート内のシートをコピーして作成その後、シートを削除する」といった処理の場合は以下の対応を行う worksheet.page_setup = template.page_setup 以下page_setup内の属性 paperSize: unsigned int型 用紙サイズ scale: unsigned int型 印刷スケール: すべての行を1シート内に含める等の設定 firstPageNumber: unsigned int型 最初のページ番号 fitToWidth: unsigned int型 幅に合わせる fitToHeight: unsigned int型 高さに合わせる horizonDpi: unsigned int型 水平 DPI verticalDpi: unsigned int型 垂直 DPI copies: unsigned int型 印刷する部数 usePrinterDefaults: boolean型 デフォルトのプリンタを利用するかどうか blackAndWhite: boolean型 白黒印刷をするかどうか draft: boolean型 簡易印刷するかどうか 以下を省略して印刷 罫線や塗りつぶしの色・網掛けなどの書式 グラフや図形などのオブジェクト useFirstPageNumber: boolean型 最初のページ番号を使用するかどうか pageOrder: downThenOver/overThenDown ページの順序: 昇順/降順 orientation: default/portrait/landscape 印刷時の向き: デフォルト/縦/横 cellComments: none/asDisplayed/atEnd セルコメントを印刷する errors: displayed/blank/dash/NA 印刷エラー処理 rubyXL では実装できないパターンについて グラフ関連 グラフの描画自体はテンプレートファイルからの読み込みで問題なく実行可能 但し、以下のパターンは実現は難しい ① シート名を動的に変更しつつグラフの描画を行う Excel 上だとグラフのデータ範囲はシートに基づいており、シート名を変更してしまうと変更前のシート名を参照してしまいエラーが発生する DISTINCT関数をテンプレート側で使用しても、グラフのデータ範囲はファイル読み込み時の Excel の関数よりも早くに動作するためエラーが発生する また、シート名の動的な変更は xlsm のマクロを利用するしかなく RubyXL 側では実現不可 ② グラフのデータ範囲の変更 ①と同様の理由で不可 同様の理由で、グラフのデータ範囲が動的に変化する (insert_row などを使用して抽出するデータ範囲が変動する)場合も RubyXL 側では実現不可 ③ グラフの生成(グラフ設定の編集含む) RubyXL にグラフ描画・サポート機能が対応していないため不可 テンプレートファイルにてグラフを挿入しておいて対応する"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/10/04/how-to-deal-with-vagrant-halt-failure/",
title: "vagrant halt 失敗時の対応方法",
image: "images/logo/vagrant_logo.svg",
date: "2020-10-04",
body: "vagrant halt 失敗時の対応方法 経緯 vagrant halt を行った際に以下のエラーが発生したため、その対処方法を備忘録として残しておく 手順 vagrant halt を行う 以下のエラーが発生 An action \u0026#39;halt\u0026#39; was attempted on the machine \u0026#39;default\u0026#39;, but another process is already executing an action on the machine. ess at a time. Please wait until the other Vagrant process finishes modifying this machine, then try again. If you believe this message is in error, please check the process listing for any \u0026#34;ruby\u0026#34; or \u0026#34;vagrant\u0026#34; processes and kill them. Then try again. 以下のコマンドを実行して ruby.exe の pid を探す tasklist /fi \u0026#34;Imagename eq ruby.exe\u0026#34; 以下のコマンドを実行して ruby.exe を終了させる 例 ruby.exe の pid が 7972 の場合 taskkill /F /pid 7972 再度 vagrant halt を実行する"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/05/23/insert-formula-into-hugo-part2/",
title: "Hugo に数式を挿入する その2",
image: "images/logo/hugo_logo.png",
date: "2020-05-23",
body: "Hugo に数式を挿入する その2 [前回までの記事] Hugo に数式を挿入する 経緯 mathjax のバージョンを 3 系 にアップデートした際に単純にいかなかったので備忘録として残しておく 手順 参考 を見ながらアップデートする ※version2 から version 3 への変換を利用 partials フォルダ配下の以下のファイルを修正する CDN で提供されている最新の MathJax.js の URL は、cdnjs.com で確認する \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; MathJax = { tex: { inlineMath: [[\u0026#39;$\u0026#39;,\u0026#39;$\u0026#39;], [\u0026#39;\\\\(\u0026#39;,\u0026#39;\\\\)\u0026#39;]], processEscapes: true, tags: \u0026#34;ams\u0026#34;, autoload: { color: [], colorV2: [\u0026#39;color\u0026#39;] }, packages: {\u0026#39;[+]\u0026#39;: [\u0026#39;noerrors\u0026#39;]} }, chtml: { matchFontHeight: false, displayAlign: \u0026#34;left\u0026#34;, // version 2 で css で変更していた 数式の表示位置の設定 displayIndent: \u0026#34;2em\u0026#34; }, options: { skipHtmlTags: [\u0026#39;script\u0026#39;, \u0026#39;noscript\u0026#39;, \u0026#39;style\u0026#39;, \u0026#39;textarea\u0026#39;, \u0026#39;pre\u0026#39;], renderActions: { /* これを記述しないと インライン数式(例. ${}_n \\mathrm{ P }_k$) が機能しない */ find_script_mathtex: [10, function (doc) { for (const node of document.querySelectorAll(\u0026#39;script[type^=\u0026#34;math/tex\u0026#34;]\u0026#39;)) { const display = !!node.type.match(/; *mode=display/); const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display); const text = document.createTextNode(\u0026#39;\u0026#39;); node.parentNode.replaceChild(text, node); math.start = {node: text, delim: \u0026#39;\u0026#39;, n: 0}; math.end = {node: text, delim: \u0026#39;\u0026#39;, n: 0}; doc.math.push(math); } }, \u0026#39;\u0026#39;] } }, loader: { load: [\u0026#39;[tex]/noerrors\u0026#39;] } }; \u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; async src=\u0026#34;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js\u0026#34; id=\u0026#34;MathJax-script\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; 1 で作成した partial を head or footer で読込 例 head で読込 \u0026lt;head\u0026gt; ・・・ {{ partial \u0026#34;mathjax_support.html\u0026#34; . }} \u0026lt;/head\u0026gt; チートシート ※追加分のみ 複数行で =(イコール) の位置を揃える 番号あり [記入例] \\begin{align} f(x) \u0026amp;= x^2+3x+2 \\\\\\\\\\\\ \u0026amp;= (x+1)(x+2) \\end{align} [表示例] \\begin{align} f(x) \u0026amp;= x^2+3x+2 \\\\\\ \u0026amp;= (x+1)(x+2) \\end{align} 番号なし [記入例] \\begin{align*} f(x) \u0026amp;= x^2+3x+2 \\\\\\\\\\\\ \u0026amp;= (x+1)(x+2) \\end{align*} [表示例] \\begin{align*} f(x) \u0026amp;= x^2+3x+2 \\\\\\ \u0026amp;= (x+1)(x+2) \\end{align*}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/05/17/apply-layout-to-static-error-page-with-rails/",
title: "Rails で静的エラーページにレイアウトを適用する",
image: "images/logo/rails_logo.svg",
date: "2020-05-17",
body: "Rails で静的エラーページにレイアウトを適用する 環境 rails: rails 5.2.3 方法 Gem Errgent を使用して実現する 確認 config/environments/development.rb の以下を編集して確認する config.consider_all_requests_local = false 実際のコード 例. エラーコード 404, 500 ロケール毎に静的エラーページを生成する =\u0026gt; 生成されるファイル 例. public/404.ja.html desc \u0026#39;Generate Error Pages\u0026#39; task generate_error_pages: :environment do I18n.available_locales.each do |locale| I18n.locale = locale renderer = Errgent::Renderer.new( codes: [404, 500] layout: \u0026#39;layouts/error_page\u0026#39;, # where to find your layout by default output: \u0026#34;public/%s.#{locale}.html\u0026#34; # where to put generated pages by default, %s is the replacement for @code ) renderer.render end I18n.locale = I18n.default_locale end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/04/04/handle-credentials-info-of-rails-on-docker-compose/",
title: "Docker Compose 上で Rails の秘匿情報を扱う",
image: "images/logo/rails_logo.svg",
date: "2020-04-04",
body: "Docker Compose 上で Rails の秘匿情報を扱う 環境 rails: rails 5.2.3 方法 前提 credentials.yml.enc を使用 docker 上での rails のコンテナ名: rails 確認 例. production 環境の秘匿情報を確認する 以下のコマンドを使用して確認する $ docker-compose exec rails bash #=\u0026gt; コンテナが起動していない場合は docker-compose run rails bash $ EDITOR=\u0026#34;vim\u0026#34; bin/rails env_credentials:show -e production 編集 例. production 環境の秘匿情報を編集する 以下のコマンドを使用して確認する $ docker-compose exec rails bash #=\u0026gt; コンテナが起動していない場合は docker-compose run rails bash $ EDITOR=\u0026#34;vim\u0026#34; bin/rails env_credentials:edit -e production"
},
{
url: "https://kkawazoe.github.io/amp/blog/2020/03/19/use-gas-to-search-for-gmail-and-retrieve-emails/",
title: "Google Apps Script で Gmail から 特定条件のスレッドを検索しメールを取り出す",
image: "images/logo/gas_logo.svg",
date: "2020-03-19",
body: "Google Apps Script で Gmail から 特定条件のスレッドを検索しメールを取り出す 実際のソース function searchContactMail() { /* Gmail から件名が「noreply」のスレッドを検索して内容を取り出す */ var strTerms = \u0026#39;noreply\u0026#39;; var myThreads = GmailApp.search(strTerms, 0, 100); var myMsgs = GmailApp.getMessagesForThreads(myThreads); //二次元配列 var contents = []; /* 各メールの内容を取り出す */ for (var i = 0; i \u0026lt; myMsgs.length; i++) { for (var j = 0; j \u0026lt; myMsgs[i].length; j++) { var data = myMsgs[i][j].getTo(); if (data !== null) { contents.push([data]); } } } /* スプレッドシートのシート「output」に出力 */ if (myMsgs.length \u0026gt; 0) { var mySheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName( \u0026#39;output\u0026#39; ); mySheet.getRange(1, 1, contents.length, 1).setValues(contents); } }"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/09/14/dynamic-translate-for-i18n-with-rspec/",
title: "RSpec 内で動的に I18n の訳文を追加する",
image: "images/logo/rails_logo.svg",
date: "2019-09-14",
body: "RSpec 内で動的に I18n の訳文を追加する 環境 rails: rails 5.2.3 方法 I18n::Backend::Base#store_translations を使用する I18n.backend.store_translations( :ja, test: \u0026#39;テスト\u0026#39; ) I18n.t(:test) #=\u0026gt; テスト"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/07/21/how-to-handle-tokens-in-rails/",
title: "Rails でトークンを扱う方法",
image: "images/logo/rails_logo.svg",
date: "2019-07-21",
body: "Rails でトークンを扱う方法 環境 rails: rails 5.2.3 方法 トークンの認証 トークンの認証については authenticate_with_http_token を使用する 以下が対象 Authorization: Token XXX Authorization: Bearer XXX class ApplicationController \u0026lt; ActionController::API # authenticate_with_http_token を使用するために必要 include ActionController::HttpAuthentication::Token::ControllerMethods before_action :authenticate def authenticate authenticate_with_http_token do |token, options| # 認証処理 および レスポンスが必要な場合は記述 end end end トークンの取得 トークンの取得については token_and_options を使用する 以下が対象 Authorization: Token XXX Authorization: Bearer XXX class ApplicationController \u0026lt; ActionController::API # token_and_options を使用するために必要 include ActionController::HttpAuthentication::Token def access_token token_and_options(request)\u0026amp;.first end end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/07/06/road-to-fp3-part7/",
title: "FP3級への道 その7",
image: "images/logo/fp_logo.svg",
date: "2019-07-06",
body: "FP3級への道 その7 学習中に間違えやすいと思った点を備忘録として残しておく [前回までの記事] FP3級への道 FP3級への道 その2 FP3級への道 その3 FP3級への道 その4 FP3級への道 その5 FP3級への道 その6 受験結果 2019年5月 一応　FP 3級合格 勉強時間は一月半程度 後半 2週間は過去2, 3年分の過去問を中心に解いて解説および関連する分野を勉強した FP に関しては試験受ける・受けないはともかくとして勉強自体はやって良かったと思う 2級以上を受験するかどうかは今のところ不明だがモチベーションが上がれば挑戦したい 【種目別試験結果】ファイナンシャル・プランニング技能検定 公式サイトで確認すると今回の合格率は以下 等級 学科/実技 試験科目 合格率 3級 学科 42.76％ 3級 実技 個人資産相談業務 54.35％ 大体例年通りくらいの合格率だったらしい"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/06/20/clone-repository-use-access-token-with-github/",
title: "github で access token を使用してリポジトリを clone する",
image: "images/logo/github_logo.svg",
date: "2019-06-20",
body: "github で access token を使用してリポジトリを clone する 経緯 表題の件を行う必要があり対応を行ったため備忘録として残しておく 手順 1. アクセストークンを作成する GitHub アカウントにログインし，Settings \u0026gt; Developer settings から Personal access tokens を選択する Generate new token を押下する 2. 以下のコマンドを実行してリポジトリを clone する git clone https://{アカウント名}:{アクセストークン}@github.com/{アカウント名}/{リポジトリ名} 3. ローカルの設定を追加する git config --local user.name {アカウント名} git config --local user.email {アカウントのメールアドレス}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/05/24/pass-lint-and-unit-test-to-build-with-electron-builder/",
title: "electron-builder で Lint および UnitTest が通った場合のみビルドするようにする",
image: "images/logo/electron_logo.svg",
date: "2019-05-24",
body: "electron-builder で Lint および UnitTest が通った場合のみビルドするようにする 経緯 electron にて ビルドするのに electron-builder を使用してみた その際に最低限 Lint, UnitTest を通ることを担保するようにしたため備忘録として残しておく 構築環境 electron: 5.0.1 electron-builder: 20.39.0 実際のコード package.json に以下の定義がしてある前提 ※以下は electron x angular(Angular Cli で生成) { ・・・ \u0026#34;scripts\u0026#34;: { \u0026#34;ng\u0026#34;: \u0026#34;ng\u0026#34;, \u0026#34;start\u0026#34;: \u0026#34;ng build --prod \u0026amp;\u0026amp; electron .\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;ng build\u0026#34;, \u0026#34;test\u0026#34;: \u0026#34;jest\u0026#34;, \u0026#34;lint\u0026#34;: \u0026#34;ng lint\u0026#34;, \u0026#34;postinstall\u0026#34;: \u0026#34;electron-builder install-app-deps\u0026#34;, \u0026#34;release\u0026#34;: \u0026#34;ng build --prod \u0026amp;\u0026amp; node build.js\u0026#34;, }, ・・・ } electron-builder のオプションについては公式を参照 \u0026#39;use strict\u0026#39;; const builder = require(\u0026#39;electron-builder\u0026#39;); const Platform = builder.Platform; const childProcess = require(\u0026#39;child_process\u0026#39;); const unitTest = new Promise((resolve, reject) =\u0026gt; { childProcess.exec(\u0026#39;yarn test\u0026#39;, (error, stdout) =\u0026gt; { if (error) { // エラー時は例外を投げる reject(new Error(stdout + error)); } resolve(\u0026#39;UnitTest OK!\u0026#39;); }); }); const lint = new Promise((resolve, reject) =\u0026gt; { childProcess.exec(\u0026#39;yarn lint\u0026#39;, (error, stdout) =\u0026gt; { if (error) { // エラー時は例外を投げる reject(new Error(stdout + error)); } resolve(\u0026#39;Lint OK!\u0026#39;); }); }); const build = () =\u0026gt; { builder .build({ targets: Platform.WINDOWS.createTarget(), config: { directories: { output: \u0026#39;release\u0026#39;, buildResources: \u0026#39;dist\u0026#39;, }, productName: \u0026#39;Example App\u0026#39;, files: [\u0026#39;**/*\u0026#39;, \u0026#39;dist/**/*\u0026#39;], win: { target: [ { target: \u0026#39;nsis\u0026#39;, arch: [\u0026#39;x64\u0026#39;], }, ], }, nsis: { createDesktopShortcut: \u0026#39;always\u0026#39;, }, }, }) .then(() =\u0026gt; { console.log(\u0026#39;Build OK!\u0026#39;); }) .catch((error) =\u0026gt; { console.log(error); }); }; Promise.all([lint, unitTest]) .then((values) =\u0026gt; { console.log(values.join(\u0026#39;\\n\u0026#39;)); build(); }) .catch((error) =\u0026gt; { console.log(error.message); });"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/05/15/add-jest-at-angular-cli/",
title: "Angular Cli で作成したプロジェクトに Jest を追加する",
image: "images/logo/angular_logo.svg",
date: "2019-05-15",
body: "Angular Cli で作成したプロジェクトに Jest を追加する Angular Cli でプロジェクトを作成すると Karma + Jasmine が単体テストとして入るため Jest に変更する手順を備忘録として残しておく 構築環境 Angular CLI: 7.3.9 Node: 10.15.3 OS: darwin x64 Angular: ... Package Version ------------------------------------------------------ @angular-devkit/architect 0.13.9 @angular-devkit/core 7.3.9 @angular-devkit/schematics 7.3.9 @schematics/angular 7.3.9 @schematics/update 0.13.9 rxjs 6.3.3 typescript 3.2.4 手順 1. プロジェクトを作成 $ ng new JEST-EXAMPLE --style=styl ? Would you like to add Angular routing? Yes 2. 以下のコマンドを実行する yarn global add @briebug/jest-schematic ng g @briebug/jest-schematic:add ng add @briebug/jest-schematic 3. 以下のコマンドを実行して動作確認する $ yarn test $ jest PASS src/app/app.component.spec.ts AppComponent ✓ should create the app (89ms) ✓ should have as title \u0026#39;JEST-EXAMPLE\u0026#39; (28ms) ✓ should render title in a h1 tag (29ms) Test Suites: 1 passed, 1 total Tests: 3 passed, 3 total Snapshots: 0 total Time: 3.913s Ran all test suites. ✨ Done in 4.76s. 上記だけでも動くが snapshot テストを行うためには以下が追加で必要 4. src/app/app.component.spec.ts を修正 import { TestBed, async } from \u0026#39;@angular/core/testing\u0026#39;; import { RouterTestingModule } from \u0026#39;@angular/router/testing\u0026#39;; import { AppComponent } from \u0026#39;./app.component\u0026#39;; describe(\u0026#39;AppComponent\u0026#39;, () =\u0026gt; { beforeEach(async(() =\u0026gt; { TestBed.configureTestingModule({ imports: [ RouterTestingModule ], declarations: [ AppComponent, ], }).compileComponents(); })); describe(\u0026#39;snapshots\u0026#39;, () =\u0026gt; { it(\u0026#39;正しく render されること\u0026#39;, () =\u0026gt; { const fixture = TestBed.createComponent(AppComponent); expect(fixture).toMatchSnapshot(); }); }); }); 5. src/tsconfig.spec.json を修正 { \u0026#34;extends\u0026#34;: \u0026#34;../tsconfig.json\u0026#34;, \u0026#34;compilerOptions\u0026#34;: { \u0026#34;outDir\u0026#34;: \u0026#34;../out-tsc spec\u0026#34;, \u0026#34;types\u0026#34;: [ \u0026#34;jasmine\u0026#34;, //=\u0026gt; \u0026#34;jest\u0026#34; \u0026#34;node\u0026#34; ], \u0026#34;module\u0026#34;: \u0026#34;commonjs\u0026#34; }, \u0026#34;files\u0026#34;: [ \u0026#34;polyfills.ts\u0026#34; ], \u0026#34;include\u0026#34;: [ \u0026#34;**/*.spec.ts\u0026#34;, \u0026#34;**/*.d.ts\u0026#34; ] } 6. src/angular.json から以下を削除 { ・・・ \u0026#34;test\u0026#34;: { \u0026#34;builder\u0026#34;: \u0026#34;@angular-devkit/build-angular:karma\u0026#34;, \u0026#34;options\u0026#34;: { \u0026#34;main\u0026#34;: \u0026#34;src/test.ts\u0026#34;, \u0026#34;polyfills\u0026#34;: \u0026#34;src/polyfills.ts\u0026#34;, \u0026#34;tsConfig\u0026#34;: \u0026#34;src/tsconfig.spec.json\u0026#34;, \u0026#34;karmaConfig\u0026#34;: \u0026#34;src/karma.conf.js\u0026#34;, \u0026#34;styles\u0026#34;: [ \u0026#34;src/styles.styl\u0026#34; ], \u0026#34;scripts\u0026#34;: [], \u0026#34;assets\u0026#34;: [ \u0026#34;src/favicon.ico\u0026#34;, \u0026#34;src/assets\u0026#34; ] } }, ・・・ } 7. 以下のコマンドを実行する yarn remove @types/jasmine @types/jasminewd2 yarn add @types/jest 8. 以下のコマンドを実行して動作確認する $ jest PASS src/app/app.component.spec.ts AppComponent snapshots ✓ 正しく render されること (109ms) Test Suites: 1 passed, 1 total Tests: 1 passed, 1 total Snapshots: 1 passed, 1 total Time: 1.711s, estimated 3s Ran all test suites. ✨ Done in 2.43s."
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/30/road-to-fp3-part6/",
title: "FP3級への道 その6",
image: "images/logo/fp_logo.svg",
date: "2019-04-30",
body: "FP3級への道 その6 学習中に間違えやすいと思った点を備忘録として残しておく [前回までの記事] FP3級への道 FP3級への道 その2 FP3級への道 その3 FP3級への道 その4 FP3級への道 その5 金融資産運用 債権 債権の利回り 直接利回り 投資金額(購入価格)に対する毎年の利息収入の割合 $$ 直接利回り(\\%) = \\frac{表面利率}{購入価格} \\times 100 $$ $$ 直接利回り(\\%) = \\frac{表面利率}{購入価格} \\times 100 $$ 例えば、表面利率1%の債権を102万円で購入した場合(小数点以下第3位を四捨五入) $$ \\frac{1%}{102円} \\times 100 ≒ 0.98% $$ 応募者利回り 債権の発行時に購入し、償還まで所有した場合の利回り $$ 応募者利回り(\\%) = \\frac{表面利率 + \\frac{額面(100円) - 発行価格}{償還期限(年)}}{発行価格} \\times 100 $$ 例えば、表面利率1%、発行価格98円、償還期限5年の債権を購入した場合(小数点以下第3位を四捨五入) $$ \\frac{1% + \\frac{100円 - 98円}{5年}}{98円} \\times 100 ≒ 1.43% $$ 最終利回り 既に発行されている債権を時価で購入し、償還まで所有した場合の利回り $$ 最終利回り(\\%) = \\frac{表面利率 + \\frac{額面(100円) - 購入価格}{残存年数(年)}}{購入価格} \\times 100 $$ 例えば、表面利率1%、償還期限5年、発行価格99円の債権を残存年数3年の時点で99円を購入した場合(小数点以下第3位を四捨五入) $$ \\frac{1% + \\frac{100円 - 99円}{3年}}{99円} \\times 100 ≒ 1.35% $$ 所有期間利回り 新規発行の債権または既発行の債権を購入し、償還前に売却した場合の利回り $$ 所有期間利回り(\\%) = \\frac{表面利率 + \\frac{売却価格 - 購入価格}{所有期間(年)}}{購入価格} \\times 100 $$ 例えば、表面利率1%、償還期限5年、発行価格98円の債権を発行時に購入し、4年後に103円で売却した場合(小数点以下第3位を四捨五入) $$ \\frac{1% + \\frac{103円 - 98円}{4年}}{98円} \\times 100 ≒ 2.30% $$ 参考にした教本 上記内容は以下の教本の内容を参考にしてます 2018-2019年版　みんなが欲しかった！　FPの教科書3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/28/auto-generate-test-sheet-tool-with-excel/",
title: "Excel でテスト用シートを自動生成するツールを作成する",
image: "images/logo/excel_logo.svg",
date: "2019-04-28",
body: "Excel でテスト用シートを自動生成するツールを作成する 経緯 結合テストなのでエビデンスを残しておく必要があり テスト項目ごとにシートを分ける必要があった テスト項目が多い場合手作業で シート作成 =\u0026gt; シート名変更をするのは手間だったため ツール化をすることにした 使用方法 「パラメータ」シートにて以下を指定する [設定項目] シート数: 作成するシート数 表示倍率: 作成するシートの表示倍率 シート作成後ワークグループ設定: チェックをつけるとシートを作成後に ワークグループ(各シートが選択状態)になる 「パラメータ」シートの「実行」ボタンを押下する 実際のコード Rem Attribute VBA_ModuleType=VBAModule Option VBASupport 1 Sub ExecuteButtonClick() Dim ws As Worksheet Dim wsArray() As String Dim chkFlg As Long \u0026#39;ワークシートの初期化 For Each ws In Worksheets \u0026#39;ワークシート名が\u0026#34;パラメータ\u0026#34;以外の場合 If ws.Name \u0026lt;\u0026gt; \u0026#34;パラメータ\u0026#34; Then Application.DisplayAlerts = False ws.Delete Application.DisplayAlerts = True End If Next ws \u0026#39;チェックボックスの値を取得 chkFlg = Worksheets(\u0026#34;パラメータ\u0026#34;).OLEObjects(\u0026#34;Chk_WorkGroup\u0026#34;).Object.Value \u0026#39;ワークシートの追加 For i = 0 To Worksheets(\u0026#34;パラメータ\u0026#34;).Cells(2, 3).Value - 1 Sheets.Add after:=ActiveSheet ActiveSheet.Name = \u0026#34;No.\u0026#34; \u0026amp; i + 1 ActiveWindow.Zoom = Worksheets(\u0026#34;パラメータ\u0026#34;).Cells(3, 3).Value ReDim Preserve wsArray(i) wsArray(i) = ActiveSheet.Name \u0026#39;100の倍数ごとに画面に制御を返す If i Mod 100 = 0 Then DoEvents End If Next \u0026#39;作業グループ設定フラグがオンの場合 If chkFlg Then \u0026#39;作業グループの設定 Sheets(wsArray).Select End If End Sub 作成したツール"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/27/insert-formula-into-hugo/",
title: "Hugo に数式を挿入する",
image: "images/logo/hugo_logo.png",
date: "2019-04-27",
body: "Hugo に数式を挿入する 経緯 Hugo で運用しているサイトに数式を埋め込む必要があり 調査した結果を備忘録として残しておく 手順 参考 と同じく Mathjax を使用して実現する partials フォルダ配下に以下のファイルを作成する CDN で提供されている最新の MathJax.js の URL は、cdnjs.com で確認する \u0026lt;script type=\u0026#34;text/javascript\u0026#34; async src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML\u0026#34;\u0026gt; MathJax.Hub.Config({ tex2jax: { inlineMath: [[\u0026#39;$\u0026#39;,\u0026#39;$\u0026#39;], [\u0026#39;\\\\(\u0026#39;,\u0026#39;\\\\)\u0026#39;]], displayMath: [[\u0026#39;$$\u0026#39;,\u0026#39;$$\u0026#39;]], processEscapes: true, processEnvironments: true, skipTags: [\u0026#39;script\u0026#39;, \u0026#39;noscript\u0026#39;, \u0026#39;style\u0026#39;, \u0026#39;textarea\u0026#39;, \u0026#39;pre\u0026#39;], TeX: { equationNumbers: { autoNumber: \u0026#34;AMS\u0026#34; }, extensions: [\u0026#34;AMSmath.js\u0026#34;, \u0026#34;AMSsymbols.js\u0026#34;] } } }); MathJax.Hub.Queue(function() { // Fix \u0026lt;code\u0026gt; tags after MathJax finishes running. This is a // hack to overcome a shortcoming of Markdown. Discussion at // https://github.com/mojombo/jekyll/issues/199 var all = MathJax.Hub.getAllJax(), i; for(i = 0; i \u0026lt; all.length; i += 1) { all[i].SourceElement().parentNode.className += \u0026#39; has-jax\u0026#39;; } }); \u0026lt;/script\u0026gt; 1 で作成した partial を head or footer で読込 例 head で読込 \u0026lt;head\u0026gt; ・・・ {{ partial \u0026#34;mathjax_support.html\u0026#34; . }} \u0026lt;/head\u0026gt; css を修正(カスタマイズする場合) css ファイルで以下の要素に対する修飾を記述する .has-jax { font: inherit; font-size: 100%; background: inherit; border: inherit; color: #515151; } .has-jax \u0026gt; .MathJax_Display { text-align: left !important; } チートシート ページ内に数式を記述 [記入例] $${}_n \\mathrm{ P }_k$$ [表示例] $${}_n \\mathrm{ P }_k$$ インライン形式で数式を記述 [記入例] 次の数式は ${}_n \\mathrm{ P }_k$ 文章内に埋め込まれます [表示例] 次の数式は ${}_n \\mathrm{ P }_k$ 文章内に埋め込まれます 四則演算 [記入例] $$1 + 2 = 3$$ $$2 - 3 = 5$$ $$3 \\times 2 = 6$$ $$6 \\div 3 = 2$$ [表示例] $$1 + 2 = 3$$ $$2 - 3 = 5$$ $$3 \\times 2 = 6$$ $$6 \\div 3 = 2$$ 分数 [記入例] $$\\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}$$ $$\\frac{a+b}{2ab}$$ [表示例] $$\\frac{1}{2} - \\frac{1}{3} = \\frac{1}{6}$$ $$\\frac{a+b}{2ab}$$ 複数行で =(イコール) の位置を揃える [記入例] \\begin{align} f(x) \u0026amp;= x^2+3x+2 \\\\\\\\\\\\ \u0026amp;= (x+1)(x+2) \\end{align} [表示例] \\begin{align*} f(x) \u0026amp;= x^2+3x+2 \\\\\\ \u0026amp;= (x+1)(x+2) \\end{align*}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/26/road-to-fp3-part5/",
title: "FP3級への道 その5",
image: "images/logo/fp_logo.svg",
date: "2019-04-26",
body: "FP3級への道 その5 学習中に間違えやすいと思った点を備忘録として残しておく [前回までの記事] FP3級への道 FP3級への道 その2 FP3級への道 その3 FP3級への道 その4 金融資産運用 株式 株式投資に用いる指標 $$ PER(倍) = \\frac{株価}{一株当たりの純利益(EPS)} $$ ※PER が低い銘柄は 割安 、高い銘柄は割高 $$ PBR(倍) = \\frac{株価}{一株当たりの純資産(BPS)} $$ ※PBR が低い(1倍に近い)銘柄は 割安 、高い銘柄は割高 $$ ROE(\\%) = \\frac{税引後当期純利益}{自己資本(純資産)} \\times 100 $$ $$ 配当利回り(\\%) = \\frac{一株当たりの配当金}{株価} \\times 100 $$ $$ 配当性向(\\%) = \\frac{配当金総額}{税引後当期純利益} \\times 100 $$ $$ 自己資本比率(\\%) = \\frac{自己資本(純資産)}{総資産(負債 + 純資産)} \\times 100 $$ 参考にした教本 上記内容は以下の教本の内容を参考にしてます 2018-2019年版　みんなが欲しかった！　FPの問題集3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/25/road-to-fp3-part4/",
title: "FP3級への道 その4",
image: "images/logo/fp_logo.svg",
date: "2019-04-25",
body: "FP3級への道 その4 学習中に間違えやすいと思った点を備忘録として残しておく [前回までの記事] FP3級への道 FP3級への道 その2 FP3級への道 その3 リスクマネジメント 火災保険 補償の範囲 損害 住宅火災保険 住宅総合保険 火災、落雷、爆発、破裂 風災、雹災、雪災 ◯ ◯ 水害(水災) × ◯ 給排水設備事故による水漏れ × ◯ 盗難 × ◯ 外部からの落下、飛来、衝突 × ◯ 持出家財の損害 × ◯ 地震、噴火、津波 × × 傷害保険 主な傷害保険 普通傷害保険 国内外を問わず、日常生活で起こる傷害を補償する保険 ※病気、細菌性食中毒、自殺、地震、噴火、津波を原因とする傷害は対象外 =\u0026gt; 1つの契約で家族全員が補償される「家族傷害保険」もある 交通事故傷害保険 国内外で起きた交通事故、建物や乗り物の火災などによる傷害を保証する保険 =\u0026gt; 1つの契約で家族全員が補償される「ファミリー交通傷害保険」もある 国内旅行傷害保険 国内旅行中の傷害を補償する保険 ※細菌性食中毒は保証の対象だが、地震などによる傷害は対象外 海外旅行傷害保険 海外旅行中(家を出てから帰宅するまで)の傷害を補償する保険 ※細菌性食中毒、地震、噴火、津波による傷害も補償の対象 参考にした教本 上記内容は以下の教本の内容を参考にしてます 2018-2019年版　みんなが欲しかった！　FPの問題集3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/24/road-to-fp3-part3/",
title: "FP3級への道 その3",
image: "images/logo/fp_logo.svg",
date: "2019-04-24",
body: "FP3級への道 その3 学習中に間違えやすいと思った点を備忘録として残しておく [前回までの記事] FP3級への道 FP3級への道 その2 リスクマネジメント 生命保険と税金 生命保険金を受け取った時の税金 契約や、被保険者、受取人が誰かによって課される税金が異なる [死亡保険金の場合] 契約者 被保険者 受取人 税金 A A B 相続税 A B A 所得税(一時所得) 住民税 A B C 贈与税 [満期保険金の場合] 契約者 被保険者 受取人 税金 A 誰でも A 所得税(一時所得) 住民税 A 誰でも B 贈与税 [非課税となる保険金や給付金] 入院給付金 高度障害保険金 手術給付金 特定疾病保険金 リビングニーズ特約保険金 等 参考にした教本 上記内容は以下の教本の内容を参考にしてます 2018-2019年版　みんなが欲しかった！　FPの問題集3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/23/when-not-input-parameter-query-execute-full-search-with-access/",
title: "Access でパラメータクエリが未入力の場合は全検索する",
image: "images/logo/access_logo.svg",
date: "2019-04-23",
body: "Access でパラメータクエリが未入力の場合は全検索する 実際のコード パラメータが未入力の際に全ての検索条件を無視して全検索する場合 抽出条件として抽出したいフィールドの「抽出条件」欄に以下を入力する [抽出条件] [パラメータ] Or [パラメータ] Is Null パラメータが未入力の際に関係する抽出条件のみを全検索する場合 パラメータ用のフィールドを追加して「抽出条件」欄に以下を入力する [抽出条件] [抽出対象フィールド] Or Is Null ※一番右側にフィールドを配置しないと意図しないSQLになることもあるため必ずSQLビューで作成されたSQLを確認すること"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/22/road-to-fp3-part2/",
title: "FP3級への道 その2",
image: "images/logo/fp_logo.svg",
date: "2019-04-22",
body: "FP3級への道 その2 学習中に間違えやすいと思った点を備忘録として残しておく 前回の記事: FP3級への道 ライフプランニングの手法 ライフプランニングを行う際に利用するツール ライフイベント表 家族の将来のライフイベントと、それに必要な資金の額を時系列にまとめた表 キャッシュフロー表 ライフイベント表と現在の収支状況に基づいて、将来の収支状況と貯蓄残高の予想を まとめた表 個人バランスシート 一定時点における資産と負債のバランスを見るための表 ※[可処分所得] = [年収] - (社会保険料 + 所得税 + 住民税) 資金計画を立てる際の6つの係数 終価係数 現在の金額を複利で運用した場合の、一定期間後の金額を求める場合に用いる係数 例. 100万円を年利3%で運用した場合の7年後の金額はいくらか？ 現価係数 一定期間後に一定金額に達するために必要な原本を求めるのに用いる係数 例. 年利3%で7年後に100万円を用意するためには、元本がいくら必要になるか？ 年金終価係数 毎年一定金額を積み立てた場合の、一定期間後の元利合計を求める場合に用いる係数 例. 年利3%、毎年10万円を7年後の金額はいくらか？ 減債基金係数 一定期間後に一定金額を用意するための、毎年の積立額を計算するための係数 例. 年利3%、７年後に100万円を用意するためには毎年いくら積み立てる必要があるか？ 資本回収係数 現在の一定金額を一定期間で取り崩した場合の、毎年の受取金額を計算するための係数 例. 100万円を年利2%で運用しながら7年噛んで取り崩した場合の毎年の受取金額はいくら？ 年金現価係数 将来の一定期間に渡って、一定額を受け取るために必要な元本を計算するための係数 例. 7年間に渡って、10万円ずつ受け取りたい 年利3%とした場合、必要な元本はいくらか？ 終価係数と年金終価係数の違い 終価係数は、現在の金額を複利で運用した場合の金額を求めるための係数 =\u0026gt; 定期預金のイメージ 年金終価係数は、毎年一定金額を積み立てた場合の一定期間後の元利合計を求めるための係数 =\u0026gt; 積立定期預金のイメージ 減債基金係数と資本回収係数の違い 減債基金係数は毎年の積立額を求めるための係数 資本回収係数は毎年の受取金額を求めるための係数 現価係数はと年金現価係数の違い 現価係数は一定金額に達するために必要な原本を求めるための係数 年金現価係数は一定額を受け取るために必要な元本を求めるための係数 参考にした教本 上記内容は以下の教本の内容を参考にしてます 2018-2019年版　みんなが欲しかった！　FPの問題集3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/19/road-to-aws-certified-solutions-architect-associate/",
title: "AWS 認定ソリューションアーキテクト - アソシエイトへの道",
image: "images/logo/aws_logo.svg",
date: "2019-04-19",
body: "AWS 認定ソリューションアーキテクト - アソシエイトへの道 試験概要 詳細は、試験ガイド(試験概要 の「試験ガイドのダウンロード」を参照) 受験料 15,000 円 (日本語版/税別) 出題範囲 分野 試験に占める 割合 分野 1: 回復性の高いアーキテクチャを設計する 34% 分野 2: パフォーマンスに優れたアーキテクチャを定義する 24% 分野 3: セキュアなアプリケーションおよびアーキテクチャを規定する 26% 分野 4: コスト最適化アーキテクチャを設計する 10% 分野 5: オペレーショナルエクセレンスを備えたアーキテクチャを定義する 6% 合計 100% 出題範囲詳細 分野 1: 回復性の高いアーキテクチャを設計する 1.1 信頼性と回復性の高いストレージを選択する 1.2 AWS サービスを使用した分離機構を設計する方法を定義する 1.3 多層アーキテクチャソリューションを設計する方法を定義する 1.4 可用性またはフォルトトレラント性 (あるいはその両方) が高いアーキテクチャを設計する方法を定義する 分野 2: パフォーマンスに優れたアーキテクチャを定義する 2.1 パフォーマンスの高いストレージとデータベースを選択する 2.2 キャッシュを使用してパフォーマンスを向上させる 2.3 伸縮性と拡張性を備えたソリューションを設計する 分野 3: セキュアなアプリケーションおよびアーキテクチャを規定する 3.1 アプリケーション層をセキュリティ保護する方法を定義する 3.2 データをセキュリティ保護する方法を定義する 3.3 単一の VPC アプリケーション用のネットワークインフラストラクチャーを定義する 分野 4: コスト最適化アーキテクチャを設計する 4.1 コスト最適化ストレージを設計する方法を定義する 4.2 コスト最適化コンピューティングを設計する方法を定義する 分野 5: オペレーショナルエクセレンスを備えたアーキテクチャを定義する 5.1 オペレーショナルエクセレンスを実現するソリューションの設計特性を選択する 合格ライン 100～1000 点の範囲のスコアでレポートされる 最低合格スコアは 720 点 各分野毎の最低合格ラインはなし 試験対策 教本 徹底攻略AWS認定ソリューションアーキテクトアソシエイト教科書 鳥谷部昭寛/宮〓光平 インプレス 2019年01月16日 売り上げランキング : 楽天ブックスで購入Amazonで購入Kindleで購入 by ヨメレバ 最短突破AWS認定ソリューションアーキテクトアソシエイト合格教本 村主壮悟 技術評論社 2019年02月26日 売り上げランキング : 楽天ブックスで購入Amazonで購入Kindleで購入 by ヨメレバ 合格対策 AWS認定ソリューションアーキテクト - アソシエイト 大塚康徳（日立インフォメーションアカデミー） リックテレコム 2016年08月17日 売り上げランキング : 楽天ブックスで購入Amazonで購入Kindleで購入 by ヨメレバ AWS認定試験対策　AWS ソリューションアーキテクトーアソシエイト 佐々 木拓郎/林 晋一郎 SBクリエイティブ 2019年04月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入Kindleで購入 by ヨメレバ その他 AWS に関するホワイトペーパー 模擬試験 所要時間: 30 分間 受験方法: オンライン 受験料: 2,000 円(税別)"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/18/about-git-command/",
title: "Git コマンドについて",
image: "images/logo/github_logo.svg",
date: "2019-04-18",
body: "Git コマンドについて 基本的なコマンドを含めて備忘録として残しておく 実際のコード 基本的な流れ Git 初期化 git init Git 接続先設定 git remote add {Fork 元リモート名} {Fork 元接続先URL} git remote add {Fork 先リモート名} {Fork 先接続先URL} 最新ソース取得 git pull {Fork 元リモート名} {ブランチ名} トピックブランチ作成 git checkout -b topic/#{issue番号}-作業者名 開発 ステージングにあげる git add -A # untracked files を除いてステージングに挙げる場合は以下 git add -u コミットする git commit -m \u0026#34;コメント\u0026#34; プルリクエストを投げる git push {Fork 元リモート名} {ブランチ名} ※修正がある場合はgit addから先を繰り返し その他 ローカルの修正を元に戻す 一部ファイルのみ戻す場合 ※半角空白で区切ることで複数ファイル指定可 git checkout {ファイル1(ファイルパス付)} {ファイル2(ファイルパス付)} 全て元に戻す場合 git checkout . untracked files をまとめて削除(削除対象表示) ※untracked files は変更ではないため以下を行う git clean -n # ディレクトリも含める場合 git clean -dn untracked files をまとめて削除 git clean -f # ディレクトリも含める場合 git clean -df 直前のコミットのコメントを修正 git commit --amend -m \u0026#34;直前のコミットのコメントを修正\u0026#34; コミットをまとめる # 2つ前までのコミットを修正 $ git rebase -i HEAD~~ #=\u0026gt; squash or s に編集 #=\u0026gt; コメントを修正 最新資産へのマージ $ git pull --rebase origin master # コンフリクトを修正 # コンフリクトの修正をマージする $ git add -A $ git rebase --continue #=\u0026gt; ※git commitではないので注意 $ git push -f {リモート名} {ブランチ名} #=\u0026gt; ※強制更新になるため注意 rebase しない場合は以下 例. topic ブランチに master ブランチをマージ $ git checkout master $ git fetch {リモート名} $ git pull {リモート名} master $ git checkout topic $ git merge master # コンフリクトを修正 # コンフリクトの修正をマージする $ git add -A $ git push -f {リモート名} topic #=\u0026gt; ※強制更新になるため注意 git の状態を一つ前に戻す ※ローカルの変更はそのまま git reset --soft HEAD^ git の状態を一つ前に戻す ※ローカルの変更も戻す git reset --hard HEAD^ stash の一覧を表示 git stash list stash 内のファイル一覧を表示 git stash show stash@{N} stash の差分を表示 git diff HEAD stash@{N} # or git stash show -p stash@{N} stash の差分を表示(ファイル指定) git diff HEAD stash@{N} -- app/hoge.rb stash の最新を適用 git stash pop stash N 番目を適用 git stash pop stash@{N} stash を全削除 git stash clear stash の最新を削除 git stash drop stash N 番目を削除 git stash drop stash@{N} stash されたファイルの内、指定したファイルを復元 stash list で表示された stash list 番号およびファイル名を指定して取り出す 例. stash list 番号 0 の app/hoge.rb ファイルを復元する git checkout stash@{0} app/hoge.rb untracked files を復元させる場合は以下 git checkout stash@{0}^3 app/hoge.rb untracked files を含めて退避 git stash save -u \u0026#34;untracked files を含めて退避\u0026#34; Fork 元の任意ブランチを親としてトピックブランチを作成 git checkout -b {new ブランチ名} {Fork 元のリモート名}/{Fork 元のブランチ名} プルリクエストの取り下げ(プルリクエスト出す直前に取り消し) git push --delete {Fork 先リモート名} {ブランチ名} #=\u0026gt; `github` 上の 「Compare \u0026amp; pull request」ボタンが消える プルリクエストの取り下げ(プルリクエスト出した直後に取り消し) git push --delete {Fork 先リモート名} {ブランチ名} #=\u0026gt; `github` 上は「close」扱いになる リモートブランチの削除 git push --delete {Fork 先リモート名} {ブランチ名} github 上の プルリクエストブランチをローカルに持ってくる プルリクエストで push された branch を指定してもってくる $ git fetch {リモート名} # 例. ブランチ sample_branch を持ってくる場合 $ git checkout -b {new ブランチ名} origin/sample_branch もしくは、以下のやり方もある プルリクエストを行うと github 上では、 pr/{連番}/head と pr/{連番}/merge というブランチが作られるためそれを使用する $ git fetch {リモート名} \u0026#39;+refs/pull/*:refs/remotes/pr/*\u0026#39; * [new ref] refs/pull/9/head -\u0026gt; pull/1/head * [new ref] refs/pull/9/merge -\u0026gt; pull/1/merge * [new ref] refs/pull/10/head -\u0026gt; pull/10/head ... (abbrev) # 例. プルリクエスト 10 を持ってくる場合 $ git checkout -b {new ブランチ名} pull/10/head プルリクエスト後に追加でコミットされたものを取得する場合は以下を行う ※コンフリクト修正のために force push している可能性があるため --rebase を指定 # 例. ブランチ sample_branch を持ってくる場合 $ git pull origin sample_branch --rebase master ブランチ以外を削除する git branch | grep -v master | xargs git branch -D master および develop ブランチ以外を削除する git branch | grep -v \u0026#34;master\\|develop\u0026#34; | xargs git branch -D 特定のコミットをマージする git log を実行して merge する対象のコミット番号を控える ※★で囲まれた部分 git cherry-pick {1 で控えたコミット番号} マージコミットを revert する git log を実行して revert する対象のコミット番号を控える 【以下、例】 commit 2c5f38104b1b1896d82b3eca80b9ce39ce1548cd git revert -m 1 {1 で控えたコミット番号} -m の後ろの数字はどちらを正とするかを表している ※main branch を正にする場合は 1 another_branch を正にする場合は 2 を指定 【以下、例】 commit 341058af5e0d673e15fe8a14111e7c759191bd9f (origin/revert_commit, revert_sample) Merge: 5c863c9 9828ee6 ← 5c863c9: 1(revert_sample), 9828ee6: 2(another_branch) git log -p で差戻の内容が正しいことを確認 git push origin revert_sample タグ追加 $ git tag -a {タグ名} -m \u0026#34;{コメント}\u0026#34; $ git tag で確認 $ git show {タグ名} で確認 $ git push origin {タグ名} Author 修正 $ git commit --amend --author=\u0026#34;{ユーザ名}\u0026#34; $ git rebase --continue $ git log --pretty=full すでにプッシュしている場合は -f が必要になる $ git push origin hoge Git ブランチ切り替え時の注意点 git checkout コマンドを使用すると移動元のブランチの修正を引き継いで切り替えを行う 上記のため、git status コマンドで差分として上がらず github に上げた際に不要なソースが混じってしまう可能性があるため注意する 対策としては以下のようにチェックアウト元を指定して新規でブランチを作成する git checkout -b {作成するブランチ名} {チェックアウト元ブランチ名}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/17/description-rails-helper-with-vuejs-and-rails/",
title: "Vue.js ＋ Rails で RailsHelper と組み合わせた場合の記述方法",
image: "images/logo/vuejs_logo.png",
date: "2019-04-17",
body: "Vue.js ＋ Rails で RailsHelper と組み合わせた場合の記述方法 経緯 Vue.js を Rails のフロントとして使用した場合に RailsHelper と組み合わせると若干記述が複雑になったため備忘録として残しておく 実際のコード(html テンプレートエンジンは slim を使用) 通常 a タグ a.btn.home href=\u0026#34;#{root_path}\u0026#34; @touchStart=\u0026#34;onTouchStartForBtn\u0026#34; @touchEnd=\u0026#34;onTouchEndForBtn\u0026#34; @touchmove=\u0026#34;onTouchMoveForBtn\u0026#34; RailsHelper での a タグ Vue.js の bind を'(シングルコート)で括る = link_to national_rankings_path, class: \u0026#39;btn ranking\u0026#39;, \u0026#39;@touchStart\u0026#39;: \u0026#34;onTouchStartForBtn\u0026#34;, \u0026#39;@touchEnd\u0026#39;: \u0026#34;onTouchEndForBtn\u0026#34;, \u0026#39;@touchmove\u0026#39;: \u0026#34;onTouchMoveForBtn\u0026#34;"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/15/register-public-key-on-github/",
title: "GitHub への公開鍵の登録",
image: "images/logo/github_logo.svg",
date: "2019-04-15",
body: "GitHub への公開鍵の登録 毎回、PC をセットアップする際に調べてしまうため備忘録として残しておく 実際のコード Mac 以下のコマンドを GitHub のEメールアドレスに置き換えて実行 $ ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f \u0026#34;id_rsa\u0026#34; \u0026gt; Generating public/private rsa key pair. 以下が表示されるのでファイル場所を入力(デフォルトでいい場合は「Enter」押下) \u0026gt; Enter a file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter] 以下が表示されるのでパスフレーズを入力(なしでいい場合は「Enter」押下) \u0026gt; Enter passphrase (empty for no passphrase): [Type a passphrase] \u0026gt; Enter same passphrase again: [Type passphrase again] SSH キーを ssh-agent に追加する 4-1. バックグラウンドでssh-agentを起動 $ eval \u0026#34;$(ssh-agent -s)\u0026#34; \u0026gt; Agent pid 59566 ※ macOS Sierra 10.12.2 以降を使用している場合は ~/.ssh/config ファイルを変更して自動的にキーを ssh-agent にロードしパスフレーズをキーチェーンに格納する必要あり Host * AddKeysToAgent yes UseKeychain yes IdentityFile ~/.ssh/id_rsa SSH 秘密鍵を ssh-agent に追加してパスフレーズをキーチェーンに保存する ssh-add --apple-use-keychain ~/.ssh/id_rsa 公開鍵をクリップボードにコピーする pbcopy \u0026lt; ~/.ssh/id_rsa.pub SSH キーを GitHub アカウントに追加する Windows(基本的には Mac と同じ) 以下のコマンドを GitHub のEメールアドレスに置き換えて実行 $ ssh-keygen -t rsa -b 4096 -C \u0026#34;your_email@example.com\u0026#34; -f \u0026#34;id_rsa\u0026#34; \u0026gt; Generating public/private rsa key pair. 以下が表示されるのでファイル場所を入力(デフォルトでいい場合は「Enter」押下) \u0026gt; Enter a file in which to save the key (/c/Users/you/.ssh/id_rsa):[Press enter] 以下が表示されるのでパスフレーズを入力(なしでいい場合は「Enter」押下) \u0026gt; Enter passphrase (empty for no passphrase): [Type a passphrase] \u0026gt; Enter same passphrase again: [Type passphrase again] 公開鍵をクリップボードにコピーする type ~/.ssh/id_rsa.pub | clip SSH キーを GitHub アカウントに追加する 複数の GitHub アカウントを切り替える場合 使用したい GitHub アカウント毎に SSH 鍵を作成する ~/.ssh/config を編集する ※ない場合は新規作成 Host github.com # メインアカウント HostName github.com User git Port 22 IdentityFile ~/.ssh/id_rsa TCPKeepAlive yes IdentitiesOnly yes Host github.com.sub # サブアカウント HostName github.com User git Port 22 IdentityFile ~/.ssh/id_rsa_sub TCPKeepAlive yes IdentitiesOnly yes GitHub に公開鍵を登録する GitHub にログインして、[Settings] \u0026gt; [SSH keys] \u0026gt; [Add SSH key]で作成した公開鍵を登録する 以下のコマンドを実行して設定が上手くいっていることを確認する ssh -T git@github.com ssh -T git@github.com.sub # Hi {yourname}! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access."
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/12/show-hide-modal-call-process-with-vuejs/",
title: "Vue.js でモーダルが表示/非表示された際に呼ばれる処理の実装",
image: "images/logo/vuejs_logo.png",
date: "2019-04-12",
body: "Vue.js でモーダルが表示/非表示された際に呼ばれる処理の実装 実際のコード HTML側 transition を指定 \u0026lt;template\u0026gt; \u0026lt;transition name=\u0026#34;app-modal\u0026#34; v-on:after-enter=\u0026#34;afterEnter\u0026#34; v-on:leave=\u0026#34;leave\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;overlay\u0026#34; v-on:click=\u0026#34;clickEvent\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;content\u0026#34; v-on:click=\u0026#34;stopEvent\u0026#34;\u0026gt; \u0026lt;p\u0026gt;\u0026lt;slot\u0026gt;\u0026lt;/slot\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;button @click=\u0026#34;clickEvent\u0026#34;\u0026gt;close\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/transition\u0026gt; \u0026lt;/template\u0026gt; JavaScript側 以下のイベントがフックされるようになる Vue.transition(\u0026#39;expand\u0026#39;, { beforeEnter: function (el) { el.textContent = \u0026#39;beforeEnter\u0026#39; }, enter: function (el) { el.textContent = \u0026#39;enter\u0026#39; }, afterEnter: function (el) { el.textContent = \u0026#39;afterEnter\u0026#39; }, enterCancelled: function (el) { // 取り消しハンドル }, beforeLeave: function (el) { el.textContent = \u0026#39;beforeLeave\u0026#39; }, leave: function (el) { el.textContent = \u0026#39;leave\u0026#39; }, afterLeave: function (el) { el.textContent = \u0026#39;afterLeave\u0026#39; }, leaveCancelled: function (el) { // 取消しハンドル } }) 実際のソースおよび実行結果"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/11/resize-when-uploading-for-carrierwave-with-rails/",
title: "Ruby on Rails の Gem CarrierWave でアップロードする際に画像をリサイズする",
image: "images/logo/rails_logo.svg",
date: "2019-04-11",
body: "Ruby on Rails の Gem CarrierWave でアップロードする際に画像をリサイズする Carrier Wave について ファイルアップロード機能を提供する Gem github 実際のコード 尚、アスペクト比固定で width および height のみ指定する場合は nil を指定する heightのみ指定 class MyUploader \u0026lt; CarrierWave::Uploader::Base include CarrierWave::MiniMagick process resize_to_limit: [1200, nil] end widthのみ指定 class MyUploader \u0026lt; CarrierWave::Uploader::Base include CarrierWave::MiniMagick process resize_to_limit: [1200, nil] end resize_to_fit と resize_to_limit の違いについて resize_to_fit 画像が指定したサイズ未満の時 =\u0026gt; アスペクト比を維持しながら指定したサイズまで拡大する resize_to_limit 画像が指定したサイズ未満の時 =\u0026gt; なにもしない"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/09/set-image-before-gretel-with-rails/",
title: "Ruby on Rails の Gem Gretel で項目の前に画像を置く",
image: "images/logo/rails_logo.svg",
date: "2019-04-09",
body: "Ruby on Rails の Gem Gretel で項目の前に画像を置く Gretel について パンくずリストを表示する Gem github 実際のコード # articles#index crumb :articles do |article| icon = article.flg ? image_tag(\u0026#34;表示したい画像\u0026#34;) : \u0026#34;\u0026#34; link icon + {表示文字}, {URL} parent :parent_articles, article.category end"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/04/07/build-to-rails2-and-ruby1-with-windows10/",
title: "Windows10 に Ruby1.8.7 ＋ Rails2.3.18 を構築する",
image: "images/logo/rails_logo.svg",
date: "2019-04-07",
body: "Windows10 に Ruby1.8.7 ＋ Rails2.3.18 を構築する 経緯 仕事で必要となり表題の環境を準備することになった 苦労したためその際の手順およびハマった点等を備忘録として残しておく 構築環境 ruby: ruby 1.8.7 rails: rails 2.3.18 手順 Ruby Installer で Ruby(1.8.7 p-374) および DevKit(DevKit-tdm-32-4.5.2-20111229-1559-sfx.exe) をダウンロードする Ruby をインストールする(オプションで環境変数パスへの登録を有効にする) DevKit を展開する(自己解凍形式の圧縮ファイルなので、実行して適当なところに展開する) 3-1. コマンドプロンプトで展開した場所に移動し以下のコマンドを入力する ruby dk.rb init ruby dk.rb install rubygems-update のバージョンをダウングレードする 4-1. 以下のコマンドを入力する gem update --system 1.3.7 ※以下のエラーが起きる場合はこのサイトを参考に手動で rubygems-update をダウングレードする $ gem update --system ERROR: While executing gem ... (Gem::RemoteFetcher::FetchError) SSL_connect returned=1 errno=0 state=SSLv2/v3 read server hello A: tlsv1 alert protocol version (https://rubygems.org/latest_specs.4.8.gz) 動作確認用のフォルダを作成 以下の gem をインストールする 6-1. このサイトで1.8.7に対応しているバージョンを調べてバージョン指定でインストールする gem install rake -v 0.8.7 gem install rails -v 2.3.18 gem install rdoc -v 2.4.2 ※rake を先にインストールしないと Ruby のバージョンが古い旨のエラーが発生するため先インストールする 動作確認用の Rails プロジェクトを作成する rails sample-rails cd sample-rails ruby script/generate scaffold user name:string age:integer db のマイグレートを行う 8-1. デフォルトの sqlite3 用の Gem をインストールする gem install sqlite3 -v 1.3.3 8-2. DLL ファイルをダウンロードする sqlitedll-3_7_3.zip をダウンロードする ※最新のやつだとエラーになるため古いやつをダウンロードすること ダウンロードしたやつを解凍して sqlite3.dll を Ruby のインストールフォルダ/bin(例. C:\\Ruby187\\bin)にコピーする 8-3. 以下のコマンドを入力して db のマイグレートを行う rake db:create rake db:migrate サーバを起動する ruby script/server サーバ(http://localhost:3000/users) にアクセスして動作確認を行う"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/28/manage-task-with-slack-and-todoist-and-integromat-2/",
title: "Slack ＋ Todoist ＋ Integromat でタスク管理 その２",
image: "images/logo/slack_logo.svg",
date: "2019-03-28",
body: "Slack ＋ Todoist ＋ Integromat でタスク管理 その２ 前回の残りTODO operation を使いすぎなためAPIの戻り値を配列化してメッセージを構築するようにする 手順 前回構築した API と Slack の処理の間に以下の処理を追加する 「スパナ」アイコンを押下後「JSON」を選択して以下を指定 「Parse JSON」 「Data structure」 「Add data structure」 「Specification」 「Generate」を押下して API の戻り値を貼り付けて生成 「JSON string」 「Data」を指定 「スパナ」アイコンを押下後「Flow Control」を選択して以下を指定 「Array aggregator」 「Source Module」 手順１ で作成したJSON 「Target structure type」 「Custom」を指定 「Aggregated fields」 必要な項目を指定 前回作成した slack の Text を以下のように修正 map() で 「content」の内容を配列で取得後 join() で改行および空白を追加する ※「\\n」では改行しないため「newline」を使用する :white_medium_square:{{nbsp}}{{join(map(33.array; \u0026#34;content\u0026#34;); newline\u0026#34;:white_medium_square:\u0026#34; + nbsp)}}"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/25/manage-task-with-slack-and-todoist-and-integromat/",
title: "Slack ＋ Todoist ＋ Integromat でタスク管理 その１",
image: "images/logo/slack_logo.svg",
date: "2019-03-25",
body: "Slack ＋ Todoist ＋ Integromat でタスク管理 その１ したいこと 日々のタスクを管理したいというよりも忘れがちな〇月に契約更新とかの数か月、数年先のタスクを管理したい タスク管理 完了/未完了を切り替え 期日を指定 リマインダー機能 昨日完了したタスク 今日期日のタスク 上記以外のタスク 今回使用するツール タスク管理 シンプルで管理しやすい todoist を使用 リマインダー機能 slack の channel への通知を使用 google calendar リマインダーが直前になる todoist と連携可能だが「期日指定なし」が連携されない integromat サイトが英語のみ integromat での todoist について integromat から使用できる todoist の 「Search for a task」では以下の項目しか返ってこないため要件を満たせない 足りない項目 サブタスクかどうか? 期限の情報 [OUTPUT] Bundle 1: (Collection) Task ID: タスクID User ID: ユーザID Project ID: プロジェクトID Content: 内容 Deleted: 削除されているかどうか(true/false) Archived: アーカイブされているかどうか(true/false) Completed: 完了されているかどうか(true/false) The ID of the assigned user: アサインされているユーザID Date created: 作成日時 LabelsArray ラベル配列 そのため、todoist api を叩くことで実装する 手順 事前作業 各ツール(todoist, slack, integromat)の会員登録 各ツールの oauth の設定 slack slack api より設定 「App Name」 任意の名称を指定 「Development Slack Workspace」 使用するワークスペースを指定 「OAuth \u0026amp; Permissions」\u0026gt;「Redirect URLs」 https://www.integromat.com/oauth/cb/slack を指定 ※「Client ID」, 「Client Secret」をメモしておく todoist Todoist App Management より設定 「App display name」 任意の名称を指定 「App service URL」 未指定 「OAuth redirect URL」 https://www.integromat.com/oauth/cb/todoist を指定 ※「Client ID」, 「Client Secret」をメモしておく ※今回は使用しない todoist の API トークンのメモ 設定の「API トークン」をメモしておく integromat の設定 「Dashboard」\u0026gt;「Create a new scenario」を選択 「What services do you want to integrate?」と表示されるため「Continue \u0026gt;」を押下 表示された画面中央の「時計」アイコンを押下して以下を指定 [毎日9:00 に実行する] 「Schedule setting」 「Run scenario:」 「Every day」 「Time」 9:00 表示された画面中央の「?」アイコンを押下して「http」を選択して以下を指定 [api を設定] 「make a request」 「URL」 https://beta.todoist.com/API/v8/tasks https://api.todoist.com/rest/v1/tasks を指定 ※2019/09/02 修正 「Method」 GET 「Content type」 JSON（application/json） 「Query String」 rest api を参照 「Headers」 「Name」 Authorization 「Value」 Bearer {事前作業でメモしたAPI トークン} 「Show advanced settings」 チェックを入れる 「+」アイコンを押下後「slack」を選択して以下を指定 「create a message」 「Connection」 「Connection name」 任意の接続名 「Client ID」 事前作業でメモした「Client ID」を指定 「Client secret」 事前作業でメモした「Client secret」を指定 「Where to send the message」 to a selected channel 「Channel」 メッセージを投稿したいチャネルを指定 「Text」 投稿したいメッセージを指定 「Show advanced settings」 チェックを入れる TODO operation を使いすぎなためAPIの戻り値を配列化してメッセージを構築するようにする"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/23/add-time-stamp-with-bat-file/",
title: "バッチファイルでタイムスタンプを付与する",
image: "images/logo/bat_file_icon.png",
date: "2019-03-23",
body: "バッチファイルでタイムスタンプを付与する ファイル名などにタイムスタンプを付与したい場合に毎回検索してしまうため備忘録として残しておく 実際のコード 例 2019/03/23 0:07:49.91 に実行した場合 yyyy/mm/dd 表示 @echo off echo %DATE% =\u0026gt; 2019/03/23 yyyy/mm/dd-hh:MM:ss.fff 表示 午前0時～午前9時の間は 0:00:00.00」(頭に半角スペース)になるため0埋め @echo off set timeStamp=%DATE%-%TIME% set timeStamp=%timeStamp: =0% echo %timeStamp% =\u0026gt; 2019/03/23-00:07:49.91 yyyymmddhhMMss 表示 %timeStamp:~m,n% の部分は変数 timeStamp の m 文字目から n 文字を切り出す(mは0始まり) @echo off set timeStamp=%DATE%-%TIME% set timeStamp=%timeStamp: =0% set formatTimeStamp=%timeStamp:~0,4%%timeStamp:~5,2%%timeStamp:~8,2%%timeStamp:~11,2%%timeStamp:~14,2%%timeStamp:~17,2% echo %formatTimeStamp% =\u0026gt; 20190323000749"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/19/config-hosts-file-for-microsoft-edge-developer/",
title: "Microsoft Edge Developer(旧Modern IE)でhostsファイルを設定する方法",
image: "images/logo/microsoft_windows_logo.svg",
date: "2019-03-19",
body: "Microsoft Edge Developer(旧Modern IE)でhostsファイルを設定する方法 経緯 普段 Mac にて開発を行っているが動作端末は Windows であることが多い そのため、表題のツールを使用することがあるがその際に Mac 上の hosts ファイルと同様の設定をしたい場合があり苦労したため備忘録として残しておく Microsoft Edge Developer(旧Modern IE)について ダウンロードは以下から行う ダウンロードページの「Virtual Machines」より「Virtual machine」と「platform」を選択してダウンロードする 手順 hostsファイルの権限変更 Microsoft Edge Developer 上で以下を行う 「C:/Windows/System32/drivers/etc」に hosts ファイルがある そのファイルを右クリック\u0026gt;Properties\u0026gt;Security\u0026gt;Editボタンで、 Users の権限に全部チェックを入れる Mac の hosts ファイルを複製 Mac の hosts ファイルは「/private/etc/hosts」にあるので、それを前述のファイルに中身をコピーする ※hosts ファイルのループバックアドレスは固定のホスト側のIPアドレスに置き換えて記述すること Rails での確認の際の注意点 確認作業を Rails で行う場合には追加で以下の作業を行う IEの場合 サーバの起動の際に以下のコマンドで行う bundle exec rails s -b 0.0.0.0 インターネットオプションのLocal intranetに「localhost:3000」を登録 Edgeの場合 サーバの起動の際に以下のコマンドで行う bundle exec rails s -b 0.0.0.0 インターネットオプションの Local intranet に「localhost:3000」を登録 about:flags を入力し、「Developer Settings」の「allow localhost loopback(this might put your device at risk)」のチェックを外す"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/11/road-to-fp3/",
title: "FP3級への道",
image: "images/logo/fp_logo.svg",
date: "2019-03-11",
body: "FP3級への道 ここ最近今まで縁のなかった確定申告や高額医療制度のお世話になることがあった 上記のこともあり知識として必要だと感じため、学習しその記録を残しておく 受験する科目 学科 FP 協会・金融財政事情研究会で共通 実技 ※難易度的には FP 協会の「資産設計提案業務」が初心者には易しいらしい FP 協会 資産設計提案業務 金融財政事情研究会 個人資産相談業務 ※今回受験 保険顧客資産相談業務 使用する教材 今回使用する教材は以下 2018-2019年版　みんなが欲しかった！　FPの教科書3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ 他の人の評価等を確認する限り、これ１冊でもいけそう 必要があれば追加で購入する とりあえず、5月の受験を目指す 2019/03/26 追記 試験用の電卓を購入 CANON HS-1220TUG 実務電卓 12桁楽天市場で購入Amazonで購入by カエレバ こっちと迷ったが現状だとあまり必要なさそうなので安さで選択上位の級で必要になれば購入する シャープ EL-N942-X 実務電卓 12桁楽天市場で購入Amazonで購入by カエレバ 2019/04/15 追記 問題集として追加で以下を購入 ※教本だけだと習熟度がわからないため 2018-2019年版　みんなが欲しかった！　FPの問題集3級 滝澤ななみ TAC 2018年05月22日 売り上げランキング : 楽天ブックスで購入Amazonで購入 by ヨメレバ"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/08/attention-use-each-for-jquery-with-cofee-script/",
title: "CofeeScript で JQuery の each を使用する場合の注意点",
image: "images/logo/coffee_script_logo.png",
date: "2019-03-08",
body: "CofeeScript で JQuery の each を使用する場合の注意点 JQueryの取得した要素分繰り返すeachを使用した場合にeachの内部でCoffeeScriptの@を使用するとJQueryのthisとして扱われてしまいReferenceErrorが発生する その場合は以下のように修正する 実際のソース 修正前 processRows: -\u0026gt; $(\u0026#34;#my-table\u0026gt;tr\u0026#34;).each -\u0026gt; id = $(this).attr(\u0026#34;id\u0026#34;) @processRow id 修正後 processRows: -\u0026gt; $(\u0026#34;#my-table\u0026gt;tr\u0026#34;).each (index, element) =\u0026gt; id = $(element).attr(\u0026#34;id\u0026#34;) @processRow id"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/07/initial-screen-display-scroll-to-center-specific-elementelement-with-vuejs/",
title: "Vue.js で画面初期表示時に特定の要素をスクロールエリア中央に表示する",
image: "images/logo/vuejs_logo.png",
date: "2019-03-07",
body: "Vue.js で画面初期表示時に特定の要素をスクロールエリア中央に表示する 経緯 web アプリでランキング画面のようにリスト内の自分の行を中心に表示のようなことを行いたい場合があり調査した結果を備忘録として残しておく 実際のソースおよび実行結果 画面初期表示時に id = 1(Taro) のデータをスクロールエリアの中央に表示する created のタイミングで API 等からデータが取得される想定のため変数 users 監視しておいて変わったタイミングで画面中央にスクロール位置を移動させる 例はスクロールエリアの height が固定のパターンであるが可変の場合は画面サイズを使用して計算する"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/06/show-ellipsis-multiple-lines-with-css/",
title: "CSS で複数行でも3点リーダーを表示する",
image: "images/logo/html_logo.svg",
date: "2019-03-06",
body: "CSS で複数行でも3点リーダーを表示する 経緯 CSS で3点リーダーを表示したい場合がよくあるが複数行の場合でも同様の対応を行いたい場合があり調査した結果を備忘録として残しておく 実際のソースおよび実行結果"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/03/04/ime-comp-with-vbnet/",
title: "VB.NET でふりがな機能を実装する",
image: "images/logo/vbnet_logo.svg",
date: "2019-03-04",
body: "VB.NET でふりがな機能を実装する 経緯 最近、周りで VB.NET を使っている人が複数人出てきた恐らく2020年にWindows7 サポート終了となるため VB6 =\u0026gt; VB.NET へのコンバージョンの案件が増えていると思われる そのため、以前行った際に苦労したふりがな機能について備忘録として残しておくことにする 実際のコード ふりがな取得機能の実装クラス 以下のふりがなに対応(半角および全角英数はそのまま取得) ひらがな 全角カナ 半角カナ Option Strict Off Option Explicit On Imports System.Runtime.InteropServices Delegate Function fncDelegate(ByVal hWnd As Integer, ByVal uMsg As Integer, ByVal wParam As Integer, ByVal lParam As Integer) As Integer \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; 変換イベントクラス \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; Public Class ConvertedEventArgs Inherits EventArgs \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; 変換イベントクラスのコンストラクタ \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;f\u0026#34;\u0026gt;ふりがな文字列\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;r\u0026#34;\u0026gt;変換後文字列\u0026lt;/param\u0026gt; Public Sub New(ByVal f As String, ByVal r As String) Furigana = f Result = r End Sub Public ReadOnly Property Furigana() As String Public ReadOnly Property Result() As String End Class \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; 自動ふりがな取得クラス \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; Public Class Imecomp Private m_TxtSrcControl As Control Private m_TxtDestControl As Control Private WithEvents M_MsgListner As MsgListner Private ReadOnly m_StrConvMode As Integer \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; ふりがな取得完了通知イベント \u0026#39;\u0026#39;\u0026#39; \u0026#39;\u0026#39;\u0026#39; ふりがな取得が完了したことを通知する \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;txtSrc\u0026#34;\u0026gt;ふりがな取得対象テキストボックス\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;txtDest\u0026#34;\u0026gt;ふりがな出力対象テキストボックス\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;e\u0026#34;\u0026gt;変換イベントクラス\u0026lt;/param\u0026gt; Public Event Converted(ByVal txtSrc As System.Object, ByVal txtDest As System.Object, ByVal e As ConvertedEventArgs) \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; メッセージリスナークラス \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; Private Class MsgListner Inherits NativeWindow \u0026#39;Windows Message Public Const WM_IME_COMPOSITION As Integer = \u0026amp;H10F Public Const WM_IME_ENDCOMPOSITION As Integer = \u0026amp;H10E Public Const WM_CHAR As Integer = \u0026amp;H102 Public Const WM_KEYDOWN As Integer = \u0026amp;H100 Public Const WM_KEYUP As Integer = \u0026amp;H101 \u0026#39;IME APIs Declare Function ImmGetCompositionString Lib \u0026#34;imm32.dll\u0026#34; Alias \u0026#34;ImmGetCompositionStringA\u0026#34; (ByVal hIMC As Integer, ByVal dw As Integer, ByRef lpv As Byte, ByVal dw2 As Integer) As Integer Private Const GCS_COMPREADSTR As Integer = \u0026amp;H1 Private Const GCS_COMPSTR As Integer = \u0026amp;H8 Private Const GCS_RESULTREADSTR As Integer = \u0026amp;H200 Private Const GCS_RESULTSTR As Integer = \u0026amp;H800 Declare Function ImmGetOpenStatus Lib \u0026#34;imm32.dll\u0026#34; (ByVal hIMC As Integer) As Integer Declare Function ImmSetOpenStatus Lib \u0026#34;imm32.dll\u0026#34; (ByVal hIMC As Integer, ByVal fOpen As Boolean) As Integer Declare Function ImmGetContext Lib \u0026#34;imm32.dll\u0026#34; (ByVal hWnd As Integer) As Integer Declare Function ImmReleaseContext Lib \u0026#34;imm32.dll\u0026#34; (ByVal hWnd As Integer, ByVal hIMC As Integer) As Integer \u0026#39;Subclass APIs Declare Function SetWindowLong Lib \u0026#34;user32\u0026#34; Alias \u0026#34;SetWindowLongA\u0026#34; (ByVal hWnd As Integer, ByVal nIndex As Integer, \u0026lt;MarshalAs(UnmanagedType.FunctionPtr)\u0026gt; ByVal dwNewLong As fncDelegate) As Integer Declare Function SetWindowLong Lib \u0026#34;user32\u0026#34; Alias \u0026#34;SetWindowLongA\u0026#34; (ByVal hWnd As Integer, ByVal nIndex As Integer, ByVal dwNewLong As Integer) As Integer Private Const GWL_WNDPROC As Integer = (-4) Declare Function CallWindowProc Lib \u0026#34;user32\u0026#34; Alias \u0026#34;CallWindowProcA\u0026#34; (ByVal lpPrevWndFunc As Integer, ByVal hWnd As Integer, ByVal msg As Integer, ByVal wParam As Integer, ByVal lParam As Integer) As Integer Private m_Enabled As Boolean = True Private convMode As Integer = 0 Private pramStrConvMode As Integer = 0 Public Event Converted(ByVal imeCompString As String, ByVal resultConvString As String) Public Property Enabled() As Boolean Get Return m_Enabled End Get Set(ByVal Value As Boolean) m_Enabled = Value End Set End Property \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; ふりがな取得対象コントロールのウィンドウプロシージャ \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;m\u0026#34;\u0026gt;Windows メッセージ\u0026lt;/param\u0026gt; Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message) Dim hIMC As Integer Dim intLength As Integer If m_Enabled Then Select Case m.Msg Case WM_IME_COMPOSITION Dim bytBuff() As Byte Dim strResult As String = \u0026#34;\u0026#34; Dim strFurigana As String = \u0026#34;\u0026#34; hIMC = ImmGetContext(Me.Handle.ToInt32) \u0026#39;変換後文字列の取得 intLength = ImmGetCompositionString(hIMC, GCS_RESULTSTR, 0, 0) If intLength \u0026gt; 0 Then ReDim bytBuff(intLength - 1) ImmGetCompositionString(hIMC, GCS_RESULTSTR, bytBuff(0), intLength) strResult = System.Text.Encoding.Default.GetString(bytBuff) End If \u0026#39;ふりがな文字列 intLength = ImmGetCompositionString(hIMC, GCS_RESULTREADSTR, 0, 0) If intLength \u0026gt; 0 Then ReDim bytBuff(intLength - 1) ImmGetCompositionString(hIMC, GCS_RESULTREADSTR, bytBuff(0), intLength) strFurigana = System.Text.Encoding.Default.GetString(bytBuff) convMode = IIf(pramStrConvMode = 0, vbNarrow, pramStrConvMode) \u0026#39;追加する文字種の判断 If ChrIsNarrow(StrConv(strResult, VbStrConv.Narrow)) Then strFurigana = strResult End If \u0026#39;テキストを追加 Select Case convMode Case VbStrConv.Narrow strFurigana = StrConv(strFurigana, VbStrConv.Narrow) Case VbStrConv.Katakana strFurigana = StrConv(strFurigana, VbStrConv.Wide) Case Else strFurigana = StrConv(StrConv(strFurigana, VbStrConv.Wide), convMode) End Select \u0026#39;イベント起動 RaiseEvent Converted(strFurigana, strResult) End If ImmReleaseContext(Me.Handle.ToInt32, hIMC) Case WM_CHAR \u0026#39;半角英数字 hIMC = ImmGetContext(Me.Handle.ToInt32) If ImmGetOpenStatus(hIMC) = 0 Then If m.WParam.ToInt32 \u0026gt;= 32 Then \u0026#39;イベント起動 RaiseEvent Converted(Chr(m.WParam.ToInt32), Chr(m.WParam.ToInt32)) End If End If ImmReleaseContext(Me.Handle.ToInt32, hIMC) End Select End If MyBase.WndProc(m) End Sub \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; メッセージリスナークラスのコンストラクタ \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;target\u0026#34;\u0026gt;入力文字\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;strConvMode\u0026#34;\u0026gt;文字変換モード\u0026lt;/param\u0026gt; Public Sub New(ByVal target As IntPtr, ByRef strConvMode As Integer) pramStrConvMode = strConvMode AssignHandle(target) End Sub Protected Overrides Sub Finalize() ReleaseHandle() MyBase.Finalize() End Sub \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; 半角文字かどうかを判定して返す \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;target\u0026#34;\u0026gt;ふりがな取得対象テキストボックス\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;returns\u0026gt;true:半角文字/false:半角文字以外\u0026lt;/returns\u0026gt; Public Function ChrIsNarrow(ByRef target As String) As Boolean Dim nPt As Integer Dim NowPt As Integer Dim NowCode As Integer Dim fNarrow As Boolean fNarrow = True nPt = Len(target) For NowPt = 1 To nPt NowCode = Asc(Mid(target, NowPt, 1)) If NowCode \u0026lt; 0 Or NowCode \u0026gt; 255 Then fNarrow = False Exit For End If Next NowPt ChrIsNarrow = fNarrow End Function End Class \u0026#39;\u0026#39;\u0026#39; \u0026lt;summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; 自動ふりがな取得クラスのコンストラクタ \u0026#39;\u0026#39;\u0026#39; \u0026lt;/summary\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;txtSrc\u0026#34;\u0026gt;ふりがな取得対象テキストボックス\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;txtDest\u0026#34;\u0026gt;ふりがな出力対象テキストボックス\u0026lt;/param\u0026gt; \u0026#39;\u0026#39;\u0026#39; \u0026lt;param name=\u0026#34;strConvMode\u0026#34;\u0026gt;ふりがなの種類\u0026lt;/param\u0026gt; Public Sub New(ByVal txtSrc As Control, txtDest As Control, strConvMode As Integer) M_MsgListner = New MsgListner(txtSrc.Handle, strConvMode) m_TxtSrcControl = txtSrc m_TxtDestControl = txtDest End Sub Public ReadOnly Property TxtSrcControl() As Control Get Return m_TxtSrcControl End Get End Property Public ReadOnly Property TxtDestControl() As Control Get Return m_TxtDestControl End Get End Property Public Property Enabled() As Boolean Get Return M_MsgListner.Enabled End Get Set(ByVal Value As Boolean) M_MsgListner.Enabled = Value End Set End Property Private Sub M_MsgListner_Converted(ByVal imeCompString As String, ByVal resultConvString As String) Handles M_MsgListner.Converted RaiseEvent Converted(Me.TxtSrcControl, Me.TxtDestControl, New ConvertedEventArgs(imeCompString, resultConvString)) End Sub End Class ふりがな取得機能テスト用フォーム 初期処理時にふりがな種別を指定する Imports Microsoft.VisualBasic Public Class Form1 Private WithEvents ImeComp As Imecomp \u0026#39;ふりがな取得イベント Private Sub Frm1_Load(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Load ImeComp = New Imecomp(Me.TextBox1, Me.TextBox2, VbStrConv.Hiragana) \u0026#39;ふりがなの種類（ひらがな） \u0026#39;imeComp = New Imecomp(Me.TextBox1, Me.TextBox3, VbStrConv.Katakana) \u0026#39;ふりがなの種類（全角カナ） \u0026#39;ImeComp = New Imecomp(Me.TextBox1, Me.TextBox4, VbStrConv.Narrow) \u0026#39;ふりがなの種類（半角カナ） End Sub Private Sub ImeComp_Converted(ByVal txtSrc As Object, ByVal txtDest As Object, ByVal e As ConvertedEventArgs) Handles ImeComp.Converted txtDest.Text \u0026amp;= e.Furigana If Len(txtDest.Text) \u0026gt; txtDest.MaxLength Then txtDest.Text = Strings.Left(txtDest.Text, txtDest.MaxLength) End If End Sub Private Sub TextBox1_TextChanged(sender As Object, e As EventArgs) Handles TextBox1.TextChanged If TextBox1.Text = \u0026#34;\u0026#34; Then TextBox2.Text = \u0026#34;\u0026#34; TextBox3.Text = \u0026#34;\u0026#34; TextBox4.Text = \u0026#34;\u0026#34; End If End Sub End Class 実行結果イメージ ふりがな自動取得機能 実行結果"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/02/28/unread-chatwork-notice-with-rambox/",
title: "Rambox で ChatWork の未読メッセージを通知する",
image: "images/logo/rambox_logo.png",
date: "2019-02-28",
body: "Rambox で ChatWork の未読メッセージを通知する 確認環境 Windows10 Rambox: 0.6.3 経緯 普段、 仕事で Chatwork や Slack を使用しているが別々のアプリを切り替えるのが手間だったためまとめて管理できるツールがないか調査した 候補 Franz Station Rambox Franz, Station だと ChatWork で PDF ファイルのプレビューを表示した際にダウンロード用のダイアログが表示されるため 「保存」 =\u0026gt; 「PDF を開く」の手間が発生してしまうため Rambox に決定 Rambox の ChatWork の挙動 Rambox で ChatWork をサービスとして追加した場合自分にメンションがついているメッセージの場合は以下のようにバッジと未読数が表示される Rambox バッジおよび未読数 しかし、自分にメンションがついていないメッセージについてはバッジおよび未読数は表示されないため見逃してしまう 対処方法 Rambox のサービス設定画面でカスタムコードを使用して対応する ※未読数(未読のあるルーム数) アプリ版 ChatWork と同じ挙動 Rambox サービス設定画面 実際のコード [Custom Code] function checkUnread() { const elements = document.querySelectorAll(\u0026#34;.roomListBadges__unreadBadgeText\u0026#34;); updateBadge(elements.length); } function updateBadge(e) { e \u0026gt;= 1 ? rambox.setUnreadCount(e) : rambox.clearUnreadCount(); } setInterval(checkUnread, 3000);"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/02/26/detect-loaded-and-start-reading-for-img-with-vuejs/",
title: "Vue.js で画像の読み込みの開始および完了を検知する",
image: "images/logo/vuejs_logo.png",
date: "2019-02-26",
body: "Vue.js で画像の読み込みの開始および完了を検知する 確認環境 Vue.js: v2.6.7 方法 読み込み開始検知 img タグの :src に展開する URL を変数化 ※1 Vue.js 側の watch で1.の変数を監視 ※2 読み込み完了検知 img タグに以下のイベントを追加 v-on:load=\u0026quot;メソッド名\u0026quot; ※3 Vue.js 側に1.で指定したメソッドを定義 ※4 実際のソース \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;ja\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;画像の読み込みの開始および完了を検知する方法\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;img :src=\u0026#34;url\u0026#34; v-on:load=\u0026#34;load\u0026#34; /\u0026gt; \u0026lt;!-- ※3 --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/vue/dist/vue.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; var app = new Vue({ el: \u0026#39;#app\u0026#39;, data: { url: \u0026#34;https://raw.githubusercontent.com/vuejs/art/master/logo.png\u0026#34; // ※1 }, methods: { // ※4 load: function() { console.log(\u0026#39;loaded\u0026#39;); }, } }); // ※2 app.$watch(\u0026#39;url\u0026#39;, function(val, oldVal) { console.log(val); }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; 実行結果"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/02/25/order-by-prefer-yourself-with-rails/",
title: "Rails の order by で自分を優先的に取得する(MySql 限定)",
image: "images/logo/rails_logo.svg",
date: "2019-02-25",
body: "Rails の order by で自分を優先的に取得する(MySql 限定) 確認環境 ruby: ruby 2.5.3 rails: rails 5.2.2 方法 Mysqlの FIELD 関数を使用する※FIELD 関数の結果で ORDER BY する 例. レコードを order 昇順, user_id 昇順で並び替える場合 ※同じ順位の場合は自分を優先 order(:order, [\u0026#34;field(user_id , #{current_user.id}) desc\u0026#34;], :user_id) ※ ポイントとしては第２ソートキーの前に ORDER BY FIELD を使用すること また、ORDER BY FIELD で指定した分に対して desc を指定すること ※ desc を指定しないと自分以外が優先的に並び替えられてしまう)"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/02/21/set-self-association-with-rails/",
title: "Rails で階層構造になっているテーブルに自分自身への関連を設定する",
image: "images/logo/rails_logo.svg",
date: "2019-02-21",
body: "Rails で階層構造になっているテーブルに自分自身への関連を設定する テーブル構成例 [Nodesテーブル] 最上位のノード以外は親ノードを持っている id name parent_id 1 parrent_node null 2 child_node_1 1 3 child_node_2 1 4 child_node_1_1 2 5 child_node_1_2 2 6 child_node_2_1 3 7 child_node_2_2 3 確認環境 ruby: ruby 2.5.3 rails: rails 5.2.2 実際のコード class Node \u0026lt; ApplicationRecord has_many :children, class_name: \u0026#34;Node\u0026#34;, foreign_key: \u0026#34;parrent_id\u0026#34; belongs_to :parrent, class_name: \u0026#34;Node\u0026#34;, optional: true # rails5 から default が require になっているため　`optional: true` を指定しないと `nil` での保存が不可 end class CreateNodes \u0026lt; ActiveRecord::Migration[5.2] def change create_table :nodes do |t| t.string :name t.references :parrent t.timestamps end end end 実行例 テーブル構成例のデータが格納済の状態 # 最上位ノードに紐付く子ノードのレコードを取得 parrent_node = Node.first parrent_node.children #=\u0026gt; Node Load (0.8ms) SELECT `nodes`.* FROM `nodes` WHERE `nodes`.`parrent_id` = 1 LIMIT 11 #=\u0026gt; #\u0026lt;ActiveRecord::Associations::CollectionProxy [#\u0026lt;Node id: 2, name: \u0026#34;child_node_1\u0026#34;, parrent_id: 1, created_at: \u0026#34;2019-02-21 09:05:38\u0026#34;, updated_at: \u0026#34;2019-02-21 09:05:38\u0026#34;\u0026gt;, #\u0026lt;Node id: 3, name: \u0026#34;child_node_2\u0026#34;, parrent_id: 1, created_at: \u0026#34;2019-02-21 09:05:38\u0026#34;, updated_at: \u0026#34;2019-02-21 09:05:38\u0026#34;\u0026gt;]\u0026gt; # 子ノードに紐付く親ノードのレコードを取得 child_node = Node.find(2) child_node.parrent #=\u0026gt; Node Load (0.5ms) SELECT `nodes`.* FROM `nodes` WHERE `nodes`.`id` = 1 LIMIT 1 #=\u0026gt; #\u0026lt;Node id: 1, name: \u0026#34;parrent_node\u0026#34;, parrent_id: nil, created_at: \u0026#34;2019-02-21 09:05:37\u0026#34;, updated_at: \u0026#34;2019-02-21 09:05:37\u0026#34;\u0026gt; # 最上位ノードに紐付く親ノードのレコードを取得 parrent_node = Node.first parrent_node.parrent #=\u0026gt; nil"
},
{
url: "https://kkawazoe.github.io/amp/blog/2019/02/20/markdown-pdf-page-break/",
title: "Visual Studio Code で Markdown PDF を使用してPDF出力する際に任意の場所で改行させる",
image: "images/logo/vscode_logo.png",
date: "2019-02-20",
body: "Visual Studio Code で Markdown PDF を使用してPDF出力する際に任意の場所で改行させる 経緯 普段、 VS Code を使用しておりちょっとしたメモや資料は Markdown を使用して作成している 資料を共有をする場合に拡張機能である Markdown PDF を使用しているが、出力後のPDFで改ページが微妙な場所でされてしまったため任意の場所で改ページできないか調査した 情報元 Markdown PDF の「Page Break」の項目に記載あり 実際のコード # h1 ## h2 ### h3 \u0026lt;!-- 改行させたい位置 --\u0026gt; \u0026lt;div class=\u0026#34;page\u0026#34;/\u0026gt; # h1 ## h2 ### h3"
},
{
url: "https://kkawazoe.github.io/amp/blog/2014/06/22/get-value-from-initialize-file/",
title: "Windows 環境でバッチファイルからiniファイルを読込んで値を取得する",
image: "images/logo/bat_file_icon.png",
date: "2014-06-22",
body: "Windows 環境でバッチファイルからiniファイルを読込んで値を取得する 対応方法 バッチファイルから ini ファイルを読込む場合 VBS を使用することで実現する 具体的には、バッチファイルから VBS を呼び出して ini ファイルより値を取得して VBS から戻り値を受け取り、実現する 取得する ini ファイルの中身 \u0026lt;設定値\u0026gt;*****************************************************\u0026#39;\u0026lt;コメント\u0026gt;####################################### [Path] WorkPath=C:/src/wk \u0026#39;Work Folder Path 実際のコード @echo off set iniFileName=sample.ini for /f \u0026#34;usebackq tokens=* delims=\u0026#34; %%A in (`call cscript //Nologo getProfileString.vbs \u0026#34;%iniFileName%\u0026#34; Path WorkPath`) do set ret=%%A echo \u0026#34;%ret%\u0026#34; pause exit Option Explicit rem /***************************************************************** rem * getProfileString.vbs iniFileName, sectionName, entryName rem * rem * 引数 rem * iniFileName : 設定ファイル名(フルパス) rem * sectionName : セクション名 rem * entryName : エントリー名 rem * 動作 rem * 引数に指定された設定ファイルより指定した rem * 「セクション」,「エントリー」に対応する設定値を返す rem * 先頭がカンマの場合はコメント行として扱う rem * 行の途中でカンマがある場合は直前までの文字列(右空白除去)を rem * 設定値として扱う rem * 戻り値 rem * 設定値(見つからなかった場合およびエラーの場合は空を返す) rem *****************************************************************/ Dim ret Dim fs Dim readLineObj Dim searchFlg Dim buffer rem ファイルシステムアクセス用 Set fs = CreateObject( \u0026quot;Scripting.FileSystemObject\u0026quot; ) ret = \u0026quot;\u0026quot; rem ファイルを開く on error resume next Set readLineObj = fs.OpenTextFile( Wscript.Arguments(0), 1 ) if Err.Number \u0026lt;\u0026gt; 0 then rem ファイルアクセスエラーの場合は終了 Wscript.Echo ret Wscript.Quit end if on error goto 0 rem 検索処理用のフラグ searchFlg = false rem 読込みループ Do While not readLineObj.AtEndOfStream rem 行単位の読込み buffer = readLineObj.ReadLine rem 空の行以外の場合 if Trim(buffer) \u0026lt;\u0026gt; \u0026quot;\u0026quot; then rem 対象セクションの場合 if Ucase(Trim(buffer)) = \u0026quot;[\u0026quot; \u0026amp; Ucase( Wscript.Arguments(1) ) \u0026amp; \u0026quot;]\u0026quot; then searchFlg = true else rem 設定値を取得 ret = GetProfileString(buffer, Wscript.Arguments(2), searchFlg) rem エントリー名が見つからなかった場合 if searchFlg And IsEmpty(ret) then ret = \u0026quot;\u0026quot; end if rem 設定値を取得できた場合はループを抜ける if searchFlg And (Len(ret) \u0026lt;\u0026gt; 0) then Exit Do end if end if Loop readLineObj.Close Wscript.Echo ret Wscript.Quit rem /***************************************************************** rem * 引数に指定された設定ファイルより指定した rem * 「セクション」,「エントリー」に対応する設定値を返す rem * 先頭がカンマの場合はコメント行として扱う rem * 行の途中でカンマがある場合は直前までの文字列(右空白除去)を rem * 設定値として扱う rem * rem * 引数 rem * buffer : 設定ファイルより読込んだ行 rem * sectionName : セクション名 rem * searchFlg : 検索用フラグ rem * 戻り値 rem * 設定値(見つからなかった場合およびエラーの場合は空を返す) rem *****************************************************************/ Function GetProfileString ( buffer, sectionName, searchFlg ) Dim ret Dim entries Dim entry ret = \u0026quot;\u0026quot; if searchFlg then rem 次のセクションの場合 if Left(Trim(buffer) ,1) = \u0026quot;[\u0026quot; then rem ループを抜ける GetProfileString = Empty Exit Function end if entries = Split(buffer, \u0026quot;'\u0026quot;) entry = Split(entries(0), \u0026quot;=\u0026quot;) rem エントリーの場合 if (Ubound(entry) = 1) then rem 検索対象のエントリーの場合 if Ucase(Trim(entry(0))) = Ucase(sectionName) then ret = RTrim(entry(1)) End if end if end if GetProfileString = ret End Function"
},
{
url: "https://kkawazoe.github.io/amp/blog/2014/02/09/switch-processing-by-message-box/",
title: "Windows 環境でバッチファイルからメッセージボックスを表示して押下されたボタンによって処理を切り替える",
image: "images/logo/bat_file_icon.png",
date: "2014-02-09",
body: "Windows 環境でバッチファイルからメッセージボックスを表示して押下されたボタンによって処理を切り替える 対応方法 バッチファイルからメッセージボックスを表示する場合バッチファイル単体では実現不可のため VBS を使用して実現する ※具体的には、バッチファイルから VBS を呼び出してメッセージボックスを表示し、 VBS から戻り値を受け取り、処理を切り替える 実際のコード @echo off rem メッセージボックスの表示 set msg=\u0026#34;メッセージボックスのテスト [\\n] で改行します\u0026#34; set title=\u0026#34;メッセージボックステスト\u0026#34; for /f \u0026#34;usebackq tokens=* delims=\u0026#34; %%A in (`call cscript //Nologo msgbox.vbs %msg%\u0026#34;%title%\u0026#34;`) do set ret=%%A echo %ret% pause exit Option Explicit rem /******************************************************* rem * msgbox.vbs msg [,title] rem * rem * 引数 rem * msg :表示するメッセージ rem * title :メッセージボックスのタイトル rem * 動作 rem * メッセージボックスを表示し、クリックされたボタンに rem * 対応する数値を返す rem * msg中の 「\\n」という文字列は改行に変換する rem * 戻り値 rem * 0:[はい]/1:[いいえ] rem ********************************************************/ Dim args Dim arg(99) Dim value Dim cnt Dim retBtn Dim ret Dim eLevel rem 引数を変数にセット Set args = WScript.Arguments cnt = 0 For Each value In args arg(cnt) = value cnt = cnt + 1 Next rem 改行文字の置換 arg(0) = RepExAll (arg(0), \u0026quot;\\\\n\u0026quot;, VbCrLf) eLevel = 0 retBtn = MsgBox (arg(0), 36, arg(1)) Select Case retBtn Case 6: ret = 0 Case 7: ret = 1 End Select WScript.Echo ret WScript.Quit (eLevel) rem /******************************************************* rem * 文字列を正規表現文字列で検索して、一致する文字列を rem * すべて置換文字列に置換して返す rem * rem * 引数 rem * str1 :置換対象文字列 rem * reg :正規表現文字列 rem * str2 :置換文字列 rem * 戻り値 rem * 置換後の文字列 rem ********************************************************/ Function RepExAll ( str1, reg, str2 ) Dim regExpression Dim Matchers Set regExpression = New RegExp regExpression.Pattern = reg regExpression.IgnoreCase = True regExpression.Global = True RepExAll = regExpression.Replace(str1, str2) End Function"
},
];
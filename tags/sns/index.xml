<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>SNS on Note To Self ~One Step At A Time~</title><link>https://kkawazoe.github.io/tags/sns/</link><description>Recent content in SNS on Note To Self ~One Step At A Time~</description><generator>Hugo -- gohugo.io</generator><language>jp</language><lastBuildDate>Fri, 26 Jul 2024 12:00:00 +0900</lastBuildDate><atom:link href="https://kkawazoe.github.io/tags/sns/index.xml" rel="self" type="application/rss+xml"/><item><title>ShellScript で Amazon SNS トピックに紐づかないサブスクリプションを削除する方法</title><link>https://kkawazoe.github.io/blog/2024/07/26/how-to-remove-subscriptions-not-tied-to-amazon-sns-topics-in-shell-script/</link><pubDate>Fri, 26 Jul 2024 12:00:00 +0900</pubDate><guid>https://kkawazoe.github.io/blog/2024/07/26/how-to-remove-subscriptions-not-tied-to-amazon-sns-topics-in-shell-script/</guid><description>ShellScript で Amazon SNS トピックに紐づかないサブスクリプションを削除する方法について調査した結果を備忘録として残しておく
環境 OS: MacOS 実際のコード &amp;lt;&amp;lt;AWS Configure Profile&amp;gt;&amp;gt; 部分は実際の環境に応じて書き換える
#!/bin/bash AWS_PROFILE=&amp;lt;&amp;lt;AWS Configure Profile&amp;gt;&amp;gt; # SNSトピック一覧を取得 topics=$(aws sns list-topics --profile=${AWS_PROFILE} | jq -r &amp;#39;.Topics[].TopicArn&amp;#39;) # SNSサブスクリプション一覧を取得 subscriptions=$(aws sns list-subscriptions --profile=${AWS_PROFILE}) # トピックに紐づかないサブスクリプションを削除 echo $subscriptions | jq -c &amp;#39;.Subscriptions[]&amp;#39; | while read subscription; do subscriptionArn=$(echo $subscription | jq -r &amp;#39;.SubscriptionArn&amp;#39;) topicArn=$(echo $subscription | jq -r &amp;#39;.TopicArn&amp;#39;) # サブスクリプションのtopicArnがtopicsに含まれていなければ削除 if ! echo $topics | grep $topicArn &amp;gt; /dev/null then aws sns unsubscribe --subscription-arn $subscriptionArn --profile=${AWS_PROFILE} echo &amp;#34;削除したサブスクリプション: $subscriptionArn&amp;#34; fi done</description></item></channel></rss>